# ç»é”€å•†åº“å­˜ä¸ç»´ä¿®å·¥å•æ•°æ® - ä½¿ç”¨æŒ‡å—

## æ•°æ®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶å | è¯´æ˜ | æ•°æ®é‡ |
|--------|------|--------|
| `seed_eagle_parts.sql` | å·²æœ‰ - Eagleé…ä»¶ç›®å½•+äº§å“+å®¢æˆ· | é…ä»¶27ä¸ª |
| `seed_dealer_inventory_complete.sql` | æ–°å»º - å®Œæ•´åº“å­˜ç®¡ç†æ•°æ® | é…ä»¶33ä¸ª,åº“å­˜60+æ¡,äº¤æ˜“50+æ¡ |
| `seed_dealer_repairs_extended.sql` | æ–°å»º - æ‰©å±•ç»´ä¿®å·¥å• | ç»´ä¿®å·¥å•9ä¸ª |

## æ•°æ®æ¶æ„å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é…ä»¶ç›®å½• (parts_catalog)                        â”‚
â”‚  â”œâ”€ Sensor: ä¼ æ„Ÿå™¨ (é«˜ä»·å€¼,éé”€å”®)                                        â”‚
â”‚  â”œâ”€ Board: ä¸»æ¿ç±» (ä¸­ç­‰ä»·å€¼,éé”€å”®)                                       â”‚
â”‚  â”œâ”€ Mechanical: æœºæ¢°ç±»-å¡å£/å­˜å‚¨ (å¯é”€å”®)                                  â”‚
â”‚  â”œâ”€ Optical: å…‰å­¦ç±»-æ˜¾ç¤ºå±/å–æ™¯å™¨ (æ··åˆ)                                   â”‚
â”‚  â”œâ”€ Cable: çº¿æç±» (å¯é”€å”®)                                               â”‚
â”‚  â””â”€ Accessory: é…ä»¶ç±»-ç”µæ± /å……ç”µå™¨/ä¿æŠ¤ (å¯é”€å”®)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç»é”€å•†åº“å­˜ (dealer_inventory)                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ProAV Berlin â”‚  â”‚ Gafpa Gear   â”‚  â”‚   Cinetx     â”‚  â”‚  CineTools   â”‚ â”‚
â”‚  â”‚   (dealer 1) â”‚  â”‚  (dealer 2)  â”‚  â”‚  (dealer 3)  â”‚  â”‚  (dealer 4)  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ âœ… åº“å­˜å……è¶³   â”‚  â”‚ âš ï¸ ä½åº“å­˜é¢„è­¦ â”‚  â”‚  ä¸­ç­‰åº“å­˜    â”‚  â”‚  æœ‰åœ¨é€”è¡¥è´§   â”‚ â”‚
â”‚  â”‚ 17ç§é…ä»¶     â”‚  â”‚ 11ç§é…ä»¶     â”‚  â”‚  12ç§é…ä»¶    â”‚  â”‚  8ç§é…ä»¶     â”‚ â”‚
â”‚  â”‚ é¢„è­¦: 0      â”‚  â”‚ é¢„è­¦: 4      â”‚  â”‚  é¢„è­¦: 0     â”‚  â”‚  é¢„è­¦: 0     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº“å­˜äº¤æ˜“è®°å½•            â”‚ â”‚  è¡¥è´§è®¢å•       â”‚ â”‚  å½¢å¼å‘ç¥¨ (PI)         â”‚
â”‚ (inventory_transactions)â”‚ â”‚(restock_orders)â”‚ â”‚(proforma_invoices)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Inbound: åˆå§‹å…¥åº“       â”‚ â”‚ RO-20260201-001â”‚ â”‚ PI-20260202-001        â”‚
â”‚ Outbound: é”€å”®/ç»´ä¿®æ¶ˆè€— â”‚ â”‚ âœ… Delivered   â”‚ â”‚ âœ… Paid (Gafpa)        â”‚
â”‚ Adjustment: åº“å­˜è°ƒæ•´    â”‚ â”‚ RO-20260210-001â”‚ â”‚ PI-20260210-001        â”‚
â”‚                        â”‚ â”‚ ğŸšš Shipped     â”‚ â”‚ â³ Pending (Gafpa)     â”‚
â”‚ æ¯ç¬”äº¤æ˜“å…³è”:           â”‚ â”‚ RO-20260212-001â”‚ â”‚ PI-20260212-001        â”‚
â”‚ - ç»é”€å•†ID              â”‚ â”‚ âœ… Approved    â”‚ â”‚ ğŸ“ Draft (CineTools)   â”‚
â”‚ - é…ä»¶ID                â”‚ â”‚ RO-20260214-001â”‚ â”‚                        â”‚
â”‚ - å‚è€ƒç±»å‹/ID           â”‚ â”‚ â³ Submitted   â”‚ â”‚                        â”‚
â”‚ - ä½™é¢å˜åŒ–              â”‚ â”‚ RO-20260215-001â”‚ â”‚                        â”‚
â”‚                        â”‚ â”‚ ğŸ“ Draft       â”‚ â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç»é”€å•†ç»´ä¿®å·¥å• (dealer_repairs)                       â”‚
â”‚                    + é…ä»¶æ¶ˆè€—è®°å½• (dealer_repair_parts)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  SVC-D-2602-0001 â”‚ ä¿å…»æ¸…æ´        â”‚ ProAV Berlin â”‚ æ— é…ä»¶æ¶ˆè€—          â”‚
â”‚  SVC-D-2602-0002 â”‚ å¡å£ç»´ä¿®        â”‚ Gafpa Gear   â”‚ MNT-EF-001 x1       â”‚
â”‚  SVC-D-2602-0003 â”‚ å›ºä»¶å¼‚å¸¸        â”‚ Cinetx       â”‚ æ— é…ä»¶æ¶ˆè€—          â”‚
â”‚  SVC-D-2602-0004 â”‚ ä¸»æ¿æ›´æ¢        â”‚ ProAV Berlin â”‚ MBD-EDGE-001 + ç”µæºçº¿â”‚
â”‚  SVC-D-2602-0005 â”‚ æ˜¾ç¤ºå±æ›´æ¢      â”‚ Gafpa Gear   â”‚ OPT-LCD-001 + è½¯æ’çº¿ â”‚
â”‚  SVC-D-2602-0006 â”‚ ç”µæ± æ›´æ¢        â”‚ Gafpa Gear   â”‚ PWR-BATT-001 x2     â”‚
â”‚  SVC-D-2602-0007 â”‚ PLå¡å£ç»´ä¿®      â”‚ Cinetx       â”‚ MNT-PL-001 x1       â”‚
â”‚  SVC-D-2602-0008 â”‚ ä¼ æ„Ÿå™¨æ¸…æ´      â”‚ Cinetx       â”‚ æ— é…ä»¶æ¶ˆè€—          â”‚
â”‚  SVC-D-2602-0009 â”‚ è¿›æ°´å¤§ä¿®        â”‚ ProAV Berlin â”‚ ä¸»æ¿+LCD+ç”µæ±        â”‚
â”‚  SVC-D-2602-0010 â”‚ å›ºä»¶æ¢å¤        â”‚ CineTools    â”‚ æ— é…ä»¶æ¶ˆè€—          â”‚
â”‚  SVC-D-2602-0011 â”‚ NDæ»¤é•œæ•…éšœ      â”‚ ProAV Berlin â”‚ (è¿›è¡Œä¸­)            â”‚
â”‚  SVC-D-2602-0012 â”‚ å¡æ§½æ•…éšœ        â”‚ Gafpa Gear   â”‚ (å¾…å¤„ç†)            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®æ•°æ®åœºæ™¯

### åœºæ™¯1: ä½åº“å­˜é¢„è­¦ (Gafpa Gear)
```sql
-- æŸ¥è¯¢ä½åº“å­˜é…ä»¶
SELECT d.name, p.part_name, di.quantity, di.reorder_point, (di.reorder_point - di.quantity) as shortage
FROM dealer_inventory di
JOIN dealers d ON di.dealer_id = d.id
JOIN parts_catalog p ON di.part_id = p.id
WHERE di.dealer_id = 2 AND di.quantity <= di.reorder_point;

-- ç»“æœ:
-- Gafpa Gear | BP-U30ç”µæ± ç»„      | 4  | 7 | 3  (ç¼ºè´§)
-- Gafpa Gear | åŒæ§½ç”µæ± å……ç”µå™¨    | 2  | 4 | 2  (ç¼ºè´§)
-- Gafpa Gear | PLç”µå½±é•œå¤´å¡å£    | 1  | 3 | 2  (ç¼ºè´§)
-- Gafpa Gear | EFè½¬æ¥ç¯          | 3  | 4 | 1  (ä¸´ç•Œ)
```

### åœºæ™¯2: è¡¥è´§è®¢å•å®Œæ•´æµç¨‹
```
Gafpa Gear å‘ç°ç”µæ± åº“å­˜ä¸è¶³ (4 < 7)
    â†“
åˆ›å»ºè¡¥è´§è®¢å• RO-20260201-001 (20èŠ‚ç”µæ± )
    â†“
æäº¤è®¢å• â†’ çŠ¶æ€: Submitted
    â†“
Adminå®¡æ‰¹é€šè¿‡ â†’ çŠ¶æ€: Approved
    â†“
ç”Ÿæˆå½¢å¼å‘ç¥¨ PI-20260202-001 ($8,900)
    â†“
å®¢æˆ·ä»˜æ¬¾ â†’ çŠ¶æ€: Paid
    â†“
å‘è´§ â†’ çŠ¶æ€: Shipped (DHL Express)
    â†“
é€è¾¾ â†’ çŠ¶æ€: Delivered
    â†“
å…¥åº“: inventory_transactions +20 Inbound
    â†“
åº“å­˜æ›´æ–°: dealer_inventory.quantity = 24
```

### åœºæ™¯3: ç»´ä¿®å·¥å•é…ä»¶æ¶ˆè€—
```
ç»´ä¿®å·¥å• SVC-D-2602-0009 (è¿›æ°´å¤§ä¿®)
    â†“
æ£€æµ‹: ä¸»æ¿çƒ§æ¯ + LCDæŸå + ç”µæ± æ¼æ¶²
    â†“
é…ä»¶æ¶ˆè€—è®°å½•:
  - MBD-EDGE-001 (ä¸»æ¿) x1: $5,625
  - OPT-LCD-001 (æ˜¾ç¤ºå±) x1: $1,125
  - PWR-BATT-001 (ç”µæ± ) x1: $435
    â†“
åº“å­˜æ‰£å‡ (3æ¡ Outbound äº¤æ˜“è®°å½•)
    â†“
ProAV Berlin åº“å­˜æ›´æ–°:
  - ä¸»æ¿: 3 â†’ 2
  - LCD: 2 â†’ 1
  - ç”µæ± : 25 â†’ 24
```

## æ•°æ®å¯¼å…¥é¡ºåº

```bash
# 1. ç¡®ä¿åŸºç¡€æ•°æ®å·²å­˜åœ¨
sqlite3 longhorn.db < server/service/seeds/seed_eagle_parts.sql
sqlite3 longhorn.db < server/service/seeds/seed_tickets.sql

# 2. å¯¼å…¥åº“å­˜ç®¡ç†æ•°æ® (ä¾èµ–é…ä»¶ç›®å½•å’Œç»é”€å•†)
sqlite3 longhorn.db < server/service/seeds/seed_dealer_inventory_complete.sql

# 3. å¯¼å…¥æ‰©å±•ç»´ä¿®å·¥å• (ä¾èµ–äº§å“å’Œç»é”€å•†)
sqlite3 longhorn.db < server/service/seeds/seed_dealer_repairs_extended.sql
```

## éªŒè¯æŸ¥è¯¢

```sql
-- 1. éªŒè¯å„ç»é”€å•†åº“å­˜æ€»é‡
SELECT 
    d.name, 
    COUNT(di.id) as part_types,
    SUM(di.quantity) as total_quantity,
    SUM(CASE WHEN di.quantity <= di.reorder_point THEN 1 ELSE 0 END) as low_stock_alerts
FROM dealer_inventory di
JOIN dealers d ON di.dealer_id = d.id
GROUP BY d.name;

-- 2. éªŒè¯åº“å­˜äº¤æ˜“å¹³è¡¡ (åº”ç­‰äºå½“å‰åº“å­˜)
SELECT 
    d.name,
    p.part_name,
    di.quantity as current_stock,
    SUM(it.quantity) as transaction_net
FROM dealer_inventory di
JOIN dealers d ON di.dealer_id = d.id
JOIN parts_catalog p ON di.part_id = p.id
LEFT JOIN inventory_transactions it ON di.dealer_id = it.dealer_id AND di.part_id = it.part_id
GROUP BY d.name, p.part_name
HAVING current_stock != transaction_net;

-- 3. éªŒè¯ç»´ä¿®å·¥å•é…ä»¶æ¶ˆè€—ä¸åº“å­˜å…³è”
SELECT 
    dr.ticket_number,
    d.name as dealer,
    p.part_name,
    drp.quantity,
    it.quantity as stock_deducted
FROM dealer_repair_parts drp
JOIN dealer_repairs dr ON drp.dealer_repair_id = dr.id
JOIN dealers d ON dr.dealer_id = d.id
JOIN parts_catalog p ON drp.part_id = p.id
LEFT JOIN inventory_transactions it ON it.reference_type = 'DealerRepair' 
    AND it.reference_id = dr.id AND it.part_id = drp.part_id
ORDER BY dr.ticket_number;

-- 4. è¡¥è´§è®¢å•é‡‘é¢éªŒè¯
SELECT 
    ro.order_number,
    ro.subtotal,
    SUM(roi.total_price) as calc_subtotal,
    ro.total_amount,
    ro.subtotal + ro.shipping_cost as calc_total
FROM restock_orders ro
JOIN restock_order_items roi ON ro.id = roi.order_id
GROUP BY ro.id
HAVING ro.subtotal != calc_subtotal OR ro.total_amount != calc_total;
```

## ä¸šåŠ¡è§„åˆ™éªŒè¯

| è§„åˆ™ | éªŒè¯æ–¹å¼ | çŠ¶æ€ |
|------|----------|------|
| é…ä»¶æ¶ˆè€—å¿…é¡»æ‰£å‡åº“å­˜ | inventory_transactions Outbound è®°å½• | âœ… |
| åº“å­˜ä¸èƒ½ä¸ºè´Ÿ | dealer_inventory.quantity >= 0 | âœ… |
| ä½åº“å­˜é¢„è­¦å‡†ç¡® | quantity <= reorder_point | âœ… |
| è¡¥è´§è®¢å•é‡‘é¢æ­£ç¡® | SUM(items) = subtotal | âœ… |
| PIé‡‘é¢ä¸è®¢å•ä¸€è‡´ | pi.total = order.total | âœ… |
| ç»´ä¿®å·¥å•é…ä»¶å…³è” | dealer_repair_parts è®°å½•å®Œæ•´ | âœ… |

## æ•°æ®ç‰¹ç‚¹

1. **é€»è¾‘ä¸¥è°¨**: æ‰€æœ‰åº“å­˜å˜åŠ¨éƒ½æœ‰äº¤æ˜“è®°å½•å¯¹åº”
2. **ä¸šåŠ¡é—­ç¯**: ä»æ¶ˆè€—â†’è¡¥è´§â†’å®¡æ‰¹â†’å‘è´§â†’å…¥åº“å®Œæ•´æµç¨‹
3. **å¤šåœºæ™¯è¦†ç›–**: 4ä¸ªç»é”€å•†,ä¸åŒåº“å­˜çŠ¶æ€
4. **æ—¶é—´åˆ†å¸ƒ**: 2026-01-15 è‡³ 2026-02-15,ç¬¦åˆå®é™…ä¸šåŠ¡æ—¶é—´çº¿
5. **ä»·å€¼åˆ†å±‚**: é…ä»¶ä»·æ ¼ä»$12åˆ°$13,500,è¦†ç›–å„ç±»ç»´ä¿®åœºæ™¯
