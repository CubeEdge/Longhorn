# 详细权限错误提示示例

本文档展示了新的详细权限错误提示系统的各种场景示例。

---

## 场景 1：Member 尝试删除他人文件（贡献权限限制）

**操作**：pepper（Member）尝试删除 orange（Lead）上传的文件

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：市场部 (MS)/项目资料/20260103_report.pdf
👤 当前用户：pepper (普通成员)
🔐 当前权限：贡献权限 - 本部门 (市场部 (MS))

⚠️ 原因：该文件由 "orange" 上传，您的"贡献权限"仅允许修改/删除自己上传的文件。

💡 解决方案：
   1. 请联系部门主管或系统管理员申请"完全权限"
   2. 或请文件上传者 "orange" 进行删除操作
```

---

## 场景 2：Member 在无权限目录上传文件

**操作**：pepper 尝试上传文件到研发部（不是自己的部门）

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：研发部 (RD)/项目代码
👤 当前用户：pepper (普通成员)
🔐 当前权限：无权限

⚠️ 原因：您在此目录下没有写入权限。

💡 解决方案：
   • 请联系系统管理员或相关部门主管申请访问权限
```

---

## 场景 3：Member 在只读授权目录尝试上传

**操作**：pepper 在被授予"只读"权限的共享文件夹上传文件

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：通用台面 (GE)/共享资源
👤 当前用户：pepper (普通成员)
🔐 当前权限：只读权限 - 被授权目录 (通用台面 (GE)/共享资源)

⚠️ 原因：您仅有"只读权限"，无法上传文件或创建文件夹。

💡 解决方案：
   • 请联系部门主管或系统管理员申请"贡献权限"或"完全权限"
```

---

## 场景 4：Member 在只读授权目录尝试删除

**操作**：pepper 尝试删除只读目录中的文件

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：运营部 (OP)/公告/notice.pdf
👤 当前用户：pepper (普通成员)
🔐 当前权限：只读权限 - 被授权目录 (运营部 (OP)/公告)

⚠️ 原因：您仅有"只读权限"，无法进行修改或删除操作。

💡 解决方案：
   • 请联系部门主管或系统管理员申请"贡献权限"或"完全权限"
```

---

## 场景 5：Member 删除自己上传的文件（成功案例）

**操作**：pepper 删除自己上传的文件

**结果**：✅ 删除成功（无错误提示）

---

## 场景 6：Member 在贡献权限目录删除他人文件

**操作**：pepper 在被授予"贡献"权限的目录中尝试删除他人文件

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：研发部 (RD)/测试环境/config.json
👤 当前用户：pepper (普通成员)
🔐 当前权限：贡献权限 - 被授权目录 (研发部 (RD)/测试环境)

⚠️ 原因：该文件由 "admin" 上传，您的"贡献权限"仅允许修改/删除自己上传的文件。

💡 解决方案：
   1. 请联系部门主管或系统管理员申请"完全权限"
   2. 或请文件上传者 "admin" 进行删除操作
```

---

## 场景 7：Member 移动文件到无权限目录

**操作**：pepper 尝试将文件移动到没有写权限的目录

**错误提示**：
```
❌ 权限不足

📁 目标文件/文件夹：研发部 (RD)/产品发布
👤 当前用户：pepper (普通成员)
🔐 当前权限：无权限

⚠️ 原因：您在此目录下没有写入权限。

💡 解决方案：
   • 请联系系统管理员或相关部门主管申请访问权限
```

---

## 错误信息结构说明

每条详细错误提示包含以下部分：

1. **标题**：❌ 权限不足
2. **上下文信息**：
   - 📁 目标文件/文件夹路径
   - 👤 当前用户（用户名 + 角色）
   - 🔐 当前权限类型和作用范围
3. **原因说明**：⚠️ 具体说明为什么操作被拒绝
4. **解决方案**：💡 提供具体的操作建议

---

## 技术实现

### 后端函数：`getPermissionError(user, folderPath, operation, fileOwnerId, fileOwnerName)`

**参数**：
- `user`：当前用户对象
- `folderPath`：目标文件/文件夹路径
- `operation`：操作类型（'delete', 'move', 'upload', 'create'）
- `fileOwnerId`：文件所有者ID（可选）
- `fileOwnerName`：文件所有者用户名（可选）

**返回**：格式化的多行错误信息字符串

### 前端展示

前端通过 `alert()` 展示多行错误信息。浏览器会自动处理 `\n` 换行符，显示为多行文本。

---

## 对比：旧 vs 新

### 旧错误提示（简单）
```
删除失败
```

### 新错误提示（详细）
```
❌ 权限不足

📁 目标文件/文件夹：市场部 (MS)/项目资料/report.pdf
👤 当前用户：pepper (普通成员)
🔐 当前权限：贡献权限 - 本部门 (市场部 (MS))

⚠️ 原因：该文件由 "orange" 上传，您的"贡献权限"仅允许修改/删除自己上传的文件。

💡 解决方案：
   1. 请联系部门主管或系统管理员申请"完全权限"
   2. 或请文件上传者 "orange" 进行删除操作
```

**改进点**：
- ✅ 用户知道是谁上传的文件
- ✅ 用户知道自己当前的权限级别
- ✅ 用户知道文件的具体路径
- ✅ 用户知道如何获得所需权限
- ✅ 提供了具体的联系人建议（部门主管、系统管理员）

---

**文档结束**

> 本文档展示了详细权限错误提示系统的各种实际场景，帮助用户快速理解和解决权限问题。
