# Longhorn è¿ç»´ä¸éƒ¨ç½²æ‰‹å†Œ (Dev OPS Manual)

æœ¬æ–‡æ¡£æ•´åˆäº† Longhorn ç³»ç»Ÿä»æœ¬åœ°å¼€å‘ã€ä»£ç åŒæ­¥ã€æœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æµç¨‹ã€‚

---

## ğŸš€ å¼€å‘è€…ï¼šè¿œç¨‹è¿ç»´æŒ‡å— (Dev & Remote Ops)

æœ¬ç« èŠ‚æ±‡æ€»äº†å¼€å‘æœŸé—´æœ€é«˜é¢‘ä½¿ç”¨çš„è¿œç¨‹æ§åˆ¶ã€éƒ¨ç½²æ ¡éªŒåŠè°ƒè¯•è§„èŒƒã€‚

### 1. è¿œç¨‹æœåŠ¡å™¨è®¿é—® (SSH Access)
è¿œç¨‹æœåŠ¡å™¨é€šè¿‡ Cloudflare Tunnel ç©¿é€ï¼Œæ²¡æœ‰å›ºå®š IPã€‚

- **Web åŸŸå**: `https://opware.kineraw.com` (æˆ– `opware.kinefinity.com`)
- **SSH åŸŸå**: `ssh.kineraw.com`
- **SSH åˆ«å**: `mini` (å·²é€šè¿‡ `~/.ssh/config` é…ç½®)

```bash
# å¿«æ·è¿æ¥
ssh mini
```

### 2. è¿œç¨‹å‘½ä»¤æ‰§è¡Œè§„èŒƒ
âš ï¸ **å¼ºåˆ¶æ ¼å¼**: æ‰€æœ‰è¿œç¨‹å‘½ä»¤å¿…é¡»ä½¿ç”¨ç™»å½• Shell (`zsh -l`) æ‰§è¡Œï¼Œä¸”å¿…é¡»å…ˆåˆ‡æ¢è‡³å·¥ä½œç›®å½•ã€‚

**æ ‡å‡†å‘½ä»¤æ ¼å¼**:
```bash
ssh mini "/bin/zsh -l -c 'cd /Users/admin/Documents/server/Longhorn/server && <å‘½ä»¤>'"
```

**æ•°æ®åº“è°ƒè¯•ç¤ºä¾‹**:
- **æ•°æ®åº“è·¯å¾„**: `/Users/admin/Documents/server/Longhorn/server/longhorn.db`
- **æ‰§è¡Œè¿ç§»**: `ssh mini "/bin/zsh -l -c 'cd /Users/admin/Documents/server/Longhorn/server && sqlite3 longhorn.db < migrations/xxx.sql'"`
- **å¿«é€ŸæŸ¥è¯¢**: `ssh mini "/bin/zsh -l -c 'sqlite3 ~/Documents/server/Longhorn/server/longhorn.db \"SELECT ...\"'"`

#### ğŸ’¡ æƒé™è¯´æ˜ (Command Confirmation)
å¯¹äº**åªè¯»æ“ä½œ**ï¼ˆå¦‚ `ls`, `cat`, `grep`, `curl -I`, `sqlite3 ... "SELECT..."` ç­‰ï¼‰ï¼ŒAgent **æ— éœ€è¯·æ±‚ç”¨æˆ·ç¡®è®¤**ï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚åªæœ‰æ¶‰åŠä¿®æ”¹æˆ–ç³»ç»Ÿé…ç½®å˜æ›´çš„æ“ä½œæ‰éœ€è¦ç”³è¯·æƒé™ã€‚

### 3. å…¨é‡éƒ¨ç½²è§„èŒƒ (Deployment)
âš ï¸ **æ‰§è¡Œè·¯å¾„**: ç»Ÿä¸€åœ¨é¡¹ç›®**æ ¹ç›®å½•**ä¸‹æ‰§è¡Œè„šæœ¬ã€‚ä¸¥ç¦åœ¨ `client` æˆ– `server` ç›®å½•ä¸‹å°è¯•è¿è¡Œã€‚

```bash
# æ­£ç¡®æ‰§è¡Œæ–¹å¼
./scripts/deploy.sh
```

- **é‡è½½æœºåˆ¶**: è„šæœ¬åœ¨åŒæ­¥ä»£ç åå¿…é¡»æ‰§è¡Œ `pm2 reload` (è€Œé `restart`)ï¼Œç¡®ä¿æŠ¤ç†ä¿®æ”¹åç”Ÿäº§ç¯å¢ƒåŠ è½½æ–°ä»£ç ã€‚

### 4. æ„å»ºå®Œæ•´æ€§ä¸æ ¡éªŒ (Build Integrity)
ä¸ºç¡®ä¿ç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„æ˜¯æœŸæœ›çš„ä»£ç ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¡éªŒæµç¨‹ï¼š

1.  **ç‰©ç†æ¸…ç†**: æ‰§è¡Œ `npm run build` å‰ï¼Œ**å¿…é¡»**ç‰©ç†åˆ é™¤æ—§çš„ `dist` ç›®å½•ã€‚
2.  **æŠ¥é”™æ‹¦æˆª**: ä¸¥ç¦å¿½ç•¥æ„å»ºæŠ¥é”™ã€‚è‹¥ TypeScript æŠ¥é”™æˆ–æ‰“åŒ…ä¸­æ­¢ï¼Œä¸¥ç¦åŒæ­¥è‡³æœåŠ¡å™¨ã€‚
3.  **äº§ç‰©å­˜åœ¨æ€§æ ¡éªŒ**: éƒ¨ç½²å‰éªŒè¯ `ls -la dist/index.html`ã€‚
4.  **æ··æ·†åŒ…å†…å®¹æ ¡éªŒ (Verification Proof)**: éƒ¨ç½²åå¿…é¡»ä½¿ç”¨ `grep` éªŒè¯å…³é”®ä»£ç å·²è¿›å…¥æ··æ·†åçš„ JS åŒ…ã€‚**ä¸¥ç¦æœªç»éªŒè¯å³è¯·æ±‚ç”¨æˆ·åˆ·æ–°ã€‚**

### 5. ç‰ˆæœ¬ç®¡ç†è§„èŒƒ (Versioning)
- **è½¯ä»¶ç‰ˆæœ¬**: åœ¨ `package.json` ä¸­ç»´æŠ¤ï¼Œæ ¼å¼ `X.Y.Z`ã€‚æ¯æ¬¡ä¿®æ”¹ä»£ç å**è‡ªåŠ¨é€’å¢ Z ä½**ã€‚

### 6. æµè§ˆå™¨è°ƒè¯•ä¸è‡ªåŠ¨ç™»å½• (Browser Debugging & Auth)
å½“ Agent è°ƒç”¨æµè§ˆå™¨è¿›è¡Œç•Œé¢è°ƒè¯•æˆ–è‡ªåŠ¨åŒ–æ“ä½œæ—¶ï¼Œå¦‚é‡åˆ°éœ€è¦ç™»å½•çš„æƒ…å†µï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ç®¡ç†å‘˜å‡­æ®ï¼š

- **ç®¡ç†åå°**: `admin`
- **å¯†ç **: `admin123`

âš ï¸ **æ³¨æ„**: Agent åœ¨è‡ªåŠ¨åŒ–æ“ä½œè¿‡ç¨‹ä¸­ï¼Œåº”ä¼˜å…ˆå°è¯•è¯†åˆ«ç™»å½•è¡¨å•å¹¶è‡ªåŠ¨å¡«å…¥ä¸Šè¿°å‡­æ®ã€‚

---

## ğŸ›  ç³»ç»Ÿç¨³å®šç»´æŠ¤ (Stable Maintenance)

é¢å‘é•¿æœŸè¿è¡Œçš„ç³»ç»Ÿé…ç½®ä¸å¤‡ä»½ç­–ç•¥ã€‚

### 1. ç½‘ç»œæ¶æ„ (Cloudflare)
ä¸¤æ¡ä¸»è¦è·¯ç”±ï¼š
- `https://opware.kineraw.com` -> `http://localhost:4000` (åç«¯é›†æˆ)
- `ssh.kineraw.com` -> `ssh://localhost:22` (è¿ç»´)

### 2. å¼€æœºè‡ªå¯åŠ¨é…ç½® (Auto-start)
- **ç¡¬ä»¶**: `sudo pmset -a autorestart 1` (æ–­ç”µè‡ªåŠ¨å¼€æœº)ã€‚
- **è¿›ç¨‹**: `pm2 startup` && `pm2 save` (æœåŠ¡è‡ªå¯)ã€‚
- **ç½‘ç»œ**: `sudo cloudflared service install` (ç©¿é€è‡ªå¯)ã€‚

### 3. æ–‡ä»¶å­˜å‚¨æ¶æ„ (Fileserver)

æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶ï¼ˆFilesåº”ç”¨ã€Serviceåº”ç”¨ï¼‰ç»Ÿä¸€å­˜å‚¨åœ¨è¿œç¨‹æœåŠ¡å™¨çš„ `/Volumes/fileserver/` ç›®å½•ä¸‹ã€‚
- **è½¯é“¾æ¥**: `server/data/DiskA` -> `/Volumes/fileserver/Files`
- **é™„ä»¶è·¯å¾„**: `Service/Tickets/{ç±»å‹}/`
- **çŸ¥è¯†åº“è·¯å¾„**: `Service/Knowledge/Images/`

### ç›®å½•ç»“æ„
```
/Volumes/fileserver/
â”œâ”€â”€ ğŸ“ Files/                    # Files åº”ç”¨æ ¹ç›®å½•
â”‚   â”œâ”€â”€ MS/                      # å¸‚åœºéƒ¨éƒ¨é—¨æ–‡ä»¶
â”‚   â”œâ”€â”€ OP/                      # è¿è¥éƒ¨éƒ¨é—¨æ–‡ä»¶
â”‚   â”œâ”€â”€ RD/                      # ç ”å‘éƒ¨éƒ¨é—¨æ–‡ä»¶
â”‚   â”œâ”€â”€ RE/                      # é€šç”¨å°é¢
â”‚   â”œâ”€â”€ GE/                      # æ—§ç›®å½•ï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ MEMBERS/                 # ä¸ªäººç©ºé—´
â”‚       â””â”€â”€ {username}/
â”‚
â”œâ”€â”€ ğŸ“ Service/                  # Service åº”ç”¨æ ¹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ Tickets/              # å·¥å•é™„ä»¶
â”‚   â”‚   â”œâ”€â”€ Inquiry/             # å’¨è¯¢å·¥å•
â”‚   â”‚   â”œâ”€â”€ RMA/                 # RMAè¿”å‚å•
â”‚   â”‚   â””â”€â”€ DealerRepair/        # ç»é”€å•†ç»´ä¿®å•
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Knowledge/            # çŸ¥è¯†åº“èµ„æº
â”‚   â”‚   â”œâ”€â”€ Images/              # çŸ¥è¯†åº“å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ Videos/              # çŸ¥è¯†åº“è§†é¢‘
â”‚   â”‚   â””â”€â”€ Documents/           # çŸ¥è¯†åº“æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Products/             # äº§å“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ Photos/              # äº§å“ç…§ç‰‡
â”‚   â”‚   â”œâ”€â”€ Manuals/             # è¯´æ˜ä¹¦
â”‚   â”‚   â””â”€â”€ Firmware/            # å›ºä»¶æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ Temp/                 # ä¸´æ—¶ä¸Šä¼ ç›®å½•
â”‚       â””â”€â”€ Chunks/              # åˆ†å—ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ System/                   # ç³»ç»Ÿæ–‡ä»¶
â”‚   â”œâ”€â”€ Backups/db/              # æ•°æ®åº“å¤‡ä»½
â”‚   â”œâ”€â”€ Thumbnails/              # ç¼©ç•¥å›¾ç¼“å­˜
â”‚   â””â”€â”€ RecycleBin/              # å›æ”¶ç«™
â”‚
â””â”€â”€ ğŸ“ Shared/                   # å…±äº«èµ„æº
    â”œâ”€â”€ Public/                  # å…¬å¼€è®¿é—®æ–‡ä»¶
    â””â”€â”€ Templates/               # æ¨¡æ¿æ–‡ä»¶
```

### 4. æ•°æ®åº“å¤‡ä»½ç­–ç•¥ (Backup)
- **ä¸»å¤‡ä»½**: æ¯ 3 å°æ—¶ï¼Œä¿ç•™ 7 å¤©ï¼Œå­˜å‚¨äº `fileserver`ã€‚
- **æ¬¡çº§å¤‡ä»½**: æ¯ 24 å°æ—¶ï¼Œä¿ç•™ 30 å¤©ï¼Œå­˜å‚¨äºç³»ç»Ÿç›˜ã€‚

### å¤‡ä»½æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Mac mini æœåŠ¡å™¨                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ä¸»å¤‡ä»½ (Primary)    â”‚  â”‚    æ¬¡çº§å¤‡ä»½ (Secondary)  â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  /Volumes/fileserver/   â”‚  â”‚  ~/Documents/server/    â”‚  â”‚
â”‚  â”‚  System/Backups/db/     â”‚  â”‚  Longhorn/server/       â”‚  â”‚
â”‚  â”‚  â””â”€â”€ backups/           â”‚  â”‚  backups/secondary/     â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  é¢‘ç‡: 3å°æ—¶ (å¯é…ç½®)   â”‚  â”‚  é¢‘ç‡: 24å°æ—¶ (å¯é…ç½®)   â”‚  â”‚
â”‚  â”‚  ä¿ç•™: 7å¤© (å¯é…ç½®)      â”‚  â”‚  ä¿ç•™: 30å¤© (å¯é…ç½®)     â”‚  â”‚
â”‚  â”‚  å­˜å‚¨: fileserver SSD   â”‚  â”‚  å­˜å‚¨: ç³»ç»Ÿç›˜            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†‘                              â†‘                  â”‚
â”‚           â”‚                              â”‚                  â”‚
â”‚      åº”ç”¨å†…è‡ªåŠ¨å¤‡ä»½                 åº”ç”¨å†…è‡ªåŠ¨å¤‡ä»½           â”‚
â”‚    (BackupServiceè°ƒåº¦)            (BackupServiceè°ƒåº¦)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
---

## ğŸ“‚ éƒ¨ç½²è·¯å¾„å‚è€ƒ

| èŠ‚ç‚¹ | è§’è‰² | éƒ¨ç½²è·¯å¾„ | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- |
| **MBAir** | å¼€å‘æœº | `/Users/Kine/Documents/.../Longhorn` | å”¯ä¸€ä»£ç æº |
| **Mac mini** | æœåŠ¡å™¨ | `/Users/admin/Documents/server/Longhorn` | ç”Ÿäº§ç¯å¢ƒ |

---

> **æ³¨æ„**: æ—§çš„é›¶æ•£éƒ¨ç½²æ–‡æ¡£å·²å½’æ¡£ï¼Œæ—¥å¸¸å¼€å‘ä¸è¿ç»´è¯·ä»¥æœ¬æ‰‹å†Œ (`OPS.md`) ä¸ºå‡†ã€‚
