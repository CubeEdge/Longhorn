# Longhorn è¿ç»´ä¸éƒ¨ç½²æ‰‹å†Œ (OPS Manual)

æœ¬æ–‡æ¡£æ•´åˆäº† Longhorn ç³»ç»Ÿä»æœ¬åœ°å¼€å‘ã€ä»£ç åŒæ­¥ã€æœåŠ¡å™¨éƒ¨ç½²åˆ°æ—¥å¸¸è¿ç»´çš„å®Œæ•´æµç¨‹ã€‚

---

## ğŸš€ å¼€å‘è€…ï¼šè¿œç¨‹è¿ç»´æŒ‡å— (Dev & Remote Ops)

æœ¬ç« èŠ‚æ±‡æ€»äº†å¼€å‘æœŸé—´æœ€é«˜é¢‘ä½¿ç”¨çš„è¿œç¨‹æ§åˆ¶ã€éƒ¨ç½²æ ¡éªŒåŠè°ƒè¯•è§„èŒƒã€‚

### 1. è¿œç¨‹æœåŠ¡å™¨è®¿é—® (SSH Access)
è¿œç¨‹æœåŠ¡å™¨é€šè¿‡ Cloudflare Tunnel ç©¿é€ï¼Œæ²¡æœ‰å›ºå®š IPã€‚

- **Web åŸŸå**: `https://opware.kineraw.com` (æˆ– `opware.kinefinity.com`)
- **SSH åŸŸå**: `ssh.kineraw.com`
- **SSH åˆ«å**: `mini` (å·²é€šè¿‡ `~/.ssh/config` é…ç½®)

```bash
# å¿«æ·è¿æ¥
ssh mini
```

### 2. è¿œç¨‹å‘½ä»¤æ‰§è¡Œè§„èŒƒ
âš ï¸ **å¼ºåˆ¶æ ¼å¼**: æ‰€æœ‰è¿œç¨‹å‘½ä»¤å¿…é¡»ä½¿ç”¨ç™»å½• Shell (`zsh -l`) æ‰§è¡Œï¼Œä¸”å¿…é¡»å…ˆåˆ‡æ¢è‡³å·¥ä½œç›®å½•ã€‚

**æ ‡å‡†å‘½ä»¤æ ¼å¼**:
```bash
ssh mini "/bin/zsh -l -c 'cd /Users/admin/Documents/server/Longhorn/server && <å‘½ä»¤>'"
```

**æ•°æ®åº“è°ƒè¯•ç¤ºä¾‹**:
- **æ•°æ®åº“è·¯å¾„**: `/Users/admin/Documents/server/Longhorn/server/longhorn.db`
- **æ‰§è¡Œè¿ç§»**: `ssh mini "/bin/zsh -l -c 'cd /Users/admin/Documents/server/Longhorn/server && sqlite3 longhorn.db < migrations/xxx.sql'"`
- **å¿«é€ŸæŸ¥è¯¢**: `ssh mini "/bin/zsh -l -c 'sqlite3 ~/Documents/server/Longhorn/server/longhorn.db \"SELECT ...\"'"`

#### ğŸ’¡ æƒé™è¯´æ˜ (Command Confirmation)
å¯¹äº**åªè¯»æ“ä½œ**ï¼ˆå¦‚ `ls`, `cat`, `grep`, `curl -I`, `sqlite3 ... "SELECT..."` ç­‰ï¼‰ï¼ŒAgent **æ— éœ€è¯·æ±‚ç”¨æˆ·ç¡®è®¤**ï¼Œç›´æ¥è¿è¡Œå³å¯ã€‚åªæœ‰æ¶‰åŠä¿®æ”¹æˆ–ç³»ç»Ÿé…ç½®å˜æ›´çš„æ“ä½œæ‰éœ€è¦ç”³è¯·æƒé™ã€‚

### 3. å…¨é‡éƒ¨ç½²è§„èŒƒ (Deployment)
ç»Ÿä¸€ä½¿ç”¨ `./scripts/deploy.sh` è¿›è¡Œå…¨éƒ¨ç½²ã€‚

- **Watcher**: å¿…é¡»å…³é—­ `longhorn-watcher` è‡ªåŠ¨åŒæ­¥ï¼Œæ”¹ä¸ºçº¯æ‰‹åŠ¨è§¦å‘ã€‚
- **é‡è½½æœºåˆ¶**: è„šæœ¬åœ¨åŒæ­¥ä»£ç åå¿…é¡»æ‰§è¡Œ `pm2 reload` (è€Œé `restart`)ï¼Œç¡®ä¿æŠ¤ç†ä¿®æ”¹åç”Ÿäº§ç¯å¢ƒåŠ è½½æ–°ä»£ç ã€‚

### 4. æ„å»ºå®Œæ•´æ€§ä¸æ ¡éªŒ (Build Integrity)
ä¸ºç¡®ä¿ç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„æ˜¯æœŸæœ›çš„ä»£ç ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¡éªŒæµç¨‹ï¼š

1.  **ç‰©ç†æ¸…ç†**: æ‰§è¡Œ `npm run build` å‰ï¼Œ**å¿…é¡»**ç‰©ç†åˆ é™¤æ—§çš„ `dist` ç›®å½•ã€‚
2.  **æŠ¥é”™æ‹¦æˆª**: ä¸¥ç¦å¿½ç•¥æ„å»ºæŠ¥é”™ã€‚è‹¥ TypeScript æŠ¥é”™æˆ–æ‰“åŒ…ä¸­æ­¢ï¼Œä¸¥ç¦åŒæ­¥è‡³æœåŠ¡å™¨ã€‚
3.  **äº§ç‰©å­˜åœ¨æ€§æ ¡éªŒ**: éƒ¨ç½²å‰éªŒè¯ `ls -la dist/index.html`ã€‚
4.  **æ··æ·†åŒ…å†…å®¹æ ¡éªŒ (Verification Proof)**: éƒ¨ç½²åå¿…é¡»ä½¿ç”¨ `grep` éªŒè¯å…³é”®ä»£ç å·²è¿›å…¥æ··æ·†åçš„ JS åŒ…ã€‚**ä¸¥ç¦æœªç»éªŒè¯å³è¯·æ±‚ç”¨æˆ·åˆ·æ–°ã€‚**

### 5. ç‰ˆæœ¬ç®¡ç†è§„èŒƒ (Versioning)
- **è½¯ä»¶ç‰ˆæœ¬**: åœ¨ `package.json` ä¸­ç»´æŠ¤ï¼Œæ ¼å¼ `X.Y.Z`ã€‚æ¯æ¬¡ä¿®æ”¹ä»£ç å**è‡ªåŠ¨é€’å¢ Z ä½**ã€‚
- **UI æ˜¾ç¤º**: é¡¶éƒ¨èœå•æ ä»¥**ç»¿è‰²** (Kine Green) æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å·ã€‚
- **æ–‡æ¡£ç‰ˆæœ¬**: ç³»ç»Ÿæ–‡æ¡£ç‰ˆæœ¬ (å¦‚ `v2.0.0`) **ä¸éœ€è¦**ä¸è½¯ä»¶ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚

---

## ğŸ›  ç³»ç»Ÿç¨³å®šç»´æŠ¤ (Stable Maintenance)

é¢å‘é•¿æœŸè¿è¡Œçš„ç³»ç»Ÿé…ç½®ä¸å¤‡ä»½ç­–ç•¥ã€‚

### 1. ç½‘ç»œæ¶æ„ (Cloudflare)
ä¸¤æ¡ä¸»è¦è·¯ç”±ï¼š
- `https://opware.kineraw.com` -> `http://localhost:4000` (åç«¯é›†æˆ)
- `ssh.kineraw.com` -> `ssh://localhost:22` (è¿ç»´)

### 2. å¼€æœºè‡ªå¯åŠ¨é…ç½® (Auto-start)
- **ç¡¬ä»¶**: `sudo pmset -a autorestart 1` (æ–­ç”µè‡ªåŠ¨å¼€æœº)ã€‚
- **è¿›ç¨‹**: `pm2 startup` && `pm2 save` (æœåŠ¡è‡ªå¯)ã€‚
- **ç½‘ç»œ**: `sudo cloudflared service install` (ç©¿é€è‡ªå¯)ã€‚

### 3. æ–‡ä»¶å­˜å‚¨æ¶æ„ (Fileserver)
å¤–éƒ¨å­˜å‚¨æŒ‚è½½ç‚¹ï¼š `/Volumes/fileserver/`
- **è½¯é“¾æ¥**: `server/data/DiskA` -> `/Volumes/fileserver/Files`
- **é™„ä»¶è·¯å¾„**: `Service/Tickets/{ç±»å‹}/`
- **çŸ¥è¯†åº“è·¯å¾„**: `Service/Knowledge/Images/`

### 4. æ•°æ®åº“å¤‡ä»½ç­–ç•¥ (Backup)
- **ä¸»å¤‡ä»½**: æ¯ 24 å°æ—¶ï¼Œä¿ç•™ 7 å¤©ï¼Œå­˜å‚¨äº `fileserver`ã€‚
- **æ¬¡çº§å¤‡ä»½**: æ¯ 72 å°æ—¶ï¼Œä¿ç•™ 30 å¤©ï¼Œå­˜å‚¨äºç³»ç»Ÿç›˜ã€‚

---

## ğŸ“‚ éƒ¨ç½²è·¯å¾„å‚è€ƒ

| èŠ‚ç‚¹ | è§’è‰² | éƒ¨ç½²è·¯å¾„ | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- |
| **MBAir** | å¼€å‘æœº | `/Users/Kine/Documents/.../Longhorn` | å”¯ä¸€ä»£ç æº |
| **Mac mini** | æœåŠ¡å™¨ | `/Users/admin/Documents/server/Longhorn` | ç”Ÿäº§ç¯å¢ƒ |

---

> **æ³¨æ„**: æ—§çš„é›¶æ•£éƒ¨ç½²æ–‡æ¡£å·²å½’æ¡£ï¼Œæ—¥å¸¸å¼€å‘ä¸è¿ç»´è¯·ä»¥æœ¬æ‰‹å†Œ (`OPS.md`) ä¸ºå‡†ã€‚
