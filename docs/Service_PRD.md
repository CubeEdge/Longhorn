# 产品服务闭环系统 - 需求文档 (PRD)

**版本**: 12.2.1
**状态**: 迭代中
**最后更新**: 2026-02-28 (Deployed v12.2.1)

---

## 1. 产品概述

### 1.1 系统定位与愿景

**Longhorn** 是 Kinefinity 的**产品服务闭环系统**，旨在构建以"客户服务"为核心的完整生态体系。

#### 核心定位

**从被动响应到主动赋能**
- ❌ 过去：被动接收问题、手工记录、Excel跟踪、经验难沉淀
- ✅ 现在：主动服务管理、智能协同、知识积累、数据驱动决策

**连接三方，形成闭环**

```
        ┌──────────────────────────────────────┐
        │         客户（终端用户）              │
        │    购买产品、使用产品、反馈问题       │
        └─────────┬──────────────┬─────────────┘
                  │              │
     ┌────────────┘              └────────────┐
     │ 直客渠道                    经销商渠道  │
     │ (直接联系Kine)            (通过经销商)  │
     ▼                                        ▼
┌─────────────────┐              ┌─────────────────┐
│  Kinefinity     │◄─ 协作/共享 ─┤  经销商         │
│  (服务中枢)     │              │  (服务延伸)     │
├─────────────────┤              ├─────────────────┤
│ 市场部│生产部   │              │ 一线支持        │
│ 服务  │维修     │              │ 经销商维修      │
│ 前端  │执行     │              │ 配件管理        │
└─────────────────┘              └─────────────────┘
         │
         │ 三种工单
         ├─────────────┬─────────────┐
         ▼             ▼             ▼
    咨询工单(K)   RMA返厂单      经销商维修单
                                   (SVC)
         │             │             │
         └─────────────┴─────────────┘
                       ▼
          ┌────────────┼────────────┐
          ▼            ▼            ▼
    工单管理    知识沉淀    数据洞察
```

#### 三大核心价值

**1. 服务闭环管理**
- 统一工单体系：咨询→RMA返厂→经销商维修，全流程追踪
- 智能协同：市场部、生产部、研发部、经销商无缝协作
- 数据透明：实时状态、物流追踪、费用结算自动化

**2. 知识体系构建**
- 问题→解决方案→知识沉淀
- 从个人经验到组织能力
- AI辅助：智能问答、自动分类、知识推荐

**3. 产品持续改进**
- 客户反馈→功能期望→产品迭代
- 问题趋势分析→质量改进
- 数据驱动：从经验决策到数据决策

### 1.2 服务驱动理念

#### 一切始于咨询工单

**咨询工单是系统的唯一入口**，客户的每一次接触都创建咨询工单，然后根据服务过程产生不同结果：

```
                    客户联系
                       │
                       ▼
              ┌────────────────┐
              │  创建咨询工单   │ ← 统一入口
              │   (Inquiry)    │
              └────────┬───────┘
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
    简单咨询        需要返修        功能建议
        │              │              │
        ▼              │              ▼
    解答关闭           │         记录Wishlist
                       │              │
          ┌────────────┴────────────┐ │
          ▼                         ▼ │
   创建RMA返厂单            创建经销商维修单
   (寄回总部)              (经销商本地处理)
          │                         │
          ▼                         ▼
     维修闭环                  维修闭环
          │                         │
          └─────────────┬───────────┘
                        │           │
        ┌───────────────┴───────┐   │
        ▼                       ▼   ▼
    知识沉淀                产品规划
        │                       │
        └──────────► 客户忠诚度 ◄┘
```

#### 四种服务产出

| 产出类型 | 工单转化 | 业务价值 | 系统支持 |
|---------|---------|---------|---------|
| **即时解答** | 咨询工单关闭 | 提升响应速度 | 知识库快速引用 |
| **RMA返厂** | 升级为RMA返厂单 | 产品修复、费用结算 | 全流程追踪、AI报价 |
| **功能期望** | 记录Wishlist | 产品迭代方向 | 投票统计、版本规划 |
| **知识沉淀** | 发布知识点 | 组织能力提升 | AI提取、审核发布 |

#### 服务优先级与 SLA 体系

> **P2 升级**：统一使用 P0/P1/P2 优先级体系，涵盖响应、诊断、维修、完结全流程 SLA。

**P0/P1/P2：统一服务优先级**

| 优先级 | 业务定义 | 触发条件 | MS 首响 | OP 诊断 | OP 维修 | 总承诺周期 |
|--------|---------|---------|--------|--------|--------|----------|
| **P0 紧急** | CRITICAL | VVIP客户、新机开箱即损(DOA)、剧组停机事故 | 2小时 | 4小时 | 24小时 | <36小时 |
| **P1 优先** | HIGH | VIP客户、经销商加急、核心功能失效 | 8小时 | 24小时 | 48小时 | 3工作日 |
| **P2 标准** | NORMAL | 标准客户、常规故障/咨询 | 24小时 | 48小时 | 5天 | 7工作日 |

**SLA 计算逻辑**：
- **初始化**：创建工单时，优先级默认等于客户 `service_tier` 对应的等级
- **计时重置**：当状态变更时，`node_entered_at` 更新为 `NOW()`，重新计算 `sla_due_at`
- **SLA 状态**：`normal` (正常) / `warning` (剩余<25%) / `breached` (已超时)
- **统计字段**：`breach_counter` 累计超时次数

**Loaner Gear（备机）触发逻辑**：
- **触发条件**：VVIP/机构客户 + P1优先维修（预估3个工作日）
- **系统提示**：创建RMA或报价确认时，系统提示“维修预估需3天，是否申请备机？”
- **状态字段**：`loaner_requested: boolean`，`loaner_status: enum(pending/approved/shipped/returned)`
- **初期实现**：手动处理（市场部协调），Phase 4后期自动化

### 1.3 三层工单模型

系统采用**三层工单模型**，清晰区分咨询、RMA返厂和经销商维修三种场景。

> **P2 升级：统一工单表设计**  
> 后端采用单表多态设计，通过 `ticket_type` 字段区分 inquiry/rma/svc 三种类型。  
> 新增字段：`current_node` (状态机节点), `priority` (P0/P1/P2), `sla_due_at`, `sla_status`, `participants` (协作者数组)。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            三层工单模型                                    │
│                                                                         │
│  ┌───────────────┐      ┌───────────────┐      ┌───────────────┐       │
│  │ 咨询工单 (K)   │      │ RMA返厂单     │      │ 经销商维修单   │       │
│  │               │      │               │      │  (SVC)        │       │
│  │ K2602-0001    │      │ RMA-D-2602-001│      │ SVC-D-2602-001│       │
│  ├───────────────┤      ├───────────────┤      ├───────────────┤       │
│  │ • 咨询解答    │      │ • 设备返厂    │      │ • 经销商维修  │       │
│  │ • 问题排查    │ 升级 │ • 检测诊断    │      │ • 配件消耗    │       │
│  │ • 远程协助    │─────▶│ • 维修执行    │      │ • 费用结算    │       │
│  │ • 技术支持    │      │ • 费用结算    │      │ • 经销商处理  │       │
│  │ • 投诉处理    │      │ • 物流跟踪    │      │               │       │
│  └───────────────┘      └───────────────┘      └───────────────┘       │
│       服务入口               RMA返厂层            经销商维修层           │
└─────────────────────────────────────────────────────────────────────────┘
```

**工单类型定义**：

| 工单类型 | ID格式 | 示例 | 说明 |
|---------|--------|------|------|
| **咨询工单** | KYYMM-XXXX | K2602-0001 | 咨询、问题排查等服务的统一入口 |
| **RMA返厂单** | RMA-{C}-YYMM-XXXX | RMA-D-2602-0015 | 设备返回Kinefinity总部维修，每台设备独立RMA号 |
| **经销商维修单** | SVC-D-YYMM-XXXX | SVC-D-2602-0001 | 经销商维修，不寄回总部 |

**编号规则**：
- YYMM：年份后两位 + 月份（如2602=2026年2月）
- XXXX：月度序号，0001-9999为十进制，超过9999自动转16进制(A000-FFFF)
- 每月序号重置，最大容量65535条/月
- RMA中的 {C} 为渠道代码：D=Dealer（经销商），C=Customer（直客）

**渠道代码**：
| 代码 | 含义 |
|------|------|
| D | Dealer (经销商) |
| C | Customer (直客) |


### 1.4 用户与服务职责

> **P2 升级：角色与权限模型**

#### 角色缩写与核心职责

| 缩写 | 全称 | 中文角色 | 核心职责与数据边界 |
|------|---------------------|---------|----------------------------------------------|
| **MS** | Marketing & Service | 市场/客服 | **全知全能 (Global Hub)**。负责客户沟通、报价、收款、物流指令。拥有 CRM、IB、工单的全局读写权限。 |
| **OP** | Operations | 生产运营 | **受限执行 (Restricted Doer)**。负责收发货、维修、备件。对 CRM/IB 默认不可见，仅通过工单获得“穿透式”技术视图。 |
| **RD** | R&D | 研发 | **受限专家 (Restricted Expert)**。不持有工单，仅通过 @ 协作提供技术建议。对 CRM/IB 默认不可见。 |
| **GE** | Finance | 财务 | **资金监管 (Gatekeeper)**。负责确认收款、库存审计。 |
| **DL** | Dealer | 经销商 | **外部伙伴 (Partner)**。Phase 1 由 MS 代理录入；Phase 2 自行登录。仅见私有数据。 |

#### 数据安全与权限架构

**核心原则：隔离与穿透**

- **数据隔离 (Data Silo)**：OP/RD 默认无权访问 CRM（客户/经销商列表）及 IB（全量资产库）
- **按需穿透 (Just-in-Time Access)**：OP/RD 只有在成为工单的 Assignee 或 Participant 时，才获得该工单关联资产的只读权限

**视图分级 (View Scoping)**：

| 视图类型 | 适用角色 | 可见字段 | 隐藏字段 |
|---------|---------|---------|----------|
| **商业视图 (Commercial View)** | MS | 完整 IB 信息，含 Sold To、合同号、开票日及价格 | - |
| **技术视图 (Technician View)** | OP/RD | 序列号、固件版本、生产日期、过往维修履历 | 价格、客户联系方式、经销商渠道 |

#### 协作机制：@Mention 与参与者

**提及即邀请 (Mention = Invite)**：@Mention 是驱动权限授予的核心交互。

- **前端交互**：用户在评论框输入 `@陈高松` 并发送
- **后端逻辑**：
  1. 检测到 @ 符号，校验被提及用户是否已在 `tickets.participants`
  2. 若不在，自动追加到参与者数组
  3. 被提及用户立即获得该工单及关联资产的受邀可见权限
  4. 触发高优先级通知

---

#### 1.4.1 内部团队

**市场部 - 服务前端**

| 人员 | 职责区域 | 服务场景 |
|-----|---------|---------|
| Effy | 海外市场 | 处理海外工单、协调经销商、客户沟通 |
| 李雨健 | 国内市场 | 处理国内工单、直接对接客户 |
| Sherry | 负责人 | 审批异常、查看报表、处理升级 |
| Cathy | 负责人 | 审批异常、查看报表、处理升级 |

**案例 - Effy处理海外工单**：
> 1. 收到ProAV提交的工单推送 (iOS)
> 2. 快速查看问题描述，判断优先级
> 3. 查询知识库，回复处理建议
> 4. 需要RMA返厂 → 协调RMA流程
> 5. 跟踪物流状态，通知经销商收货时间
> 6. 维修完成 → 确认结算，关闭工单

**生产部 - 服务执行**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| 黄碧珊 | 负责人 | 分配任务、审核报告、处理异常 |
| 陈高松/张工/张平娇 | 维修技师 | 执行维修、填写分析报告 |

**研发部 - 服务改进**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| 吴琪萌 | 产品 | 分析问题趋势、评估功能期望、规划产品路线 |
| 时春杰 | 软件 | 技术可行性评估、固件开发 |

**案例 - 研发部处理功能期望**：
> 1. 查看功能期望列表，按投票数排序
> 2. "快速启动" - 23个客户请求，AI建议高优先级
> 3. 评估技术可行性，添加评估意见
> 4. 纳入固件8025规划
> 5. 开发完成，发布新固件
> 6. 系统自动推送给相关客户："您期望的快速启动功能已发布"

**管理层 - 服务监督**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| Jihua | CEO | 查看周报/月报、处理重大异常 |
| Sherry | 财务 | 结算审核、欠款管理 |

> 注：Cathy为市场部负责人，见上方市场部角色

**案例 - 管理层处理紧急问题**：
> 1. 收到P1紧急工单推送 (App)
> 2. 某批次产品出现批量死机问题
> 3. 立即协调研发部分析原因
> 4. 决策：召回该批次 or 发布紧急固件修复
> 5. 跟踪处理进度，确保闭环


#### 1.4.2 经销商

**经销商 (Dealer)** - 服务的延伸和中介

##### 经销商分级特点

**一级经销商**：
- 区域分销商，销售能力强
- 有配件库存，定期补货
- 可处理大部分不涉及刷程序、清灰的维修
- 复杂问题需寄回总部

**二级经销商**：
- 有维修能力但无备件库存
- 需临时发货配件后自行维修
- 复杂问题需寄回总部

**三级经销商**：
- 无维修能力、无备件库存
- 所有问题均需寄回总部维修

##### 典型经销商示例

| 分级 | 经销商 | 地区 | 配件库存 | 维修能力 | 结算方式 | 使用端 |
|-----|-------|------|---------|---------|---------|-------|
| **一级** | ProAV | 英国/部分欧洲 | 有 | 强 | 定期结算 | Web |
| **一级** | Gafpa | 大部分欧洲 | 有 | 强 | 定期结算 | Web |
| **一级** | 1SV | 美国 | 有 | 强 | 定期结算 | Web |
| **一级** | EU Office | 欧洲(补充) | 有 | 强 | 定期结算 | Web |
| **二级** | DP Gadget | 东南亚 | 无 | 有 | 单次开PI | Web |
| **三级** | RMK | 澳洲 | 无 | 无 | 单次开PI | Web |

> 注：经销商暂时仅支持Web端，未来版本考虑iOS端

##### 维修类型划分

**经销商可自行处理** (一级/二级)：
- 更换前部/Back/SDI口/RS口板/TF卡
- 更换HDA板、Video口、风扇、按键板
- 更换卡农口模块、USB-C/3.5mm模块

**必须寄回深圳处理**：
- MC板更换（需要刷程序）
- 问题不明确的复杂故障
- 清灰（需要洁净环境）
- 老机器无明确维修说明
- 三级经销商的所有维修需求

##### 业务案例

**案例 - 一级经销商(ProAV)**：
> 1. 客户反馈Edge死机问题
> 2. ProAV创建咨询工单，引导客户排查
> 3. 确认需更换SDI模块 → 使用库存配件经销商维修
> 4. 库存消耗记录到系统，月底统一结算
> 5. 库存低于安全线 → 系统自动提醒补货

**案例 - 三级经销商(RMK)**：
> 1. 澳洲客户反馈问题
> 2. RMK创建咨询工单，无法本地处理
> 3. 协调客户寄回深圳总部
> 4. 总部维修完成后寄回
> 5. RMK全程跟踪状态，同步给客户

#### 1.4.3 终端客户

**终端客户 (End Customer)**
| 身份 | 服务场景 | 系统交互 |
|-----|---------|---------|
| 产品购买者 | 咨询使用问题、反馈故障、提出期望 | 通过经销商或市场部联系 |
| KOL/媒体 | 测评问题、功能建议 | 同上，优先级可能更高 |

**案例**：
> 客户Max购买了MAVO Edge 8K，使用中遇到死机问题。
> - 联系经销商ProAV反馈问题
> - 经销商创建咨询工单，引导排查
> - 排查无效 → 升级为RMA返厂单
> - 维修完成后，Max收到取件通知
> - Max在服务中提到"希望支持快速启动" → 记录为功能期望

#### 1.4.4 用户与客户属性
虽然本系统的用户有终端客户和经销商，但是并非等同于系统里面的客户。对于客户而言，除了常规地址等联系信息，其属性还具有：

客户类型：终端客户 
购买渠道：直销或者经销商（关联系统内的经销商档案）
等级：Standard / VIP / VVIP	决定排队优先级的。
行业标签：租赁 / 广电 / 个人 / 会议 等

客户类型说明：
| 角色范围 | 示例人物/组织 | 对应 account_type | 说明 |
|----------|----------------|-------------------|------|
| 终端客户 / KOL / 媒体 | 购买产品的最终用户、测评人员 | END_USER | 通过官网或经销商购买设备的最终使用者 |
| 机构大客户 | 租赁公司、制作公司、教育机构、广电等 | CORPORATE | 非经销商但享有特殊服务策略的大客户 |
| 经销商（一级/二级/三级） | ProAV、Gafpa、1SV、EU Office、DP Gadget、RMK 等 | DEALER | 负责区域销售和一部分售后服务的渠道伙伴 |
| 内部/合作伙伴 (Internal/Partner) | 比如友商、公司营销人员、供应商、媒体等等 |可能借用 | 国内外都有

> 说明：
> - 角色表用于描述「人/组织在业务流程中的职责」，account_type 用于数据和权限层面的分类，两者一一对应但维度不同。
> - 同一组织在不同系统中可以拥有多个登录账号（如内部账号 + 经销商账号），由 account_type 区分在服务系统中的身份。


### 1.5 返修管理体系

> **重要区分**：返修涉及多种场景，需要区分处理流程和结算方式。

```
返修场景
├── A. 客户返修（寄回总部）
│   ├── A1. 国内客户直接寄修
│   └── A2. 海外客户通过经销商寄修，也可能直接寄回总部维修
│
├── B. 经销商维修（不寄回总部）
│   ├── B1. 一级经销商：使用库存配件维修
│   └── B2. 二级经销商：申请配件后维修
│
└── C. 生产问题/内部样机
    └── 内部流程，不涉及客户收费
```

**场景与收费对照**：

| 场景 | 维修地点 | 配件来源 | 收费对象 | 结算方式 |
|-----|---------|---------|---------|---------|
| A1 国内客户寄修 | 深圳总部 | 总部库存 | 客户（过保） | 单次PI |
| A2 海外客户寄修 | 深圳总部 | 总部库存 | 客户（过保） | 单次PI |
| B1 一级经销商维修 | 经销商 | 经销商库存 | 客户（过保） | 月度/季度结算 |
| B2 二级经销商维修 | 经销商 | 临时发货 | 客户（过保） | 单次PI |
| C 生产问题/样机 | 深圳总部 | 总部库存 | 内部（无） | 不收费 |


#### 1.5.1 维修配件SKU体系

> 数据来源: `input docs/维修配件SKU&价格单.xlsx`

**SKU格式**: `S` + `物料ID`（部分老型号配件无SKU编码）

**价格支持**: CNY / USD / EUR 三种货币

**配件分类概览** (共74个配件):

| 分类 | 配件数量 | 价格区间(USD) |
|-----|---------|--------------|
| EAGLE EVF | 3 | $68 - $586 |
| MAVO Edge/mark2 | 29 | $19 - $2499 |
| TERRA/MAVO S35/LF | 14 | $39 - $1599 |
| 监看 | 9 | $69 - $299 |
| 转接卡口 | 8 | $49 - $399 |
| KineBACK | 3 | $109起 |
| KineMAG Nano | 1 | $79 |
| UPS底座 | 1 | - |
| 供电 | 4 | - |
| 线缆 | 2 | - |

#### 完整配件SKU清单

> 完整的SKU清单和定价信息不在本PRD中维护，由市场部/生产部维护的附件文档《Service Parts SKU & Pricing》为唯一来源。本PRD只说明字段结构和使用规则，下面的表格仅为示例，**不是完整清单**。

**字段结构示例**：

| 字段 | 说明 |
|------|------|
| SKU | 唯一配件编码，如 `S1-019-003-01` |
| name | 配件名称，如 `Edge 8K Sensor` |
| currency/price | 多币种价格（CNY/USD/EUR），与官网价格体系一致 |

**示例行（EAGLE EVF）**：

| SKU | 配件名称 | CNY | USD | EUR |
|-----|---------|-----|-----|-----|
| S2-119-012-01 | EAGLE 主板 (示例) | ¥982 | $187 | €187 |

#### 1.5.2 产品族群与配件兼容规则

为避免产品生命周期和配件兼容关系被混用，服务系统在产品层面引入 4 个具有不同服务逻辑的族群，用于驱动工单创建、配件候选列表和维修报价规则。

**A 类：在售电影摄影机 (Current Cine Cameras)**
- 范围：当前主力销售和维护的电影摄影机，如 MAVO Edge 8K / MAVO Edge 6K / MAVO mark2 等。
- 服务特性：
  - 在工单创建和产品选择界面中默认优先展示。
  - 配件候选列表优先显示新一代专属配件（如 Edge/mark2 专用兔笼、KineMAG Nano 存储卡等）。

**B 类：存档/历史机型 (Archived Cine Cameras)**
- 范围：已停产但仍提供维修服务的机型，如 MAVO LF、MAVO S35、Terra 4K/6K 等。
- 服务特性：
  - 前端需折叠或明确标记为「历史机型」，避免干扰新用户选型，但仍支持创建工单和返修。
  - 仅关联老一代专属配件（如 KineMAG SSD (SATA)、老款手柄等），不暴露新一代专属配件。

**C 类：电子寻像器 (e-Viewfinder)**
- 范围：独立的电子取景系统，如 Eagle SDI / Eagle HDMI 等电子寻像器。
- 服务特性（关键）：
  - 创建与 C 类产品相关的咨询工单 / RMA 时，**必须填写「宿主设备信息 (Host Device)」**：
    - **宿主类型** (`host_device_type`): Enum
      - `KINEFINITY_CAMERA`: Kinefinity 电影机
      - `THIRD_PARTY_CAMERA`: 第三方相机
    - **宿主品牌** (`host_brand`): Enum
      - Kinefinity / Arri / Sony / Canon / Blackmagic / RED / Panasonic / Nikon / Z CAM / Other
    - **宿主机型** (`host_model`): String
      - 例如「MAVO Edge 6K」或「Canon C400」或「Sony FX6」
    - **连接方式** (`connection_type`): Enum
      - SDI / HDMI / Other
  - **字段级定义的必要性**：
    - 这些是**结构化数据**，而非备注文本，确保后续在质量仪表盘中可以分析出"Sony FX6 兼容性问题高发"这样的结论
    - 前端创建工单时，根据 `product_family = C` 自动显示宿主设备信息录入界面
    - 数据库字段设计需预留这些枚举类型，避免后期改造成本
  - 流程分流：
    - 如宿主类型 = 第三方相机，则工单默认归类为「兼容性排查」场景，供研发/产品集中分析第三方兼容性问题；
    - 如宿主类型 = Kinefinity 电影机，则按常规硬件问题进入 RMA / 经销商维修流程。

**D 类：通用配件 (Universal Accessories)**
- 范围：严格限定为跨代通用、与具体机型兼容性弱相关的配件，例如：
  - GripBAT 系列电池等标准供电配件；
  - Magic Arm / Dark Tower 等安装类通用附件。
- 约束：
  - D 类配件在创建工单时可以不强制绑定具体机型，但系统仍鼓励填写实际关联机型以便后续分析。
  - **KineMON 系列监视器仅保证与 Kinefinity 电影摄影机配合使用，不属于 D 类通用配件**；在第三方机型场景下，系统需提示兼容性风险，不将其视作「通用显示器」。

**核心业务规则**

1. **存储卡隔离规则**
   - KineMAG Nano：仅当产品属于 A 类（Edge/mark2 系列）时，才作为配件候选出现；
   - KineMAG SSD (SATA)：仅当产品属于 B 类（MAVO LF/Terra 系列）时，才作为配件候选出现；
   - 目的：防止经销商/内部选错卡型导致备件发错，降低返工和物流成本。

2. **电子寻像器 + 宿主设备规则 (Eagle 兼容性)**
   - 当产品族群 = C 且宿主类型 = 第三方相机时：
     - 工单自动标记为「兼容性排查」，在统计报表和研发视图中可单独拉出；
     - 有利于识别「第三方兼容性问题」趋势，而不与常规硬件故障混在一起。
   - 当产品族群 = C 且宿主类型 = Kinefinity 电影机时：
     - 视为常规硬件/稳定性问题，走标准 RMA / 经销商维修流程，无需特殊标记。

> 以上产品族群与配件规则，作为服务系统的**业务约束层**，为前端产品选择、配件候选过滤和报表统计提供统一依据，避免「在售/历史机型」「通用/专用配件」混用导致的误选和沟通成本。

#### 1.5.3 运费管理

**区域默认运费表**:
| 区域 | 默认运费(USD) | 默认运费(EUR) | 说明 |
|-----|--------------|--------------|------|
| 英国 | $29 | €27 | ProAV |
| 欧洲大陆 | $35 | €32 | Gafpa, EU Office |
| 美国 | $45 | - | 1SV |
| 加拿大 | $50 | - | Cinetx |
| 东南亚 | $35 | - | DP Gadget |
| 澳洲 | $55 | - | RMK |
| 国内 | ¥30 | - | 国内客户 |

**运费规则**:
- PI生成时根据收货地区自动填充默认运费
- 工作人员可手动修改运费（如特殊快递、加急等）
- 在保维修：Kine承担运费
- 过保维修：客户/经销商承担运费

#### 1.5.4 维修费用规则

**在保维修**:
- 配件费用: 免费
- 人工费用: 免费
- 返回运费: Kine承担

**过保维修**:
- 配件费用: 按SKU价格单收取
- 人工费用: 根据维修复杂度收取
- 运费: 客户承担（按区域默认，可调整）

**经销商结算**:
- 一级经销商: 预先发放配件库存，定期结算使用量
- 二级经销商: 临时开PI发货，单次结算

#### 1.5.5 保修计算引擎 (Warranty Engine)

> **P2 升级**：系统采用 "瀑布流 (Waterfall)" 逻辑自动计算保修期起始日。

**计算优先级**：

| 优先级 | 条件 | 说明 |
|-------|------|------|
| 1 (IoT) | `activation_date` 存在 | 联网激活时间为准（未来 IoT 设备） |
| 2 (人工) | `sales_invoice_date` 存在 | 有发票凭证，以发票日期为准 |
| 3 (注册) | `registration_date` 存在 | 官网注册日期为准 |
| 4 (直销) | `sales_channel == DIRECT` | 按 ship_date + 7天 |
| 5 (兜底) | 均为 NULL | 按 `ship_to_dealer_date` + 90天 |

**计算结果字段**：
- `warranty_source`: 追踪保修期按哪个标准计算（IOT_ACTIVATION / INVOICE_PROOF / REGISTRATION / DIRECT_SHIPMENT / DEALER_FALLBACK）
- `warranty_start_date`: 最终计算出的保修起始日
- `warranty_end_date`: 保修截止日
- `warranty_status`: ACTIVE / EXPIRED / VOID

### 1.6 完整服务案例

#### 案例1：从咨询到返修到知识沉淀

```
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 1: 客户联系                                                          │
│   客户Max联系经销商ProAV："我的Edge 8K拍摄4K 50fps时会死机"              │
│   ProAV创建咨询工单 K2602-0001                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 1-2: 问题排查                                                        │
│   ProAV查询知识库，引导Max排查：                                         │
│   - 检查固件版本 → 已是最新8023                                          │
│   - 检查工作温度 → 正常范围                                              │
│   - 尝试恢复出厂设置 → 问题依旧                                          │
│   排查无效，确认需要RMA返厂                                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 2: 升级为RMA返厂单                                                   │
│   咨询工单 K2602-0001 → 升级为RMA返厂单 RMA-D-2602-0001                  │
│   系统AI预估：SDI模块故障(65%) / 主板问题(25%)                           │
│   预估费用：$98 - $314                                                   │
│   客户确认预估价格，寄出设备                                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 5: 生产部收货检测                                                    │
│   生产部收到设备，开始检测                                                │
│   发现：主板有轻微腐蚀，可能是潮湿环境导致                                │
│   实际维修方案：更换主板 + 清洁                                          │
│   实际费用：$799 (超预估，触发异常流程)                                   │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 5-6: 异常确认                                                        │
│   市场部通知客户实际情况和费用变更                                        │
│   客户确认继续维修                                                        │
│   生产部继续维修                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 8: 维修完成                                                          │
│   维修完成，填写维修报告                                                  │
│   AI建议：此案例可沉淀为知识点 "潮湿环境导致主板腐蚀"                    │
│   市场部确认，发布到知识库                                                │
│   设备寄回客户                                                            │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 12: 服务闭环                                                         │
│   客户收到设备，确认问题解决                                              │
│   RMA返厂单 RMA-D-2602-0001 关闭                                         │
│   咨询工单 K2602-0001 完成，记录处理时长和结果                            │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 案例2：从功能期望到产品发布到客户推送

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 收集阶段 (多次服务中积累)                                                 │
│   咨询工单 K2502-0089: 客户A说"希望支持快速启动"                          │
│   咨询工单 K2502-0156: 客户B说"开机太慢了，能不能加快？"                   │
│   咨询工单 K2602-0012: 客户C说"快速启动对拍摄很重要"                       │
│   ...共23个客户提出类似需求                                               │
│   AI自动识别并合并为功能期望 FR-2502-0089                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 评估阶段                                                                  │
│   研发部查看功能期望池                                                    │
│   FR-2025-0089 "快速启动" - 投票数23，AI建议高优先级                     │
│   技术评估：可行，需要2周开发                                             │
│   决策：纳入固件8025规划                                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 开发阶段                                                                  │
│   研发部开发快速启动功能                                                  │
│   测试验证                                                                │
│   准备发布                                                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 发布阶段                                                                  │
│   固件8025发布                                                            │
│   系统自动匹配：FR-2025-0089 的target_version = 8025                     │
│   状态更新：已规划 → 已发布                                               │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 推送闭环                                                                  │
│   系统查找关联的23个客户                                                  │
│   批量推送邮件 + App通知：                                                │
│   "您期望的快速启动功能已在固件8025中发布！"                              │
│   客户收到推送，感受到被重视 → 忠诚度提升                                 │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 系统功能模块

> **设计理念**：按照用户的工作性质分模块，而非按角色分入口。

系统采用**三层架构**，清晰区分「作业」「知识」「档案」三类功能：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          系统功能三层架构                                 │
│                                                                         │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐  │
│  │  服务作业台        │  │  技术知识支撑      │  │  档案和基础信息    │  │
│  │  (Workbench)      │  │  (Tech Hub)       │  │  (Archives)       │  │
│  ├───────────────────┤  ├───────────────────┤  ├───────────────────┤  │
│  │ 处理每天变动的     │  │ 获取解决能力的     │  │ 管理基础资源       │  │
│  │ 工单（动态作业）   │  │ 知识中心           │  │ （基石数据库）     │  │
│  ├───────────────────┤  ├───────────────────┤  ├───────────────────┤  │
│  │ • 咨询工单        │  │ • Tech Hub │  │ • 客户档案         │  │
│  │ • RMA返厂单       │  │ • 智能问答(Bokeh) │  │ • 设备资产         │  │
│  │ • 经销商维修单    │  │ • 公告与培训      │  │ • 物料与价目       │  │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.1 服务作业台 (Workbench)

> **客服和工程师的一线战场**：处理每天变动的工单。

#### 2.1.1 咨询工单处理

**功能入口**：`/workbench/inquiry-tickets`

**核心功能**：

| 功能 | 说明 | 角色权限 |
|-----|------|----------|
| 工单列表与筛选 | 按状态、优先级、负责人筛选 | 市场部(全部)、经销商(自己客户) |
| 工单详情与回复 | 查看完整沟通历史、添加回复 | 市场部、经销商 |
| 知识库快速引用 | 从知识库拖拽内容到回复框 | 市场部、经销商 |
| 转RMA/维修单 | 判断需要维修时升级工单 | 市场部、一级经销商 |
| 客户上下文 | 自动显示客户历史、设备信息 | 市场部(全部)、经销商(自己客户) |

**典型场景 - 经销商处理咨询**：
```
John 发邮件给 ProAV: "Edge 8K拍摄4K 50fps时会死机"
    ↓
ProAV 在【服务作业台】看到新咨询工单 K2602-0005
    ↓
点击工单，右侧自动显示：
  • 客户上下文：John, MAVO Edge 8K (ME_207890), 在保至2027-03-15
  • 历史工单：2个（均已解决）
  • AI建议：检查固件版本、查看KB-0089
    ↓
ProAV 查询知识库，找到相关排查步骤
    ↓
拖拽知识库内容到回复框，发送给John
    ↓
排查无效 → 点击「转为RMA」
    ↓
系统自动生成 RMA-D-2602-0010，跳转到RMA详情页
```

#### 2.1.2 RMA返厂单处理

**功能入口**：`/workbench/rma-tickets`

**核心功能**：

| 功能 | 说明 | 角色权限 |
|-----|------|----------|
| RMA创建 | 从咨询升级 / 直接创建 | 市场部、经销商 |
| 设备资产自动关联 | 输入SN码自动查询保修状态 | 所有 |
| 保修状态判定 | 自动判定保内/保外，计算费用 | 系统自动 |
| 备件调用与报价 | 从物料库选择配件，自动计算价格 | 市场部、生产部 |
| 维修流程跟踪 | 物流→收货→检测→维修→发货 | 市场部、生产部 |
| 异常审批 | 超预估费用需客户确认 | 市场部审批 |

**典型场景 - 市场部处理RMA**：
```
【服务作业台】收到新RMA RMA-D-2602-0010
    ↓
打开RMA详情页，系统自动去【设备资产】里查SN码：
  • MAVO Edge 8K (ME_207890)
  • 购买日期：2026-01-05
  • 保修状态：在保（还有13个月）
  • 历史维修：无
    ↓
生产部收货，开始检测
    ↓
发现：主板有腐蚀，需更换主板
    ↓
点击「添加备件」，从【物料与价目】选择：
  • S3-800-002-01 Edge主板 $799
  • 因在保，客户价格 $0
    ↓
维修完成，状态更新为「待发货」
    ↓
John 的【客户档案】里，这台机器的记录下多了一行维修历史
```

##### 2.1.2.1 经销商RMA提交流程

经销商申请返厂时，可批量添加多台设备（购物车模式），提交时系统为每台设备生成独立RMA号：

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 第一步：购物车模式                                                        │
│                                                                         │
│   经销商ProAV添加返厂设备：                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ [✓] ME8K_SN001  MAVO Edge 8K   问题：死机重启                    │   │
│   │ [✓] ME6K_SN002  MAVO Edge 6K   问题：SDI无输出                   │   │
│   │ [✓] TER_SN003   Terra 4K       问题：开机无反应                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                          [ 提交返厂申请 ]                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 第二步：提交瞬间（后端处理）                                              │
│                                                                         │
│   系统为每台设备生成独立RMA号：                                           │
│   • ME8K_SN001 → RMA-D-2602-0001                                       │
│   • ME6K_SN002 → RMA-D-2602-0002                                       │
│   • TER_SN003  → RMA-D-2602-0003                                       │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 第三步：装箱单 (Packing Slip) 强制生成                                      │
│                                                                         │
│   "提交成功！请打印以下清单放入箱内："                                     │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ 装箱单 (Packing Slip)                                           │   │
│   │ ─────────────────────────────────────────────────────────────  │   │
│   │ RMA编号        产品型号           序列号        故障描述         │   │
│   │ ─────────────────────────────────────────────────────────────  │   │
│   │ RMA-D-2602-0001  MAVO Edge 8K  ME8K_SN001  死机重启             │   │
│   │ RMA-D-2602-0002  MAVO Edge 6K  ME6K_SN002  SDI无输出            │   │
│   │ RMA-D-2602-0003  Terra 4K      TER_SN003   开机无反应            │   │
│   │                                                                 │   │
│   │ 发件人: ProAV UK                                                │   │
│   │ 收件人: Kinefinity 深圳总部                                      │   │
│   │ 寄出日期: _____________                                         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                    [ 下载PDF ] [ 打印清单 ]                              │
│                                                                         │
│   ⚠️ 重要提醒：                                                          │
│   • 请务必打印此装箱单并放入包裹内！                                       │
│   • 仓库收货依靠此单匹配RMA号，缺少将导致延误处理                          │
└─────────────────────────────────────────────────────────────────────────┘
```

##### 2.1.2.2 工单创建交互 2.0: 统一创建弹窗

响应用户反馈，系统重构了工单创建交互，引入了全局统一的 `TicketCreationModal`：

*   **一致性**: 不论是咨询、RMA 还是经销商维修，均在同一 UI 弹窗内完成，保持了视觉和操作的高度一致。
*   **草稿持久化**: 集成 LocalStorage 自动保存机制，用户关闭弹窗或刷新页面后，再次打开可一键恢复未填写的草稿。
*   **媒体即时上传**: 支持拖拽上传图片和视频，实时生成缩略图预览。
*   **SN码OCR识别** (Phase 2优化):
    - **功能目标**: 在移动端或Web端上传机身照片时，自动识别设备贴纸上的序列号（SN码）并填入表单
    - **使用场景**:
      - 经销商/客户拍摄设备照片上传时，系统自动提取SN码
      - 避免手动输入错误导致的"保修状态判定错误"
    - **交互流程**:
      1. 用户上传设备照片
      2. 系统后台OCR识别SN码（如识别到多个编码，优先提取以机型代码开头的序列号）
      3. 自动填充到"序列号"字段，用户可手动修正
      4. 系统自动查询保修状态并显示
    - **技术方案**: 集成OCR API（如百度OCR、腾讯OCR等）或自训练模型
    - **优先级**: Phase 2交互优化，减少输入错误率

#### 2.1.3 经销商维修单处理

**功能入口**：`/workbench/dealer-repairs`

**核心功能**：

| 功能 | 说明 | 角色权限 |
|-----|------|----------|
| 维修单创建 | 经销商提交 / 市场部代创建 | 一级经销商、市场部 |
| 备件库存检查 | 调用【物料与价目】查看库存 | 一级经销商 |
| 价格计算 | 自动判定保内/保外价格 | 系统自动 |
| 备件消耗记录 | 使用库存配件，自动扣减 | 一级经销商 |
| 维修完成记录 | 填写维修内容，关闭维修单 | 一级经销商 |

**典型场景 - 一级经销商经销商维修**：
```
ProAV客户报告Edge SDI无输出
    ↓
ProAV判断：可使用库存配件经销商维修
    ↓
在【服务作业台】创建【经销商维修单】SVC-D-2602-0001
    ↓
系统自动去【物料与价目】查：
  • S1-011-013-01 SDI模块
  • ProAV库存：3个
  • 保外价格：$69
  • 客户在保，价格$0
    ↓
ProAV自行维修，点击「使用配件」
    ↓
系统自动：
  • 扣减ProAV库存：3 → 2
  • 记入月度结算
  • 更新客户维修历史
    ↓
维修完成，SVC-D-2602-0001关闭
```

#### 2.1.4 工单协作功能

**通用于所有工单类型**：

##### 2.1.1.1 评论与跟进

| 功能 | 说明 |
|-----|------|
| 内部评论 | @同事协作，仅内部可见 |
| 跟进提醒 | 自动通知被@人员 |
| 评论可见性 | 支持内部/客户可见切换 |

##### 2.1.1.2 附件管理（图片/视频）

**上传限制**：

| 文件类型 | 单文件限制 | 单工单限制 | 说明 |
|---------|-----------|-----------|----- |
| 图片 | 6 MB | 5 张 | 支持 JPG/PNG/HEIC |
| 视频 | 50 MB | 2 个 | 支持 MP4/MOV |

**待讨论**：
- [ ] 是否需要自动压缩？(图片压缩到2MB以下？)
- [ ] 视频是否需要转码？(统一转为H.264 MP4？)
- [ ] 是否需要更大的视频限制？(如通过分片上传支持500MB?)

**存储方案**：

| 方案 | 说明 | 优缺点 |
|-----|------|----------|
| **方案A: 本地存储**(当前) | `server/data/issue_attachments/{issue_id}/{filename}` | 优：简单、无额外成本<br>缺：容量受限、无CDN加速 |
| **方案B: 对象存储**(待讨论) | 阿里云OSS / AWS S3 | 优：无限容量、CDN加速、更安全<br>缺：额外成本、需要配置 |

**访问控制**：

需求：
- 工单附件仅限有权限的用户访问
- 不能通过猜测URL直接下载

方案：
1. **Token验证**: 访问附件需要有效的JWT Token
2. **签名URL** (如用对象存储): 生成有时效的签名链接
3. **代理下载**: 通过API代理下载，验证权限后返回文件

**预览方式**：
- 图片: 缩略图预览 + 原图查看
- 视频: 内嵌播放器 (HTML5 Video)
- iOS: 支持相册选取、拍照上传

##### 2.1.1.3 状态流转

| 功能 | 说明 |
|-----|------|
| 可视化状态机 | 展示工单当前状态和可执行操作 |
| 自动推进流程 | 根据规则自动执行下一步骤 |

##### 2.1.1.4 通知提醒

| 通知渠道 | 使用场景 |
|---------|----------|
| 邮件 | 工单状态变更、重要提醒 |
| App推送 | 实时通知(iOS/Android) |
| 企业微信 | 内部团队协作 |

##### 2.1.1.5 历史追溯

| 功能 | 说明 |
|-----|------|
| 完整操作日志 | 记录谁在什么时间做了什么 |
| 变更对比 | 支持查看字段修改前后对比 |

### 2.2 技术知识支撑 (Tech Hub)

> **获取解决能力的知识中心**：查找如何修、如何回、产品参数。

#### 2.2.1 Tech Hub（技术百科）

> 参考现有知识库：EAGLE知识库.xlsx、Knowledge base_Edge.xlsx、固件Knowledge Base.xlsx

**功能入口**：`/tech-hub/wiki`

##### 2.2.1.1 内容组织与分类体系

**组织结构 (按ABCD产品族群)**:

```
Tech Hub
├── A类: 在售电影摄影机 (Current Cine Cameras)
│   ├── MAVO Edge 8K
│   ├── MAVO Edge 6K
│   ├── MAVO Mark2 LF
│   └── MAVO Mark2 S35
│
├── B类: 存档/历史机型 (Archived Cine Cameras)
│   ├── MAVO LF
│   ├── MAVO S35
│   ├── Terra 4K
│   └── Terra 6K
│
├── C类: 电子寻像器 (e-Viewfinder)
│   ├── Eagle SDI
│   └── Eagle HDMI
│
├── D类: 通用配件 (Universal Accessories)
│   ├── GripBAT系列
│   ├── Magic Arm
│   ├── Dark Tower
│   ├── KineBAT
│   └── 线缆配件
│
└── 通用知识(跨产品)
    ├── 固件升级指南
    ├── 保修政策
    └── 服务流程说明
```

**知识类型**:

| 分类 | 说明 | 示例 |
|-----|------|------|
| **FAQ** | 常见问题与标准答案,区分内外部回答 | Eagle HDMI是否支持3D LUT导入? |
| **Troubleshooting** | 现象→多步骤排查流程 | 屏幕不亮→检查供电→检查开关→更换线缆 |
| **兼容性列表** | 设备/配件兼容性测试结果 | Eagle HDMI + Sony FX6 + 1080p 50fps = ✓ |
| **固件知识** | 版本差异、新功能、已知问题 | 8023固件新增Uncompressed RAW |
| **问题案例库** | 历史问题详细记录与解决方案 | Edge 8K死机案例 + 解决方法 |
| **维修手册** | 内部维修指南(仅内部) | 更换Sensor步骤 |

**问题分类维度** (针对A/B类摄影机):

| 问题大类 | 问题小类 |
|---------|---------|
| **稳定性** | 无法开机、死机、画面异常、温度异常 |
| **素材** | 横条/白线/红点、色彩异常、素材号重复、录制异常 |
| **监看** | KineMON无画面、画面异常、功能BUG、触屏、SDI、颜色 |
| **SSD** | FLUSH、无法识别 |
| **音频** | 音频不完整、杂音/噪声/电流声 |
| **兼容性** | 第三方设备兼容问题 |
| **时码** | 时码显示/同步问题 |
| **硬件/结构** | ND、灰尘、风扇、人为损坏 |



##### 2.2.1.2 知识条目结构

**核心字段集**:
- **基本信息**: `title`, `slug`, `summary`, `content`, `tags`
- **分类属性**: `category`, `subcategory`, `product_line`, `product_models`
- **格式化状态 (Bokeh Optimization)**:
    - `format_status`: `none` | `draft` (AI处理后) | `published`
    - `formatted_content`: AI 优化后的排版内容。
    - `formatted_by`: `ai` | `human` | `external`
- **数据源追踪**:
    - `source_type`: `Manual` | `PDF` | `DOCX` | `Web`
    - `source_reference`: 原始文件名或引用链接。
- **权限与统计**: `visibility`, `view_count`, `helpful_count`, `not_helpful_count`

**FAQ条目**:
- **内容分离**: `external_answer`(客户/经销商可见) / `internal_answer`(仅内部)

**Troubleshooting条目**:
- **问题现象**: 描述具体症状
- **排查步骤**: 有序列表,支持分支逻辑(步骤1失败→步骤2)
- **关联信息**: 适用产品、相关案例

**兼容性条目**:
- **测试对象**: 我方产品 + 外部设备(品牌/型号)
- **测试参数**: 接口类型、分辨率、帧率
- **测试结果**: 兼容性(✓/✕)、备注
- **元数据支持**: 录制状态、VU表、时码(针对特定类型)

**问题案例**:
- **问题分类**: 大类/小类(参考2.2.1.1问题分类维度)
- **问题描述**: 现象、分析、售后步骤
- **具体案例**: 日期、机型、固件版本、反馈人、解决方法

**固件知识**:
- **版本信息**: 固件版本、对比版本
- **新功能**: 功能名称、功能说明
- **问题与解答**: 按分类(RAW/ProRes/自定义按键/其他)组织

##### 2.2.1.3 权限分级

| 可见性 | 说明 | 可见内容 |
|----------|------|---------|
| **Public** | 完全公开(3.0阶段向终端用户开放) | 外部回答、基础兼容性列表、产品说明书 |
| **Dealer** | 经销商可见 | Public + 维修手册、产品知识库 |
| **Internal** | 内部员工 | 全部内容(含内部回答、敏感资料) |
| **Department** | 特定部门 | 如维修手册仅售后/研发可见 |

**创建条目时的权限管理**:
- 创建者选择权限级别
- 不同发布版本可设置不同权限(如Beta版仅Internal)
- 支持条目的权限历史追溯

##### 2.2.1.4 自动化导入与维护流程

**1. DOCX 自动化导入 (Python-docx Workflow)**:
- **触发方式**: 管理台上传 `.docx` 文件或分块上传后合并。
- **解析逻辑**: 调用 Python 脚本 (`docx_to_html.py`) 进行转换。
- **自动切分**: 
    - 识别 `H1/H2` 标题作为章节起点。
    - 自动提取章节号（如 `3. SDI监看` -> Chapter 3）。
    - 自动生成 Slug。
- **预警机制**: 
    - **标题不匹配**: 系统检测文档标题中的机型（如 "Edge 8K"）与用户选择的分类是否一致，不一致时弹出警告。
- **统计信息**: 记录导入的图片数、表格数、标题数及总字符数。

**2. PDF 导入流程**:
- **解析逻辑**: 使用 `pdf-parse` 提取文本。
- **图片抓取**: 自动抓取 PDF 中的图片并存入 `/Volumes/fileserver/Service/Knowledge/Images`，在 HTML 中自动插入引用。

**3. 知识维护审计 (Audit Log)**:
- **创建/编辑**: 记录操作人、时间、变更字段、新旧状态。
- **批量导入**: 生成 `Batch ID`，追踪单次导入产生的所有文章条目。
- **可见性变更**: 记录权限调整的详细日志。

### 10.4 知识库 Phase 2 成果 (2026-02)
- [x] **DOCX 导入流优化**: 自动识别章节序号（1.1, 1.2 等）并保留层级。
- [x] **Apple 风格折叠目录**: 引入 Accordion 交互，解决长篇手册的平铺视觉压力。
- [x] **Turbo Scraper (Web 导入增强)**: 
    - 集成 `r.jina.ai` 精准抓取网页表格与图片并自动化本地化。
    - **修复**: 解决了 Turbo 模式下由于变量未定义导致的 `ReferenceError` 导入失败问题。
- [x] **导入交互优化 (Import UX)**:
    - **多型号选择**: 支持为一个知识条目同时关联多个产品型号（如 A 类下的所有机型），采用标签组多选交互。
    - **进度面板重构**: 将导入进度的网格摘要改为更清爽的文字描述方式（macOS26 设计风格），提升了进度的信息密度与易读性。
- [x] **搜索同义词管理器**: 支持“录制 -> 录像/录影”等行业词扩展，提升召回率。
- [x] **多标签页并行作业**: Wiki 文章与工单详情默认通过新标签页打开，支持多线协作。
- [x] **知识库审计日志**: 记录所有增删改查及导入批次历史。
- [x] **UI 深度抛光与品牌化**: 移除冗余侧边栏路由，将 KnowledgeGenerator 重构为 macOS26 风格弹窗，统一品牌色为 Kine Yellow。
- [x] **Bokeh Orb 视觉终极进化 (2026-02-25)**: 
    - 实现了**灵动白核** (White Core) 视觉设计，周边呈青紫 (#00BFA5 -> #8E24AA) 柔和渐变。
    - 移除了边缘杂色与噪点，完美契合“边缘柔和的发光球体”交互规范。
- [x] **全量翻译与标题自愈**:
    - 在 Bokeh 优化流中注入全球化翻译指令，支持英文技术文档全量中文化。
    - 实现了抓取标题的智能去水印/去后缀处理，提升知识库卡片整洁度。
- [x] **导入进度全链路透传**: 补全了 0-100% 的真实进度反馈，消除了 AI 执行阶段的“卡死”焦虑，增强了交互的可预测性。
- **管理员**: 可批量删除、设置权限、查看审计日志

##### 2.2.1.5 知识库与工单联动

- 创建工单时: 智能推荐相关知识 (基于问题描述)
- 处理工单时: 可引用知识库内容作为解决方案
- 关闭工单时: 可将解决方案沉淀为新知识条目

**特点**：
- 图文并茂的网页形式
- 支持版本管理（固件版本对应）
- 支持多语言（中/英）

#### 2.2.2 知识库管理后台 (Knowledge Admin)

- **批量操作**: 支持跨文章的批量删除、批量修改可见性、批量关联产品。
- **高级排序**: 支持按点击量、反馈率、更新时间及 AI 优化状态排序。
- **多语言维护**: 快速切换中英德日预览及翻译状态。
- **同义词字典管理**:
  - 支持 Admin/Lead 维护领域同义词（如录音/拾音/麦克风）
  - 搜索时基于内存缓存进行查询词自动横向扩展，提升模糊查询匹配率
  - 界面支持 UI 交互式的同义词组 CRUD 及分类多色标记

#### 2.2.3 智能搜索与问答 (Smart Search & Q&A)

**功能入口**：全局搜索框及 `Cmd/Ctrl + K` 快捷键

##### 2.2.3.1 混合搜索机制 (Hybrid Search)

系统采用“关键词 + AI 语义”双引擎搜索，结果聚合展示：

1. **关键词搜索 (Keyword Search)**:
   - **文章搜索**: 基于 SQL `LIKE` 匹配标题、摘要、内容、标签。针对中文优化，支持不分词匹配。
   - **工单搜索**: 同时检索相关历史工单，提供维修参考。
2. **AI 语义搜索 (Semantic Search)**:
   - **向量化检索**: 基于 RAG 技术，在向量空间匹配最相关的知识点。
   - **知识关联**: 自动关联可能相关的“最近浏览”和“高频问题”。

##### 2.2.2.2 关键词提取机制 (Keyword Extraction)

针对自然语言提问（如“Edge 8K如何升级固件？”），系统自动执行以下提取逻辑：
- **术语优先**: 优先提取 `SDI/HDMI/8K/Edge` 等技术术语和产品型号。
- **符号清理**: 移除疑问词（如何、怎么、吗）和停用词。
- **智能纠错**: 纠正常见的拼写和型号误输入辅助搜索。

##### 2.2.2.3 Bokeh / 小波 - AI 助手交互规范

**1. 核心视觉识别**

**角色形态**：一团"有生命力的光"
- 形态：边缘柔和、边界不明确的发光球体，时刻在缓慢流动、变形，像大光圈镜头下的焦外光点
- 色彩：青色(Teal #00BFA5)到淡紫色(Lavender #8E24AA)渐变，适配暗黑模式
- 关键词：Ethereal（空灵）、Bioluminescent（生物发光）、Calm（平静）、Responsive（响应式）

**动态语言**：
- **呼吸(Breathing)**：待机时缓慢的透明度和大小微弱变化，像呼吸一样
- **对焦(Focusing)**：思考时快速收缩变实，再散开变虚，模拟镜头对焦过程

**2. 交互设计 - 三种形态**

**形态A：休眠态 - "灵动光点" (The Orb)**

```
外观：
  ┌────────────────────────────────────────────────┐
  │                                      [○]       │  ← 48px半透明光点
  │                                                │    吸附在右下角
  │                                                │
  │                                   Ask Bokeh    │  ← Hover时显示Tooltip
  │                                    (⌘K)        │
  └────────────────────────────────────────────────┘

交互：
  • Hover：光点变亮、变大
  • 拖拽：可拖到屏幕任何边缘吸附
  • 投喂：拖拽截图到光点 → 光点变成"黑洞"吸入图片 → 展开对话框分析
```

**形态B：激活态 - "侧边助理" (The Panel)**

```
触发方式：
  • 点击光点
  • 全局快捷键：Cmd + K (Mac) / Ctrl + K (Win)

展开动画：
  光点像墨水滴入水中一样"晕染"，展开成磨砂玻璃面板

布局：
  ┌─────────────────────────────────────────┐
  │ [○] Bokeh Assistant          [_] [×]   │  ← 头部
  ├─────────────────────────────────────────┤
  │                                         │
  │  💬 Bokeh: 您需要关于 SVC-D-2602-005   │
  │            的帮助吗？我可以帮您...      │
  │                                         │  ← 对话区
  │  👤 你: 查询这个RMA的物流状态           │
  │                                         │
  │  💬 Bokeh: 正在查询物流信息...         │
  │                                         │
  ├─────────────────────────────────────────┤
  │ [ 📦 查询RMA物流 ] [ 📄 Edge说明书 ]    │  ← 快捷胶囊按钮
  ├─────────────────────────────────────────┤
  │  输入您的问题...                📎 📷   │  ← 输入区
  └─────────────────────────────────────────┘
```

**形态C：迷你态 - "聚焦搜索" (The Spotlight)**

类似macOS Spotlight，适用于快速问答：

```
场景：用户只想知道简单参数

显示：
  ┌─────────────────────────────────────────────────┐
  │                                                 │
  │     ┌─────────────────────────────────────┐    │
  │     │ MAVO Edge 8K最高帧率？              │    │  ← 中央长条输入框
  │     └─────────────────────────────────────┘    │
  │     ┌─────────────────────────────────────┐    │
  │     │ 8K 30fps / 6K 60fps / 4K 120fps     │    │  ← 答案直接展开
  │     │ [查看完整规格] [关闭]                │    │
  │     └─────────────────────────────────────┘    │
  │                                                 │
  └─────────────────────────────────────────────────┘

特点：看完即走，无需打开完整面板
```

**3. 关键功能体验**

**上下文感知 (Context Awareness)**：
```
场景：用户正在浏览 SVC-D-2602-0005 维修单
  ↓
用户呼出Bokeh (Cmd+K)
  ↓
Bokeh开场白：
  "您需要关于 SVC-D-2602-0005 的帮助吗？
   我可以帮您催审或检查备件库存。"
  ↓
省去用户描述背景的时间
```

**智能预判 (Quick Actions)**：
- 对话框打开时，不显示空白的"有什么可以帮您？"
- 在输入框上方提供3-4个基于当前热门问题的**快捷胶囊按钮**：
  - [ 📦 查询 RMA 物流 ]
  - [ 📄 MAVO mark2 说明书 ]
  - [ 🔍 错误代码查询 ]

**思考状态表达**：
- 查询数据库时，不用传统的"三个点(...)"加载动画
- 显示："Bokeh is focusing..."（Bokeh正在对焦...）
- 同时，顶部光团进行微妙的虚实变化动效

**最小化与召回**：
- 点击最小化 → 面板有"回吸"动画，嗖的一下缩回右下角光点
- 如Bokeh正在处理耗时任务（如分析大日志），光点旁边有微小的进度环转动

**4. 核心能力**

| 功能 | 说明 | 技术实现 |
|-----|------|----------|
| 故障排查树 | 结构化Troubleshooting流程 | 决策树+向量检索 |
| AI对话 | 自然语言问答 | LLM+RAG（Wiki+历史工单） |
| 实时FAQ匹配 | 输入时即时推荐相关FAQ | 语义搜索 |
| 图片分析 | 拖拽截图识别错误信息 | OCR+多模态LLM |

**5. 权限与范围**

| 角色 | Bokeh可访问的知识范围 |
| :--- | :--- |
| 客户 | Public Wiki + 公开FAQ |
| **经销商 (Dealer)** | 1. 公开 Wiki 知识库<br>2. **[新] 权限内历史工单** (仅限该经销商及其客户的 Resolved/Completed 工单) |
| **内部员工 (Internal)** | 1. 全量 Wiki 知识库<br>2. **[全量] 历史工单** (所有类型的已结案工单) |

##### 工单引用交互规范 (Ticket Linking)
当 Bokeh 引用历史工单时，遵循以下规范：
1. **渲染格式**：文本中出现的 `[TicketNumber]` 会自动解析为蓝色可点击链接，并附带类型徽章（🎫咨询、🔧维修、🛠️经销商）。
2. **悬停效果**：背景变为 Kine Yellow (#FFD700) 的淡化版本。
3. **点击交互**：点击后弹出 **Ticket Detail Popup** (毛玻璃效果)，显示工单详情。
4. **详情内容**：包括客户名、序列号、问题摘要、最终解决方案等关键信息。
5. **系统跳转**：详情窗底部提供“在系统中打开”按钮，跳转至完整工单页面。

##### 2.2.2.2 AI系统技术实现

**系统架构**：

```
用户提问 → AI问答引擎(本地知识库+在线知识源) → 上下文整合 → LLM生成 → 智能回答
```

**查询入口**：
- 公开用户：官网聊天窗口/小程序（Public知识）
- 经销商：登录后问答（Dealer知识+自己客户工单）
- 内部员工：工单系统内置（全部知识库）

**查询模式**：
1. 直接问答：自然语言问题 → AI检索+生成答案+引用来源
2. 引导式Troubleshooting：逐步询问 → 排查树引导 → 解决方案
3. 传统文档搜索：关键词搜索+分类浏览

**AI服务商支持**：
- **DeepSeek**：首选性价比方案，支持 Chat 及 Reasoner 推理模型。
- **Gemini (Google)**：首选多模态方案，支持 Flash/Pro 最新版模型。
- **OpenAI**：通用备选方案。
**基础设施**：
- **模型路由**：代码层实现 Chat/Reasoner/Vision 任务分类，由管理中心动态路由至不同服务商。
- **网络代理**：支持集成 HTTPS 代理，确保国内/海外服务器的 API 通讯稳定性。
- **向量检索**：SQLite+sqlite-vec / ChromaDB
- **Embedding**：智谱Embedding-2 / BGE-M3 (本地)

**AI应用场景**：
- 知识库+工单联合查询：带引用索引[KB-XXX]/[工单#XXX]
- 工单分析：模式识别/趋势预警/根因分析/聚类/方案推荐
- 查询辅助：意图理解 → 结构化查询 → 洞察生成
- 自动标签：工单分类/优先级/知识提取/重复识别
- 报告生成：自动汇总+分析+趋势识别+结构化输出
- 多语言：知识库翻译/工单翻译/跨语言问答

**实现优先级**：
- Phase 1: 工单分类/回复建议/知识提取/故障诊断/报告摘要
- Phase 2: 高频问题/相似工单/补货建议/批次预警/自动起草
- Phase 3: 分配建议/更新建议/自然语言查询/情绪识别/异常检测/多语言

#### 2.2.3 智能管理中心 (Intelligence Center)

> **系统的 AI 神经中枢**：管理 AI 服务商、模型路由及运行参数，为全系统的智能功能提供底层支撑。

**功能入口**：`/admin/intelligence`

##### 2.2.3.1 多服务商集成与调度

系统支持主流大模型（LLM）服务商的接驳与统一管理，确保服务的冗余与高可用性。

| 服务商 | 适用场景 | 配置项 |
|-----|------|----------|
| **DeepSeek** | 核心推理、高性价比对话 | API Key, Base URL |
| **Gemini (Google)** | 多模态 (Vision)、逻辑推理 | API Key, Base URL, Proxy |
| **OpenAI** | 综合能力、通用任务 | API Key, Base URL |

##### 2.2.3.2 任务导向的模型路由

系统将 AI 任务抽象为三个核心能力，可独立配置关联的具体模型，实现“任务-模型”的最佳匹配：

1.  **对话模型 (Chat Model)**：用于常规问答、工单摘要、回复润色。
2.  **推理模型 (Reasoner Model)**：用于复杂故障诊断、逻辑推理（如 DeepSeek-Reasoner, Gemini-Pro-Latest）。
3.  **视觉模型 (Vision Model)**：用于 OCR 识别 SN 码、分析故障图片。

##### 2.2.3.3 运行控制与弹性

- **网络适应性**：支持自定义 Base URL 和 HTTPS 代理设置，解决跨境 API 连接限制。
- **参数精调**：支持对各服务商独立设置 Temperature、Max Tokens、Top P 等生成参数。
- **国际化管理**：管理后台全面支持中、英、德、日四种语言。

#### 2.2.4 公告与培训 (Announcements)

**功能入口**：`/tech-hub/announcements`

**内容类型**：

| 类型 | 说明 | 权限 |
|-----|------|------|
| 内部技术通告 | 新产品技术要点、批次问题警示 | Internal |
| 新产品培训资料 | 产品培训PPT、视频 | Dealer+ |
| 固件发布知识 | 固件更新日志、已知问题 | Public |

### 2.3 档案和基础信息 (Archives)

> **系统的基石数据库**：管理客户、设备、物料等基础资源。

#### 2.3.1 客户档案 (Customers)

**功能入口**：`/archives/customers`

具有添加客户的功能。

**视图A：渠道伙伴 (Dealers)**

```
列表页：
  ┌─────────────────────────────────────────────────────────┐
  │ ProAV (英国) | 一级经销商 | 维修单: 15 | 库存: 充足     │
  │ Gafpa (欧洲) | 一级经销商 | 维修单: 23 | 库存: 正常     │
  │ DP Gadget (东南亚) | 二级经销商 | 维修单: 8 | 库存: 无 │
  └─────────────────────────────────────────────────────────┘

点击ProAV详情页：
  ┌─────────────────────────────────────────────────────────┐
  │ ProAV - 一级经销商                                       │
  ├─────────────────────────────────────────────────────────┤
  │ 基本信息：                                               │
  │   地区: 英国/部分欧洲                                     │
  │   联系人: Mike Johnson                                   │
  │   维修能力: 强 | 配件库存: 有                             │
  ├─────────────────────────────────────────────────────────┤
  │ Service Dashboard:                                      │
  │   本月维修单: 15 | 本月咨询: 47 | 库存周转率: 2.3       │
  ├─────────────────────────────────────────────────────────┤
  │ 备件库存（一级经销商专属）:                               │
  │   SDI模块: 3 | Edge主板: 1 | 风扇: 5                     │
  │   [库存明细] [补货申请]                                  │
  ├─────────────────────────────────────────────────────────┤
  │ 维修单列表:                                              │
  │   SVC-D-2602-0001 | Edge SDI维修 | 已完成              │
  │   SVC-D-2602-0005 | mark2按键板 | 进行中              │
  │   [查看全部]                                            │
  └─────────────────────────────────────────────────────────┘
```

**视图B：终端用户 (End-Users)**

```
列表页：
  ┌─────────────────────────────────────────────────────────┐
  │ John Smith | ProAV客户 | Edge 8K | 工单: 3 | VIP       │
  │ Max Chen   | 直客      | mark2  | 工单: 1 | 标准      │
  └─────────────────────────────────────────────────────────┘

点击John详情页：
  ┌─────────────────────────────────────────────────────────┐
  │ John Smith - 终端用户                                    │
  ├─────────────────────────────────────────────────────────┤
  │ 客户上下文（之前定义的完整模型）:                         │
  │                                                         │
  │ 设备列表:                                                │
  │   MAVO Edge 8K (ME_207890) | 在保至2027-03-15          │
  │   Eagle HDMI (EH_104523)   | 已过保                    │
  │                                                         │
  │ 历史工单:                                                │
  │   K2602-0001: 咨询-死机问题 → 已升级为RMA               │
  │   RMA-D-2602-0010: 主板腐蚀维修 → 已完成                │
  │   K2512-0847: 咨询-高帧率设置 → 已解决                  │
  │                                                         │
  │ 维修记录:                                                │
  │   2026-02-15: Edge 8K主板更换 (RMA-D-2602-0010)        │
  │   费用: $0 (保内)                                       │
  │                                                         │
  │ 经销商关联:                                              │
  │   销售经销商: ProAV (英国)                               │
  │   服务经销商: ProAV (英国)                               │
  │                                                         │
  │ AI客户画像:                                              │
  │   标签: 高频用户 | 技术能力强 | 偏好邮件沟通 | VIP      │
  │   提示: 此客户曾提出过2个功能期望，均已纳入规划          │
  └─────────────────────────────────────────────────────────┘
```

#### 2.3.2 设备资产 (Installed Base)

**功能入口**：`/archives/installed-base`

**核心功能**：

```
全局SN码搜索：
  ┌─────────────────────────────────────────────────────────┐
  │ 搜索: [ME_207890]                          [🔍]         │
  └─────────────────────────────────────────────────────────┘
  ↓
设备上下文（之前定义的完整模型）：
  ┌─────────────────────────────────────────────────────────┐
  │ MAVO Edge 8K (ME_207890)                                │
  ├─────────────────────────────────────────────────────────┤
  │ 出厂信息:                                                │
  │   生产批次: 2026Q1-001                                   │
  │   出厂日期: 2026-01-05                                   │
  │   硬件版本: PCB v3.2                                     │
  │   固件版本: 8023 (当前)                                  │
  │                                                         │
  │ 保修状态:                                                │
  │   购买日期: 2026-01-15                                   │
  │   保修期至: 2027-01-15 (还有11个月)                      │
  │   状态: ✅ 在保                                          │
  │                                                         │
  │ 历史维修记录:                                            │
  │   2026-02-15 | RMA-D-2602-0010 | 主板腐蚀更换           │
  │   费用: $0 (保内) | 处理人: 黄碧珊                       │
  │                                                         │
  │ 当前用户:                                                │
  │   John Smith (john@example.com)                        │
  │   销售经销商: ProAV (英国)                               │
  │                                                         │
  │ 与工单的双向关联:                                        │
  │   K2602-0001: 咨询工单 (已关闭)                         │
  │   RMA-D-2602-0010: RMA返厂单 (已完成)                   │
  └─────────────────────────────────────────────────────────┘
```

**从工单调用设备信息**：
- 在任何工单中输入SN码
- 系统自动弹出设备上下文气泡
- 点击气泡跳转到设备详情页

#### 2.3.3 物料与价目 (Materials & Pricing)

**功能入口**：`/archives/materials`

**整合内容**：
- 原2.2节：维修配件SKU体系
- 原2.4节：Edge前部维修方案矩阵

**核心功能**：

| 功能 | 说明 | 角色权限 |
|-----|------|----------|
| SKU列表 | 74个配件的完整清单 | 所有内部员工 |
| 标准工时费 | Labor Rates按区域定价 | 市场部、生产部 |
| 价格策略 | 经销商价/直客价/保内价/保外价 | 市场部 |
| 库存状态 | 总部库存 + 各一级经销商库存 | 市场部、生产部、一级经销商 |
| Edge前部维修方案矩阵 | 原2.4节内容 | 生产部、一级经销商 |

**库存管理**：
```
总部库存视图（市场部/生产部）：
  ┌─────────────────────────────────────────────────────────┐
  │ SKU            | 配件名称      | 总部库存 | 经销商总库存│
  ├─────────────────────────────────────────────────────────┤
  │ S1-011-013-01 | SDI模块       | 45       | 12          │
  │   ├ ProAV: 3                                            │
  │   ├ Gafpa: 5                                            │
  │   └ 1SV: 4                                              │
  ├─────────────────────────────────────────────────────────┤
  │ S3-800-002-01 | Edge主板      | 8        | 3           │
  │   ├ ProAV: 1                                            │
  │   ├ Gafpa: 2                                            │
  │   └ 1SV: 0 ⚠️ 低于安全线                                │
  └─────────────────────────────────────────────────────────┘

经销商库存视图（一级经销商）：
  ┌─────────────────────────────────────────────────────────┐
  │ SKU            | 配件名称      | 我的库存 | 状态        │
  ├─────────────────────────────────────────────────────────┤
  │ S1-011-013-01 | SDI模块       | 3        | 正常        │
  │ S3-800-002-01 | Edge主板      | 1        | 正常        │
  │ S4-000-003-01 | 风扇          | 0        | ⚠️ 缺货     │
  │                                          [申请补货]      │
  └─────────────────────────────────────────────────────────┘
```

### 2.4 洞察与反馈中心 (Insights & Feedback)

> 从海量工单数据中提取洞察，驱动产品迭代和质量改进

**功能入口**：`/insights`

**核心价值**：将分散的工单、维修、反馈数据转化为可执行的产品洞察和质量改进行动

---

#### 2.4.1 质量仪表盘 (Quality Dashboard)

**功能定位**：产品质量的晴雨表，管理层和质量部门的核心决策工具

**核心指标**：

##### A. 返修率统计 (RMA Rate)

按不同维度统计返修率，快速定位质量问题区域：

| 统计维度 | 示例 | 计算方式 | 应用场景 |
|---------|------|---------|----------|
| **按机型** | Edge 6K: 3.2%<br>MAVO LF: 1.8% | 返修台数 / 出货台数 | 对比不同产品线质量 |
| **按批次** | 2026Q1-001: 5.1% ⚠️<br>2026Q1-002: 1.2% | 该批次返修 / 该批次出货 | 定位问题批次，快速召回 |
| **按地区** | 欧洲: 2.5%<br>北美: 1.9% | 该地区返修 / 该地区出货 | 分析区域性问题（运输/环境） |
| **按经销商** | ProAV: 4.2%<br>Gafpa: 1.5% | 该经销商返修 / 该经销商出货 | 识别经销商操作/仓储问题 |
| **按时间段** | Q1: 2.8%<br>Q2: 3.5% ↗️ | 季度返修 / 季度出货 | 趋势监控，预警质量恶化 |

**可视化展示**：
```
返修率趋势图（按月）：
5%  ┤           ╭─╮
4%  ┤       ╭─╯ ╰╮
3%  ┤   ╭─╯     ╰─╮  ← 安全线 (3%)
2%  ┤ ╭╯          ╰╮
1%  ┼─────────────────
    Q1 Q2 Q3 Q4 Q1 Q2
    2025      2026

⚠️ 预警：2026 Q1-001批次返修率5.1%，超出安全线68%
```

##### B. 故障帕累托图 (Defect Pareto)

**TOP 10 故障组件排行**：识别"关键少数"故障，集中资源解决

```
故障组件分布（2026 Q1）：

组件名称            故障次数   占比    累计占比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SDI接口烧毁            45      30%     30%  ████████████
SSD卡槽弹簧失效         30      20%     50%  ████████
Fan风扇轴承磨损         22      15%     65%  ██████
主板电容鼓包            18      12%     77%  ████
触摸屏排线松动          10       7%     84%  ██▌
ND滤镜卡死              8       5%     89%  ██
电池仓接触不良           6       4%     93%  █▌
HDMI输出无画面          5       3%     96%  █
Sensor坏点              3       2%     98%  ▌
机身螺丝滑丝            3       2%    100%  ▌

💡 洞察：前3项占65%，集中改进这3个组件可解决大部分问题
```

**帕累托原则应用**：
- 80/20法则：80%的返修问题通常由20%的组件缺陷导致
- 改进优先级：优先解决前5名故障，投入产出比最高

##### C. 质量看板可视化

```
┌────────────── 质量仪表盘 (2026 Q1) ──────────────┐
│                                                 │
│  总返修率: 2.8% ↗ (+0.5% vs Q4)                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━                    │
│  安全线: 3.0%        [距离预警: 0.2%]            │
│                                                 │
│  🔴 高风险批次 (1个)                             │
│     2026Q1-001: 5.1% (已标记召回评估)            │
│                                                 │
│  🟡 关注机型 (2个)                               │
│     MAVO Edge 6K: 3.2% (SDI接口为主)            │
│     TERRA 4K: 2.9% (风扇问题为主)               │
│                                                 │
│  🟢 优秀表现                                     │
│     MAVO LF: 1.8% (连续3季度低于2%)             │
│     KineEVF: 1.2% (新产品质量稳定)              │
│                                                 │
│  📊 快速链接                                     │
│  [查看详细报告] [导出Excel] [设置预警阈值]       │
└─────────────────────────────────────────────────┘
```

---

#### 2.4.2 性能指标分析 (Performance Metrics)

**功能定位**：运营效率的度量器，优化服务流程的数据基础

##### A. TAT (Turnaround Time) 分析

**定义**：从收到设备到维修完成发出的平均时长

**维修中心对比**：

| 维修中心 | 平均TAT | 中位数TAT | 最快 | 最慢 | 样本量 |
|---------|---------|----------|------|------|--------|
| **深圳支持中心** | 3.2天 | 3天 | 1天 | 12天 | 156个 |
| **Burbank** | 7.1天 | 6天 | 3天 | 21天 | 89个 |
| **ProAV英国** | 4.5天 | 4天 | 2天 | 14天 | 67个 |
| **Gafpa荷兰** | 5.8天 | 5天 | 2天 | 18天 | 43个 |

**深度分析 - 为什么Burbank慢？**

```
TAT分解（Burbank vs 北京）：

环节              深圳    Burbank   差距    原因分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
收货登记          0.5天   1.2天    +0.7天  时差+人手不足
检测诊断          0.8天   1.5天    +0.7天  技师经验不足
等待配件          0.9天   2.8天    +1.9天  🔴 主要瓶颈：跨国运输
维修作业          0.7天   1.1天    +0.4天  工具配置差异
质检测试          0.3天   0.5天    +0.2天  流程差异
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计              3.2天   7.1天    +3.9天

💡 改进建议：
1. 在Burbank建立常用配件本地库存（减少1.5天）
2. 增加1名技师，缩短排队时间（减少0.5天）
3. 优化检测流程，提供远程技术支持（减少0.3天）
预计改进后TAT：4.8天（缩短32%）
```

##### B. SLA达标率

2026 Q1 SLA达标情况：

维修中心        总工单   达标   超时   达标率   平均超时天数
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
深圳支持中心         156     148     8     94.9%    2.3天
Burbank          89      71     18     79.8%    4.1天 🔴
ProAV英国        67      61      6     91.0%    2.8天
Gafpa荷兰        43      38      5     88.4%    3.2天
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
全球总计         355     318     37     89.6%

⚠️ 超时工单分析：
- 缺件等待：18个 (48.6%)
- 疑难故障：10个 (27.0%)
- 客户沟通延迟：6个 (16.2%)
- 其他：3个 (8.1%)

🎯 目标：Q2达标率提升至95%
```

##### C. 高级检索 (Advanced Query)

**跨维度组合搜索**，支持复杂的质量调查和批量召回场景：

**示例查询**：

```sql
查询条件：
[地区 = 英国] 
  AND [产品 = MAVO Edge 6K] 
  AND [故障类型 = SDI接口] 
  AND [保修状态 = 已过保]
  AND [维修时间 = 2025-Q4 至 2026-Q1]

结果：23条记录

快速操作：
  [导出客户联系清单]  ← 用于召回通知
  [批量发送升级提醒]  ← 告知固件修复方案
  [生成质量报告]      ← 提交研发部门
```

**典型应用场景**：

| 场景 | 查询条件 | 目的 |
|-----|---------|------|
| **批次召回** | [批次 = 2026Q1-001] + [故障 = SDI烧毁] | 定位受影响客户，主动召回 |
| **固件推送** | [产品 = Edge 6K] + [故障 = 死机] + [固件 < 8023] | 推送修复固件，减少返修 |
| **经销商审计** | [经销商 = ProAV] + [返修率 > 4%] + [时间 = Q1] | 调查经销商操作问题 |
| **保修分析** | [保修状态 = 刚过保] + [故障 = 主板] + [地区 = 欧盟] | 评估延保策略 |

**权限控制**：
- 市场部：可查询所有客户数据
- 质量部：可查询故障技术细节
- 经销商：仅查询自己客户数据

---

#### 2.4.3 产品进化池 (Product Evolution / VoC)

> Voice of Customer - 将客户声音转化为产品进化的三条路径

**核心理念**：每一条工单背后都可能是产品改进的线索，系统自动识别+人工标记，将反馈精准分流给对应部门

**数据来源**：
- 咨询工单（客服标记）
- RMA返厂单（生产部标记）
- 经销商维修单（经销商上报）
- 内部测试反馈

##### A. Bug流 → 研发/质量部

**定义**：暴露出产品的Bug或设计缺陷

**识别机制**：
- **自动识别关键词**："Bug"、"无法XX"、"一直XX"、"每次都"、"必现"
- **人工标记**：客服/技师在处理工单时勾选"这是Bug"

**数据结构**：

```
product_bugs (Bug流)
├── id
├── bug_number: Bug编号 (BUG-2026-0001)
├── title: Bug标题
├── severity: 严重等级 (Critical/High/Normal/Low)
│   Critical: 导致设备完全无法使用
│   High: 核心功能异常
│   Normal: 功能部分受限
│   Low: 体验问题
│
├── // 问题描述
├── phenomenon: 现象描述 (客户原话)
├── reproduce_steps: 复现步骤 (客服补充)
├── affected_versions: 受影响固件版本列表
├── affected_models: 受影响机型列表
│
├── // 来源追溯
├── source_type: 来源 (咨询工单/RMA工单/内部测试)
├── source_ids: 来源ID列表 (多个工单可能反映同一Bug)
├── reporter_count: 报告人数 (权重)
│
├── // 处理流程
├── status: 状态 (新建/已确认/修复中/已修复/无法复现/非Bug)
├── assigned_to: 负责工程师
├── root_cause: 根因分析
├── fix_plan: 修复方案
│
├── // 修复追踪
├── fixed_in_version: 修复版本 (如: 固件8024)
├── fix_release_date: 发布日期
├── verification_status: 验证状态 (待验证/已验证/复发)
│
└── created_at, updated_at
```

**闭环机制**：

```
Bug修复流程：

1. Bug录入
   客服标记 → 自动创建Bug记录 → 关联所有相关工单
   
2. Bug确认
   研发部门评估 → 确认严重等级 → 分配工程师
   
3. Bug修复
   开发修复 → 内部测试 → 固件版本发布
   
4. 自动通知 🔔
   系统检测到固件发布 
   → 查找受影响客户列表
   → 批量发送邮件/推送：
   
   "尊敬的客户：
   您之前反馈的问题'MAVO Edge录制时突然停止'已在
   固件 v8024 中修复。
   
   [立即下载固件] [查看更新说明]
   
   感谢您的反馈！"
   
5. 效果追踪
   记录通知发送状态 → 追踪固件更新率 → 监控Bug是否复发
```

**典型案例**：

```
BUG-2026-0012: MAVO Edge 8K录制4K 120fps时必现死机

严重等级：Critical
报告人数：23人（来自18个工单）
受影响版本：固件8020-8023
受影响机型：MAVO Edge 8K (仅8K，6K正常)

复现步骤：
  1. 设置分辨率4K，帧率120fps
  2. 录制超过10分钟
  3. 必现死机，需重启

根因分析：
  高帧率下内存缓冲区溢出，看门狗触发重启

修复方案：
  优化内存管理算法，增加缓冲区大小

修复版本：8024 (2026-02-15发布)

闭环通知：
  ✅ 已通知23位客户
  ✅ 18人已更新固件
  ✅ 无复发报告
  
状态：已关闭
```

##### B. 需求流 (Features) → 产品部

**定义**：客户期望的功能或改进建议

**识别机制**：
- **自动识别关键词**："希望"、"建议"、"能不能"、"最好"、"如果有...就好了"
- **人工标记**：客服在工单中勾选"这是功能建议"

**权重累加机制**：

```
同一需求的权重计算：

基础权重 = 提出次数 × 1
客户等级加权 = VIP客户 ×2, KOL ×3
经销商投票 = 经销商请求 ×5

示例：
需求："支持Anamorphic 1.8x变形宽银幕"

提出记录：
  - 12个普通用户     →  12分
  - 3个VIP客户      →  6分
  - 2个KOL          →  6分
  - 5个经销商反馈    →  25分
━━━━━━━━━━━━━━━━━━━━━━━━
  总权重：49分      →  高优先级
```

**数据结构**：

```
feature_requests (需求流)
├── id
├── request_number: 编号 (FR-2026-0001)
├── title: 需求标题
├── description: 详细描述
├── category: 分类 (UI/功能/性能/兼容性/硬件/其他)
├── product_id: 相关产品
│
├── // 权重系统
├── vote_count: 基础投票数（提出次数）
├── weight_score: 加权得分
├── priority_level: 优先级 (P0极高/P1高/P2中/P3低)
│
├── // 来源追溯
├── source_records: 所有相关工单/反馈记录ID列表
├── account_ids: 所有提出账户ID列表
├── dealer_ids: 提出该需求的经销商列表
│
├── // 产品规划
├── status: 状态 (新建/评估中/已规划/开发中/已发布/已拒绝/已合并)
├── target_version: 目标版本 (如: 固件8025)
├── released_version: 实际发布版本
├── release_date: 发布日期
│
├── // AI辅助
├── ai_similar_ids: AI识别的相似需求（建议合并）
├── ai_feasibility_score: AI评估的可行性得分 (0-100)
│
└── created_at, updated_at
```

**状态流转**：

```
新建 → 评估中 → 已规划 → 开发中 → 已发布
   ↓                              ↓
已拒绝(附原因)             批量通知客户
   ↓
已合并(合并到其他需求)
```

**闭环机制**：

```
功能上线流程：

1. 需求规划
   产品经理评估 → 分配到版本 (如: 固件8025)
   
2. 开发完成
   功能开发 → 测试验证 → 版本发布
   
3. 批量通知 🔔
   系统检测到版本发布
   → 查找target_version = 8025的所有需求
   → 找出所有相关客户（50人）
   → 批量发送邮件：
   
   "好消息！
   
   您在2025年11月期望的功能'Anamorphic 1.8x支持'
   已在固件8025中实现！
   
   同时上线的还有另外12个您关注的功能：
   - ProRes RAW录制
   - ...
   
   [查看完整更新列表] [下载固件]
   
   感谢您的宝贵建议！"
   
4. 反馈收集
   记录客户反馈 → 评估功能效果 → 优化迭代
```

**需求看板**（产品经理视图）：

```
┌─────────── 需求优先级看板 (2026 Q1) ────────────┐
│                                                │
│  🔴 P0 - 极高优先级 (3个)                       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━         │
│  FR-2026-0015: Anamorphic 1.8x      权重: 49  │
│    👥 50人请求 | 📅 规划至8025 | 产品：Edge     │
│                                                │
│  FR-2026-0023: ProRes RAW           权重: 38  │
│    👥 38人请求 | 📅 规划至8026 | 产品：全系列   │
│                                                │
│  FR-2026-0031: 4K 240fps            权重: 35  │
│    👥 35人请求 | 📅 评估中 | 产品：Edge 8K     │
│                                                │
│  🟡 P1 - 高优先级 (12个)                        │
│  🟢 P2 - 中优先级 (35个)                        │
│  ⚪ P3 - 低优先级 (78个)                        │
│                                                │
│  📊 统计                                        │
│  本季度新增：128个 | 已规划：23个 | 已发布：15个 │
└────────────────────────────────────────────────┘
```

##### C. 原声流 (Voices) → 市场部

**定义**：客户赞扬的话、正面评价、使用心得

**识别机制**：
- **自动识别关键词**："很棒"、"满意"、"专业"、"好用"、"推荐"、"感谢"
- **人工标记**：客服标记"客户赞扬"

**数据结构**：

```
customer_voices (原声流)
├── id
├── voice_number: 编号 (VOICE-2026-0001)
├── content: 原始内容（客户原话）
├── translated_content: 翻译内容（如需要）
│
├── // 分类标签
├── sentiment: 情感 (正面/中性/负面) ← 正面才入库
├── tags: 自动标签 ["画质", "服务", "MAVO Edge"] 
├── highlight_keywords: 高亮关键词 ["色彩还原", "高帧率"]
│
├── // 来源信息
├── source_type: 来源 (咨询工单/RMA工单/社交媒体/邮件)
├── source_id: 来源记录ID
├── account_id: 账户ID
├── customer_name: 客户姓名
├── customer_title: 客户头衔 (如: "BBC纪录片导演")
├── customer_consent: 客户同意公开引用 (Y/N)
│
├── // 使用场景
├── usage_status: 使用状态 (待审核/已批准/已使用/已过期)
├── used_in: 使用场所 ["官网", "社交媒体", "宣传册"]
├── publish_date: 发布日期
│
└── created_at, updated_at
```

**自动标签系统**：

```
AI标签提取示例：

原始内容：
"MAVO Edge 6K的色彩还原真的太棒了！我用它拍了一部
关于非洲野生动物的纪录片，4K 120fps的高帧率让猎豹
奔跑的画面丝般顺滑。Kinefinity的售后服务也非常专业，
问题响应很快。强烈推荐给同行！"

自动提取标签：
  产品: #MAVO Edge 6K
  场景: #纪录片 #野生动物
  优点: #色彩还原 #高帧率 #4K 120fps #售后服务
  情感: 正面 (置信度: 98%)
  
推荐用途:
  ✅ 官网产品页 - MAVO Edge 6K
  ✅ 社交媒体 - 高帧率功能推广
  ✅ 售后服务宣传
```

**应用场景**：

| 用途 | 使用方式 | 示例 |
|-----|---------|------|
| **官网引用 (Testimonials)** | 客户评价轮播 | 产品页展示真实用户反馈 |
| **社交媒体转发** | 精选好评发布 | Twitter/微博/B站转发客户心得 |
| **案例研究 (Case Study)** | 深度报道 | "BBC导演如何用Edge 6K拍摄野生动物" |
| **内部士气激励** | 月度表彰 | 展示客户认可，激励团队 |
| **销售素材** | 宣传册/PPT | 经销商培训、展会资料 |

**原声库管理**（市场部视图）：

```
┌──────────── 客户原声库 (2026 Q1) ──────────────┐
│                                                │
│  📊 本季度收集：156条正面反馈                   │
│  ✅ 已批准使用：45条                            │
│  📝 待审核：23条                                │
│                                                │
│  🏆 热门标签                                    │
│  #画质  (89)  #服务  (67)  #MAVO Edge  (78)   │
│  #专业  (45)  #推荐  (56)  #高帧率  (34)       │
│                                                │
│  🌟 精选案例                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━         │
│  VOICE-2026-0089                               │
│  "色彩还原真的太棒了！..."                     │
│  来源：RMA-D-2602-0156 (BBC导演)               │
│  标签：#纪录片 #野生动物 #Edge 6K               │
│  状态：✅ 已用于官网                            │
│                                                │
│  [按标签筛选] [导出宣传素材] [申请客户授权]     │
└────────────────────────────────────────────────┘
```

**权限与隐私**：
- ✅ 需客户明确授权才能公开引用
- ✅ 可匿名化处理（"某BBC导演"）
- ✅ 支持撤回授权
- ✅ GDPR/隐私法合规

---

### 2.4 小节总结

**洞察与反馈中心的价值**：

```
              数据输入                  洞察输出
                ↓                        ↓
┌────────────────────────┐    ┌─────────────────────┐
│ 3.1 服务作业台          │    │ 质量改进            │
│   - 咨询工单           │───→│   返修率↓           │
│   - RMA返厂单          │    │   故障TOP10         │
│   - 经销商维修单       │    │   批次召回          │
│                        │    └─────────────────────┘
│ 3.2 Tech Hub           │    ┌─────────────────────┐
│   - 知识库             │───→│ 运营优化            │
│   - Bokeh AI           │    │   TAT缩短           │
│                        │    │   SLA达标率↑        │
│ 3.3 Archives           │    │   成本控制          │
│   - 设备档案           │    └─────────────────────┘
│   - 物料价目           │    ┌─────────────────────┐
└────────────────────────┘───→│ 产品进化            │
                               │   Bug修复→客户通知  │
                               │   需求权重→版本规划  │
                               │   原声流→市场推广    │
                               └─────────────────────┘

💡 核心理念：
   让数据驱动决策，让客户声音驱动产品进化
```

---

## 3. 前端与交互规范

> **P2 升级**：定义角色化界面、动态导航、核心视图设计规范。

### 3.1 核心设计哲学

| 原则 | 说明 |
|------|------|
| **Role-First (角色优先)** | 不同角色登录看到的是完全不同的界面结构，而非同一界面的不同权限 |
| **Action-Oriented (行动导向)** | UI 必须直接提示"下一步做什么"，而非仅仅展示"现在是什么" |
| **Separation of Concerns (职能分离)** | 对于管理岗，强制分离"管人 (Management)"与"做事 (Execution)"的界面入口 |

### 3.2 导航架构 (Navigation Architecture)

侧边栏采用 **"动态分段 (Dynamic Sections)"** 结构，系统根据登录用户的角色 (RBAC) 动态渲染。

| 分组标题 | 菜单项 | 可见角色 | 交互/红点逻辑 |
|----------|--------|----------|---------------|
| **MANAGEMENT** (管理指挥塔) | Overview (Lead 默认首页) | Lead, Exec | 红点：有待审批或 SLA 预警时亮起 |
| **WORKSPACE** (个人执行区) | 🔴 My Tasks (员工默认首页) | All | 红底数字：阻断性任务，必须清零 |
|  | 🔔 Mentioned | All | 蓝底数字：协作请求 |
|  | 📥 Team Queue | All | 灰底数字：部门公共池 |
| **OPERATIONS** (业务查询) | 咨询/RMA/SVC工单 | 咨询/SVC: MS, Mgr, Exec；RMA: All | 全量历史检索，支持 Cmd+K 全局搜索 |
| **KNOWLEDGE** | 📖 Tech Hub | All | 知识库，支持侧滑调用 |
| **ARCHIVES** (静态档案) | 渠道/客户/资产 | MS, Mgr, Exec | OP/RD 隐藏，静态档案查询 |
|  | 🛠️ 配件 (Parts) | All | 库存与BOM查询 |

### 3.3 核心界面设计 (Core Views)

#### 3.3.1 Overview (管理仪表盘)

**适用角色**：Lead / Exec  
**定位**：登录后的第一站，先看全局，再干细活

| 区域 | 功能 | 交互 |
|------|------|------|
| **Action Zone (决策区 - 顶部)** | 待审批卡片 (Approvals)、风险卡片 (SLA Warning) | 点击弹出批量审批 Modal，允许直接 @Assignee 催办 |
| **Team Health (团队健康度 - 中部)** | 负载看板 (Load Balance) | 点击柱子 → 弹出任务列表 → 改派 (Re-assign) |
| **Trend (趋势 - 底部)** | 本周进件 vs 出件折线图 | - |

#### 3.3.2 Workspace (个人执行台)

**适用角色**：All (员工的主战场，主管的副战场)

**My Tasks (需我处理)**：
- 数据源：`Assignee == Me AND Status != Closed`
- 工具栏：⭐ Star/Focus (今日关注)、💤 Snooze (挂起)
- 混合排序逻辑：
  1. 🔥 Critical/Breached (P0 或已超时)：**强制置顶**，不可隐藏/Snooze
  2. ⭐ Starred (加星)：按加星时间排序
  3. 🕒 Remaining (普通)：按 SLA 剩余时间倒序

**工单卡片字段布局**：

| 区域 | 字段 | 视觉样式 | 数据源 |
|------|------|---------|--------|
| 左侧栏 | Star/Lock | 🔥(P0/超时) / ⭐(已关注) / ☆(普通) | is_critical OR priority==P0 |
|  | ID | RMA-001 (灰色微缩字体) | ticket_number |
| 主内容 | 标题行 | [P1] 镜头卡口松动 | priority + subject |
|  | 状态行 | 🔵 待诊断 · OP_Wang | status · assignee_id |
| 右侧栏 | SLA 计时器 | -2h(红底) / 4h(黄字) / 2d(绿字) | sla_due_at - NOW() |

**Mentioned (协作)**：过滤 `Participants contains Me AND Unread`

**Team Queue (部门池)**：列表右侧显示 **[ ✋ 认领 ]** 按钮

#### 3.3.3 Detail View (工单详情页)

| 功能 | 说明 |
|------|------|
| **Sidecar Tech Hub (侧滑知识库)** | 点击右上角 📖 按钮，右侧滑出 30% 宽度抽屉，支持拖拽链接到评论区 |
| **Contextual Popover (场景化信息卡)** | MS/Mgr: 客户名为蓝色链接；OP/RD: 客户名为黑色文本 (仅显示收货地址) |
| **资产历史** | 仅显示当前 SN 的过往维修记录，不显示客户名下其他资产 |

### 3.4 管理员与测试规范

为验证复杂的 RBAC 逻辑，Admin 界面需包含专门的测试工具。

#### 3.4.1 View As (替身/预览模式)

**入口**：全局顶部导航栏右侧 → **[ 👁️ 预览视角 ]** 下拉菜单

**功能**：允许 Admin 不登出账号，以特定用户身份渲染界面

**交互流程**：
1. 选择 Role: OP → User: OP_Wang
2. 页面刷新，加载 OP_Wang 的侧边栏和 Workbench
3. 顶部横幅：⚠️ **正在以 [OP_Wang] 身份浏览。所有操作将记录为该用户。** [ 退出预览 ]
4. 验证点：确认看不到 Overview、客户档案菜单

#### 3.4.2 Debug Overlay (X光模式)

**入口**：Admin 设置 → 开启 **[ 🐞 UI Debug Mode ]**

**功能**：在界面元素上覆盖显示权限代码，用于开发自测
- 审批按钮旁显示：`[Permission: TICKET_APPROVE]`
- 客户电话字段旁显示：`[Mask: OP_VIEW]`

---

## 4. 数据模型设计

> 完整的数据库设计文档请参考：[Service_DataModel.md](./Service_DataModel.md)

### 4.1 文档说明

本章节仅保留**核心实体概览**，完整的数据表结构、字段定义、索引设计、关系约束等技术细节均在 [Service_DataModel.md](./Service_DataModel.md) 中维护。

**为什么拆分？**
- **产品视角 vs 技术视角**：主 PRD 职责是描述业务流程和功能需求，数据模型是技术实现细节
- **阅读对象不同**：产品经理/市场部需要 PRD，后端开发/DBA 需要数据模型
- **文档管理**：避免 PRD 文档过大（4500+行），保持主 PRD 的可读性

---

### 4.2 核心实体概览

#### 4.2.1 基础实体

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **products** | 产品 | id, name, model, category, series | [4.1](./Service_DataModel.md#11-产品-products) |
| **customers** | 客户 | id, name, company, customer_type, customer_level | [4.2](./Service_DataModel.md#12-客户-customers) |
| **dealers** | 经销商 | id, name, code, dealer_type, region | [4.3](./Service_DataModel.md#13-经销商-dealers) |
| **users** | 系统用户 | id, name, email, department, role | [4.4](./Service_DataModel.md#14-系统用户-users) |

---

#### 4.2.2 工单系统

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **inquiry_tickets** | 咨询工单 | ticket_number (K-YYMM-XXXX), status, handler_id | [2.1](./Service_DataModel.md#21-咨询工单-inquiry_tickets) |
| **tickets** | RMA返厂单/经销商维修单 | ticket_number, ticket_type, issue_category | [2.2](./Service_DataModel.md#22-工单实体-tickets) |
| **issue_attachments** | 工单附件 | issue_id, file_type, file_path | [2.3](./Service_DataModel.md#23-工单附件-issue_attachments) |
| **issue_comments** | 工单评论 | issue_id, comment_type, is_internal | [2.4](./Service_DataModel.md#24-工单评论-issue_comments) |
| **production_feedbacks** | 生产问题反馈(F0) | category, severity, serial_number | [3](./Service_DataModel.md#3-生产问题反馈-production_feedbacks) |

---

#### 4.2.3 知识库系统

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **knowledge_articles** | 知识库条目 | article_number, knowledge_type, visibility | [4.1](./Service_DataModel.md#41-知识库条目-knowledge_articles) |
| **knowledge_products** | 知识-产品关联 | knowledge_id, product_id | [4.2](./Service_DataModel.md#42-知识库-产品关联-knowledge_products) |
| **knowledge_tags** | 知识标签 | knowledge_id, tag | [4.3](./Service_DataModel.md#43-知识库标签-knowledge_tags) |
| **troubleshooting_steps** | 故障排查步骤 | step_order, action, next_step_if_fail | [4.4](./Service_DataModel.md#44-故障排查步骤-troubleshooting_steps) |
| **compatibility_entries** | 兼容性条目 | our_product, external_device, is_compatible | [4.5](./Service_DataModel.md#45-兼容性条目-compatibility_entries) |

---

#### 4.2.4 经销商库存管理

**核心概念：逻辑库存 (Logical Inventory)**

经销商库存是系统自动计算的**逻辑库存**，而非经销商手动盘点的物理库存。

**计算规则**：
- **发货增加**：Kinefinity 发给经销商 5 个主板 → 系统记 `+5`
- **维修扣减**：经销商修机器用了 1 个主板 → 系统记 `-1`
- **补货申请**：经销商提交补货申请 → 系统记 `+N`（审批通过后）
- **盘点校正**：发现实际库存与系统不符 → 系统记差异（adjustment）

**优势**：
- ✅ 无需经销商手动更新库存，减少人工错误
- ✅ 自动关联维修工单，确保库存变动可追溯
- ✅ 安全库存预警（low_stock_alert）自动触发补货提醒

**限制**：
- ⚠️ 系统库存与实际库存可能存在偏差（配件损坏/遗失等）
- ⚠️ 初期需经销商配合盘点校正（每季度一次）

---

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **dealer_inventory** | 经销商配件库存（逻辑库存） | dealer_id, sku, quantity, safety_stock | [5.1](./Service_DataModel.md#51-经销商配件库存-dealer_inventory) |
| **dealer_inventory_transactions** | 库存变动记录（含盘点校正） | transaction_type, quantity_change | [5.2](./Service_DataModel.md#52-库存变动记录-dealer_inventory_transactions) |
| **replenishment_requests** | 补货申请 | request_number, status, debt_check_passed | [5.3](./Service_DataModel.md#53-补货申请-replenishment_requests) |

---

#### 4.2.5 维修发票与结算

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **repair_invoices** | 维修发票/PI | invoice_number, total_amount, currency | [6.1](./Service_DataModel.md#61-维修发票-repair_invoices) |
| **dealer_settlements** | 经销商定期结算 | settlement_number, period_start/end | [6.2](./Service_DataModel.md#62-经销商定期结算-dealer_settlements) |

---

#### 4.2.6 其他支持表

| 表名 | 说明 | 关键字段 | 详细设计 |
|------|------|---------|----------|
| **logistics_tracking** | 物流跟踪 | direction, carrier, tracking_number | [7](./Service_DataModel.md#7-物流跟踪-logistics_tracking) |
| **repair_exceptions** | 维修异常处理 | exception_type, customer_choice | [8](./Service_DataModel.md#8-维修异常处理-repair_exceptions) |
| **ai_suggestions** | AI建议记录 | suggestion_type, user_action | [9](./Service_DataModel.md#9-ai建议记录-ai_suggestions) |
| **product_bugs** | Bug流 | bug_number, severity, fixed_in_version | [10.1](./Service_DataModel.md#101-bug流-product_bugs) |
| **feature_requests** | 需求流 | request_number, vote_count, target_version | [10.2](./Service_DataModel.md#102-需求流-feature_requests) |
| **customer_voices** | 原声流 | voice_number, sentiment, ai_tags | [10.4](./Service_DataModel.md#104-原声流-customer_voices) |
| **parts_catalog** | 配件目录 | sku, price_cny/usd/eur | [11](./Service_DataModel.md#11-配件目录-parts_catalog) |

> **配件数据来源**：完整SKU清单和定价信息维护在 [Service_Parts_SKU_Pricing.md](./Service_Parts_SKU_Pricing.md)

---

### 4.3 数据关系图

```
Core Entities (基础实体):
  products ←── inquiry_tickets
  customers ←── tickets
  dealers   ←── dealer_inventory
  users

Ticketing System (工单系统):
  inquiry_tickets → (upgrade) → tickets
  tickets → issue_attachments
  tickets → issue_comments
  tickets → repair_exceptions

Knowledge Base (知识库):
  knowledge_articles → knowledge_products
  knowledge_articles → knowledge_tags
  knowledge_articles → troubleshooting_steps
  knowledge_articles → compatibility_entries

Inventory & Billing (库存与结算):
  dealers → dealer_inventory
  dealers → dealer_inventory_transactions
  dealers → replenishment_requests
  tickets → repair_invoices
  dealers → dealer_settlements

Product Evolution (产品进化池):
  product_bugs ← tickets
  feature_requests ← feature_request_customers ← customers
  customer_voices ← tickets

Supporting (支持表):
  logistics_tracking ← tickets
  ai_suggestions
  issue_stats_daily
  issue_stats_monthly
```

---

### 4.4 技术要点

#### 4.4.1 索引策略

所有高频查询字段均已建立索引，详见 [Service_DataModel.md](./Service_DataModel.md) 各表定义。

**核心索引**：
- 工单编号 (ticket_number) - UNIQUE
- 账户ID (account_id) - INDEX
- 经销商ID (dealer_id) - INDEX
- 序列号 (serial_number) - INDEX
- 状态 (status) - INDEX
- 创建时间 (created_at) - INDEX

---

#### 4.4.2 JSON字段说明

部分表使用 JSON 字段存储灵活结构数据：
- `repair_invoices.items`：配件明细列表
- `feature_requests.ai_tags`：AI自动标签
- `knowledge_articles.related_issues`：关联工单ID列表

**注意**：JSON字段不建立索引，需要通过其他字段过滤。

---

#### 4.4.3 数据备份与迁移

- **备份策略**：每日全量备份 + 实时增量备份
- **历史数据**：工单数据永久保存，不删除
- **数据归档**：3年以上的已关闭工单可归档至冷存储

---

### 4.5 相关文档

| 文档 | 用途 | 维护者 |
|-----|------|-------|
| [Service_DataModel.md](./Service_DataModel.md) | 完整数据库设计 | 研发部 |
| [Service_Parts_SKU_Pricing.md](./Service_Parts_SKU_Pricing.md) | 配件SKU与价格 | 市场部/生产部 |
| [Edge_Front_Repair_Matrix.md](./Edge_Front_Repair_Matrix.md) | Edge前部维修方案矩阵 | 生产部 |

---

## 5. 需求确认与约束

### 5.1 功能决策记录

#### 5.1.1 查询统计

| 问题 | 决策 | 备注 |
|-----|------|------|
| 预置查询模板 | ✅ 需要 | 初期提供基础模板，后续可动态增加 |
| 定时邮件推送 | ✅ 需要 | **推送对象**: 部门负责人<br>**频率**: 每周/每月/每季度 |
| 自定义报表 | ⏳ Backlog | 后续版本实现 |
| 地区热力图 | ✅ 需要 | Phase 2 实现 |

#### 5.1.2 媒体管理

| 问题 | 决策 | 备注 |
|-----|------|------|
| 图片大小限制 | **6MB/张** | 单工单最多5张 |
| 视频大小限制 | **50MB/个** | 单工单最多2个 |
| 自动压缩 | ⏳ Backlog | 暂不实现，后续考虑 |
| 对象存储 | ❌ 暂不使用 | 使用内部SSD存储<br>当前仅服务经销商/员工内部使用<br>后续扩展到客户时再考虑OSS |

#### 5.1.3 知识库

| 问题 | 决策 | 备注 |
|-----|------|------|
| 组织方式 | **混合模式** | 按产品 + 按分类 |
| 版本控制 | ❌ 不需要 | 简化实现 |
| 审核流程 | ✅ 需要 | 需要推送提醒 (iOS/Web端) |
| 内容格式 | **Markdown/富文本** | 支持Markdown，可选富文本编辑器 |
| 对外发布 | ⏳ 后续考虑 | 需要API接口支持官网集成 |
| 浏览方式 | ✅ WIKI式浏览 | 提供类似WIKI的分类浏览+搜索 |

#### 5.1.4 权限与角色

| 问题 | 决策 | 备注 |
|-----|------|------|
| 经销商登录入口 | ✅ 独立入口 | 可嵌入现有 dealer.kinefinity.com<br>或作为统一Web的特殊角色访问 |
| 经销商创建工单 | ✅ 可以 | 可代客户创建，也可创建自有产品工单 |
| 部门级权限 | ✅ 需要 | 支持后续扩展到更多部门 |

#### 5.1.5 返修管理

| 问题 | 决策 | 备注 |
|-----|------|------|
| 返修报价预估 | ✅ AI分析+客户确认 | 过保必须确认后才能寄修 |
| 检测费 | **$0** | 暂时免费，后续可调整 |
| 客户反悔处理 | ✅ 可退回 | 确认后不寄修，原设备退回，不收费 |
| 确认超时 | **7/14/30天** | 7天提醒→14天跟进→30天关闭 |
| 物流追踪 | ✅ 多种模式 | 快递/上门/取件/集中 |
| 维修异常 | ✅ 三方确认 | 生产部→市场部→客户 |
| 审批权限 | 分级 | <$100业务员/$100-500负责人/>$500管理层 |

#### 5.1.6 经销商配件管理

| 问题 | 决策 | 备注 |
|-----|------|------|
| 库存管理方式 | **系统自动计算** | 无需经销商手动申报 |
| 库存变动 | 维修工单自动扣减 | 工单中选择使用配件 |
| 补货欠款检查 | ✅ 强制检查 | <30天警告，≥30天阻止 |
| 信用额度 | 仅特殊经销商 | 普通经销商付款才发货 |
| 紧急例外 | ✅ 支持 | Cathy审批 |

#### 5.1.7 报告与通知

| 问题 | 决策 | 备注 |
|-----|------|------|
| 报告格式 | **富文本HTML邮件** | 不生成PDF附件 |
| 报告频率 | 日/周/月可配置 | 不同报告不同频率 |
| 推送方式 | 邮件+App+站内信 | 多渠道 |

#### 5.1.8 AI应用

| 问题 | 决策 | 备注 |
|-----|------|------|
| AI应用原则 | **AI建议+人工确认** | 人始终掌控决策 |
| 实现优先级 | 3个Phase | Phase 6/9/10 |

---

### 5.2 推送通知场景汇总

| 事件 | 推送对象 | 推送方式 | 优先级 |
|-----|---------|---------|-------|
| 新工单创建 | 市场部负责人(按地区) | iOS + Web | 普通 |
| 工单分配给我 | 被分配人 | iOS + Web | 普通 |
| 工单状态变更 | 创建者、关注者 | iOS + Web | 普通 |
| 工单有新评论 | 相关人员 | Web | 低 |
| P1紧急工单/R1加急返修 | 管理层 | iOS (紧急) | 紧急 |
| 生产问题反馈 | 研发部、管理层 | iOS + Web | 高 |
| 知识审核请求 | 审核人 | iOS + Web | 普通 |
| 审核结果 | 创建者 | Web | 低 |
| 定时报表 | 部门负责人 | 邮件 + Web | 低 |
| 工单响应超时 | 负责人、管理层 | iOS + Web | 高 |
| 返修超时预警 | 生产部、市场部 | iOS + Web | 高 |
| 库存预警 | 市场部对应人员 | 邮件 + App | 普通 |
| 经销商库存周报 | 市场部负责人、Cathy | 邮件 + Web | 低 |
| 欠款预警 | 市场部、财务 | 邮件 + Web | 高 |
| 物流发货通知 | 市场部、生产部 | App + Web | 普通 |
| 物流到达通知 | 生产部 | App + Web | 普通 |
| 维修异常通知 | 市场部、经销商 | App + Web | 紧急 |
| 报价确认提醒 | 客户/经销商 | 邮件 + Web | 普通 |
| 报价确认超时(7/14天) | 客户/经销商、市场部 | 邮件 + Web | 高 |
| 补货审批请求 | 市场部 | App + Web | 普通 |
| AI知识点建议 | 市场部 | Web | 低 |
| AI批次问题预警 | 研发部、管理层 | App + Web | 紧急 |
| AI客户情绪预警 | 市场部负责人 | App | 紧急 |

---

### 5.3 平台功能分工

#### Web端与iOS端功能划分

| 功能模块 | Web端 | iOS端 | 说明 |
|---------|:-----:|:-----:|------|
| **工单创建** | ✅ 完整表单 | ✅ 简化快速录入 | iOS侧重拍照+语音输入 |
| **工单列表** | ✅ 复杂筛选+表格视图 | ✅ 卡片列表+基础筛选 | Web适合批量处理 |
| **工单详情** | ✅ 完整信息+编辑 | ✅ 查看+快速更新状态 | iOS侧重移动场景 |
| **附件上传** | ✅ 文件选择+批量 | ✅ 拍照+相册 | iOS体验更佳 |
| **统计报表** | ✅ 完整图表+交叉分析 | 📊 简化数据大盘 | Web为主，iOS看概览 |
| **知识库管理** | ✅ 创建/编辑/审核 | ❌ 仅查阅 | 编辑在Web端完成 |
| **知识库查阅** | ✅ 完整浏览+搜索 | ✅ 搜索+查看 | 双端支持 |
| **AI问答(Bokeh)** | ✅ 完整对话 | ✅ 快速问答 | 双端支持 |
| **用户管理** | ✅ 完整Admin功能 | ✅ 授权/基础管理 | iOS支持授权操作 |
| **系统配置** | ✅ 字典/规则配置 | ✅ 基础配置 | 双端支持 |
| **推送通知** | ✅ 站内通知 | ✅ 系统推送(APNs) | |
| **离线支持** | ❌ | ✅ 草稿暂存 | iOS支持离线草稿 |

**核心原则**:
- **Web端**: 管理中心，适合办公室场景，复杂操作、批量处理、数据分析
- **iOS端**: 移动助手，适合外出/现场场景，快速录入、拍照上传、状态更新、知识查询、授权管理

---

## 6. 版本规划与路线图

### 迭代策略

**MVP优先原则**：每个Phase聚焦核心价值，快速验证，逐步完善

**版本节奏**：
- Phase 1-2: 快速迭代（2-3周/Phase）
- Phase 3-5: 稳定迭代（4-6周/Phase）
- Phase 6+: 按需规划（AI功能、高级特性）

---

### Phase 1: 三层工单系统 ✅ **已完成**

**目标**：建立咨询→RMA→经销商维修的完整工单体系

- [x] 咨询工单 CRUD
- [x] RMA返厂单 CRUD  
- [x] 经销商维修单 CRUD
- [x] 三层工单转换（咨询→RMA/SVC）
- [x] 图片/视频上传（本地存储，6MB/50MB限制）
- [x] 基础查询筛选
- [x] 工单编号生成（K/RMA/SVC）
- [x] 客户/经销商基础管理

**交付物**：
- Web端：完整工单管理界面
- 数据库：inquiry_tickets, tickets, customers, dealers

---

### Phase 2: 核心服务流程完善 🚧 **进行中**

**目标**：补全工单生命周期管理，提升服务效率

**2.0 全局亮色主题 (Light Mode)** ✅ **已完成** (v12.1.35 ~ v12.2.1)
- [x] 全局 CSS 变量化：所有硬编码 `rgba(255,255,255,*)` / `rgba(0,0,0,*)` 替换为 `var(--glass-bg-light)` / `var(--glass-border)` 等语义化变量
- [x] 亮色模式文本对比度优化（深色文字在浅色背景下的可读性）
- [x] 经销商详情页、工单列表、Bokeh/知识生成器弹窗、Wiki 弹窗等全量适配
- [x] 移除多处固化渐变背景，统一使用主题变量驱动

**2.1 工单协作增强**
- [ ] 工单评论系统（内部/客户可见）
- [ ] @提醒功能
- [ ] 工单状态流转可视化
- [ ] 附件管理优化（批量下载、预览）

**2.2 客户与设备管理**
- [ ] 客户档案完善（客户类型、等级、行业标签）
- [ ] 设备资产管理（SN绑定、保修状态、维修历史）
- [ ] 客户-设备关联关系

**2.3 统计与报表**
- [ ] 工单统计大盘（数量、状态、趋势）
- [ ] 多维度筛选查询
- [ ] Excel导出
- [ ] 预置查询模板

**时间**：4-6周

---

### Phase 3: 知识库体系 📚

**目标**：构建知识沉淀与复用体系

**3.1 知识库基础**
- [ ] 知识条目CRUD（Markdown/富文本）
- [ ] 混合组织模式（按产品+按分类）
- [ ] 权限分级（Public/Dealer/Internal/Department）
- [ ] WIKI式浏览界面
- [ ] 全文搜索

**3.2 知识与工单联动**
- [ ] 创建工单时推荐相关知识
- [ ] 处理工单时引用知识库
- [ ] 工单解决方案沉淀为知识

**3.3 知识审核流程**
- [ ] 审核工作流（草稿→待审核→已发布）
- [ ] 审核推送提醒（iOS/Web）

**时间**：4-6周

---

### Phase 4: 返修闭环管理 🔄

**目标**：完善RMA返厂单全流程管理

**4.1 返修报价预估**
- [ ] AI故障诊断（概率排序）
- [ ] 配件价格自动计算
- [ ] 预估价格生成
- [ ] 客户确认流程（过保必须确认）
- [ ] 超时提醒机制（7/14/30天）

**4.2 物流追踪**
- [ ] 快递单号管理（5种模式：已填写/待补填/上门/取件/集中）
- [ ] 物流状态追踪
- [ ] 预估收货时间
- [ ] 发货/到达自动通知

**4.3 维修异常处理**
- [ ] 异常类型定义（6种）
- [ ] 三方确认流程（生产部→市场部→客户）
- [ ] 客户选择（继续/取消/换新/报废）
- [ ] 分级审批（<$100/$100-500/>$500）

**4.4 维修配件管理**
- [ ] 配件目录（SKU/价格/库存）
- [ ] 配件选择与报价
- [ ] 维修PI生成

**时间**：6-8周

---

### Phase 5: 经销商配件与结算 💰

**目标**：经销商库存与结算自动化

**5.1 配件库存管理**
- [ ] 库存初始化（按经销商）
- [ ] 维修工单自动扣减库存
- [ ] 库存变动记录
- [ ] 库存预警机制（黄色/红色）
- [ ] 库存周报自动生成

**5.2 补货管理**
- [ ] 经销商申请补货
- [ ] 欠款检查机制（<30天警告/≥30天阻止）
- [ ] 市场部审批流程
- [ ] 紧急例外审批（Cathy）

**5.3 结算管理**
- [ ] 定期结算（月度/季度）
- [ ] 对账单自动生成
- [ ] 欠款催收提醒
- [ ] 结算邮件推送

**时间**：4-6周

---

### Phase 6: AI智能助手（第一期）🤖

**目标**：引入AI提升服务效率

**6.1 知识库智能检索**
- [ ] 向量化知识库
- [ ] 语义搜索
- [ ] 智能问答（Bokeh）
- [ ] 引导式故障排查

**6.2 工单智能辅助**
- [ ] 工单智能分类
- [ ] 优先级自动建议
- [ ] 智能回复建议
- [ ] 知识点自动提取

**6.3 故障诊断**
- [ ] AI故障原因诊断
- [ ] 维修方案推荐
- [ ] 配件需求预测

**时间**：6-8周

---

### Phase 7: 产品进化池 🌱

**目标**：客户反馈→产品改进的闭环

**7.1 VoC管理**
- [ ] Bug流（产品缺陷）
- [ ] Wishlist流（功能期望）
- [ ] 原声流（客户之声）
- [ ] 投票与排序

**7.2 研发协同**
- [ ] 研发部评审界面
- [ ] 版本规划关联
- [ ] 开发状态追踪
- [ ] 发布推送给相关客户

**时间**：4周

---

### Phase 8: 洞察与报告 📊

**目标**：数据驱动决策

**8.1 质量仪表盘**
- [ ] 问题趋势分析
- [ ] 高频问题识别
- [ ] 批次问题预警
- [ ] 产品健康度评分

**8.2 性能指标**
- [ ] TAT分析（周转时间）
- [ ] SLA达标率
- [ ] 客户满意度
- [ ] 地区热力图

**8.3 定期报告**
- [ ] 经销商库存周报
- [ ] 经销商维修月报
- [ ] 工单处理周报
- [ ] 产品质量月报
- [ ] 富文本HTML邮件推送

**时间**：4-6周

---

### Phase 9: iOS移动端 📱

**目标**：移动场景下的高效服务

- [ ] 工单快速创建（拍照+语音）
- [ ] 工单列表与筛选
- [ ] 工单详情与状态更新
- [ ] AI问答（Bokeh）
- [ ] 知识库查阅
- [ ] APNs推送通知
- [ ] 离线草稿暂存

**时间**：8-10周

---

### Phase 10: AI智能助手（第二期）🚀

**目标**：AI深度应用

- [ ] 高频问题自动识别
- [ ] 相似工单智能推荐
- [ ] 补货量智能建议
- [ ] 邮件/通知自动起草
- [ ] 报告智能摘要

**时间**：4-6周

---

### Phase 11: AI智能助手（第三期）💡

**目标**：AI全面赋能

- [ ] 处理人智能分配
- [ ] 知识条目更新建议
- [ ] 自然语言查询
- [ ] 客户情绪识别
- [ ] 结算异常检测
- [ ] 维修记录规范化
- [ ] 多语言翻译

**时间**：4-6周

---

### Backlog（待规划）

- [ ] 自定义报表功能
- [ ] 图片/视频自动压缩
- [ ] 对象存储迁移（OSS/S3）
- [ ] 官网集成（知识库API）
- [ ] 经销商iOS端
- [ ] 物流API对接（自动追踪）
- [ ] 信用额度管理
- [ ] 多语言支持（i18n）

---

## 7. 文档状态

**当前版本**: 0.14.0
**最后更新**: 2026-02-28
**文档状态**: v12.2.1 — 全局亮色主题完成（所有组件 CSS 变量化），Service PRD P2 文档补全，产品管理 Admin CRUD API 落地。

---
