# 产品服务闭环系统 - 需求文档 (PRD)

**版本**: 0.6.0 (Draft)
**状态**: 待确认
**最后更新**: 2026-02-02

---

## 1. 产品概述

### 1.1 系统定位

**Longhorn** 是 Kinefinity 的**产品服务闭环系统**，以"服务"为核心，连接客户、经销商和公司内部团队，围绕产品建立完整的服务生态。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          产品服务闭环系统                                 │
│                                                                         │
│                              ┌─────────┐                                │
│                              │  产品   │                                │
│                              └────┬────┘                                │
│                                   │                                     │
│         ┌─────────────────────────┼─────────────────────────┐           │
│         │                         │                         │           │
│         ▼                         ▼                         ▼           │
│   ┌──────────┐             ┌──────────┐             ┌──────────┐        │
│   │   客户    │◄───服务───►│   公司    │◄───协作───►│  经销商   │        │
│   └──────────┘             └──────────┘             └──────────┘        │
│                                  │                                      │
│                   ┌──────────────┼──────────────┐                       │
│                   ▼              ▼              ▼                       │
│             ┌─────────┐   ┌─────────┐   ┌─────────┐                     │
│             │ 市场部   │   │ 生产部   │   │ 研发部   │                     │
│             │ 服务前端 │   │ 服务执行 │   │ 服务改进 │                     │
│             └─────────┘   └─────────┘   └─────────┘                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 核心理念：服务驱动

**一切客户交互都是服务**，服务记录是系统的核心入口：

```
客户联系 → 创建服务记录 → 服务过程 → 产出
                              │
              ┌───────────────┼───────────────┬───────────────┐
              ▼               ▼               ▼               ▼
         简单咨询        问题排查         产品故障        功能期望
         解答关闭        解决/升级        返修工单        需求管理
                                              ↓               ↓
                                         维修闭环        产品迭代
                                              ↓               ↓
                                         知识沉淀        发布推送
                                              ↓               ↓
                                         ─────────► 客户忠诚度 ◄─────────
```

**服务的四种产出**：

| 服务结果 | 产出类型 | 后续流程 | 价值 |
|---------|---------|---------|------|
| 咨询解答 | 关闭服务记录 | - | 客户满意 |
| 需要返修 | **返修工单** | 物流→检测→维修→结算 | 产品修复 |
| 功能期望 | **Wishlist** | 评估→规划→开发→发布 | 产品改进 |
| 有价值信息 | **知识点** | 审核→发布 | 知识积累 |

### 1.3 参与者与服务职责

#### 1.3.1 外部参与者

**终端客户 (End Customer)**
| 身份 | 服务场景 | 系统交互 |
|-----|---------|---------|
| 产品购买者 | 咨询使用问题、反馈故障、提出期望 | 通过经销商或市场部联系 |
| KOL/媒体 | 测评问题、功能建议 | 同上，优先级可能更高 |

**案例**：
> 客户Max购买了MAVO Edge 8K，使用中遇到死机问题。
> - 联系经销商ProAV反馈问题
> - 经销商创建服务记录，引导排查
> - 排查无效 → 升级为返修工单
> - 维修完成后，Max收到取件通知
> - Max在服务中提到"希望支持快速启动" → 记录为功能期望

#### 1.3.2 合作伙伴

**经销商 (Dealer)** - 服务的延伸和中介

| 分级 | 代表 | 服务能力 | 典型场景 |
|-----|------|---------|---------|
| **一级** | ProAV(英国), Gafpa(欧洲), 1SV(美国) | 有库存+强维修能力 | 本地维修、配件更换、代客户反馈 |
| **二级** | DP Gadget(东南亚) | 有维修能力无库存 | 申请配件后本地维修 |
| **三级** | RMK(澳洲) | 无维修能力 | 代客户反馈、协调寄回总部 |

**案例 - 一级经销商(ProAV)**：
> 1. 客户反馈Edge死机问题
> 2. ProAV创建服务记录，引导客户排查
> 3. 确认需更换SDI模块 → 使用库存配件本地维修
> 4. 库存消耗记录到系统，月底统一结算
> 5. 库存低于安全线 → 系统自动提醒补货

**案例 - 三级经销商(RMK)**：
> 1. 澳洲客户反馈问题
> 2. RMK创建服务记录，无法本地处理
> 3. 协调客户寄回深圳总部
> 4. 总部维修完成后寄回
> 5. RMK全程跟踪状态，同步给客户

#### 1.3.3 内部团队

**市场部 - 服务前端**

| 人员 | 职责区域 | 服务场景 |
|-----|---------|---------|
| Effy | 海外市场 | 处理海外工单、协调经销商、客户沟通 |
| 李雨健 | 国内市场 | 处理国内工单、直接对接客户 |
| Sherry | 负责人 | 审批异常、查看报表、处理升级 |
| Cathy | 负责人 | 审批异常、查看报表、处理升级 |

**案例 - Effy处理海外工单**：
> 1. 收到ProAV提交的工单推送 (iOS)
> 2. 快速查看问题描述，判断优先级
> 3. 查询知识库，回复处理建议
> 4. 需要返修 → 协调RMA流程
> 5. 跟踪物流状态，通知经销商收货时间
> 6. 维修完成 → 确认结算，关闭工单

**生产部 - 服务执行**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| 黄碧珊 | 负责人 | 分配任务、审核报告、处理异常 |
| 陈高松/张工/张平娇 | 维修技师 | 执行维修、填写分析报告 |

**案例 - 生产部处理返修**：
> 1. 收到新返修任务推送
> 2. 收货登记，开始检测
> 3. 发现问题：SDI模块损坏 + 主板有腐蚀痕迹
> 4. 实际费用超预估 → 提交异常报告
> 5. 等待客户确认 → 继续维修
> 6. 维修完成 → 填写维修内容和问题分析
> 7. AI建议：可沉淀为知识点 → 确认发布

**研发部 - 服务改进**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| 吴琪萌 | 产品 | 分析问题趋势、评估功能期望、规划产品路线 |
| 时春杰 | 软件 | 技术可行性评估、固件开发 |

**案例 - 研发部处理功能期望**：
> 1. 查看功能期望列表，按投票数排序
> 2. "快速启动" - 23个客户请求，AI建议高优先级
> 3. 评估技术可行性，添加评估意见
> 4. 纳入固件8025规划
> 5. 开发完成，发布新固件
> 6. 系统自动推送给相关客户："您期望的快速启动功能已发布"

**管理层 - 服务监督**

| 人员 | 职责 | 服务场景 |
|-----|------|---------|
| Jihua | CEO | 查看周报/月报、处理重大异常 |
| Sherry | 财务 | 结算审核、欠款管理 |

> 注：Cathy为市场部负责人，见上方市场部角色

**案例 - 管理层处理紧急问题**：
> 1. 收到P1紧急工单推送 (App)
> 2. 某批次产品出现批量死机问题
> 3. 立即协调研发部分析原因
> 4. 决策：召回该批次 or 发布紧急固件修复
> 5. 跟踪处理进度，确保闭环

### 1.4 完整服务案例

#### 案例1：从咨询到返修到知识沉淀

```
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 1: 客户联系                                                          │
│   客户Max联系经销商ProAV："我的Edge 8K拍摄4K 50fps时会死机"              │
│   ProAV创建服务记录 SR-2026-0001                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 1-2: 问题排查                                                        │
│   ProAV查询知识库，引导Max排查：                                         │
│   - 检查固件版本 → 已是最新8023                                          │
│   - 检查工作温度 → 正常范围                                              │
│   - 尝试恢复出厂设置 → 问题依旧                                          │
│   排查无效，确认需要返修                                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 2: 升级为返修工单                                                    │
│   服务记录 → 升级为返修工单 IS-2026-0157                                 │
│   系统AI预估：SDI模块故障(65%) / 主板问题(25%)                           │
│   预估费用：$98 - $314                                                   │
│   客户确认预估价格，寄出设备                                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 5: 生产部收货检测                                                    │
│   生产部收到设备，开始检测                                                │
│   发现：主板有轻微腐蚀，可能是潮湿环境导致                                │
│   实际维修方案：更换主板 + 清洁                                          │
│   实际费用：$799 (超预估，触发异常流程)                                   │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 5-6: 异常确认                                                        │
│   市场部通知客户实际情况和费用变更                                        │
│   客户确认继续维修                                                        │
│   生产部继续维修                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 8: 维修完成                                                          │
│   维修完成，填写维修报告                                                  │
│   AI建议：此案例可沉淀为知识点 "潮湿环境导致主板腐蚀"                    │
│   市场部确认，发布到知识库                                                │
│   设备寄回客户                                                            │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ Day 12: 服务闭环                                                         │
│   客户收到设备，确认问题解决                                              │
│   工单关闭                                                                │
│   服务记录完成，记录处理时长和结果                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 案例2：从功能期望到产品发布到客户推送

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 收集阶段 (多次服务中积累)                                                 │
│   服务记录 SR-2025-0089: 客户A说"希望支持快速启动"                        │
│   服务记录 SR-2025-0156: 客户B说"开机太慢了，能不能加快？"                 │
│   服务记录 SR-2026-0012: 客户C说"快速启动对拍摄很重要"                     │
│   ...共23个客户提出类似需求                                               │
│   AI自动识别并合并为功能期望 FR-2025-0089                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 评估阶段                                                                  │
│   研发部查看功能期望池                                                    │
│   FR-2025-0089 "快速启动" - 投票数23，AI建议高优先级                     │
│   技术评估：可行，需要2周开发                                             │
│   决策：纳入固件8025规划                                                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 开发阶段                                                                  │
│   研发部开发快速启动功能                                                  │
│   测试验证                                                                │
│   准备发布                                                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 发布阶段                                                                  │
│   固件8025发布                                                            │
│   系统自动匹配：FR-2025-0089 的target_version = 8025                     │
│   状态更新：已规划 → 已发布                                               │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 推送闭环                                                                  │
│   系统查找关联的23个客户                                                  │
│   批量推送邮件 + App通知：                                                │
│   "您期望的快速启动功能已在固件8025中发布！"                              │
│   客户收到推送，感受到被重视 → 忠诚度提升                                 │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.5 业务现状理解

> 参考: A02-产品返修记录.xlsx

**当前问题管理流程**:
```
客户/经销商反馈问题
        ↓
市场部记录（问题描述 + 解决方案）
        ↓
生产部处理（维修内容 + 问题分析）
        ↓
闭环（返回客户 / 知识沉淀）
```

### 1.6 服务类型与记录分类

#### 1.6.1 服务类型

| 服务类型 | 说明 | 产出 |
|---------|------|------|
| **咨询服务** | 功能使用、参数设置、兼容性问题 | 服务记录（关闭） |
| **问题排查** | 故障诊断、远程协助、Troubleshooting | 服务记录（关闭/升级） |
| **本地维修** | 经销商本地完成维修（不寄回总部） | 本地工单 |
| **返修服务** | 设备需寄回深圳总部维修 | 返修工单 |
| **功能期望** | 产品改进建议、新功能需求 | 功能期望记录 |

### 1.6.2 服务记录生命周期管理

#### 状态流转图

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         服务记录生命周期                                   │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│    ┌────────┐     ┌────────┐     ┌──────────────┐                       │
│    │  创建   │────►│ 处理中  │────►│ 待客户反馈   │                       │
│    └────────┘     └────────┘     └──────┬───────┘                       │
│                         ▲               │                                │
│                         │               │ 客户回复                        │
│                         └───────────────┘                                │
│                                         │                                │
│            ┌────────────────────────────┼────────────────┐               │
│            │                            │                │               │
│            ▼                            ▼                ▼               │
│    ┌──────────────┐           ┌──────────────┐   ┌──────────────┐       │
│    │   已解决      │           │  自动关闭     │   │   转工单      │       │
│    │ (客户确认)    │           │ (7天无反馈)   │   │(需要维修)     │       │
│    └──────────────┘           └──────────────┘   └──────────────┘       │
│                                      │                   │               │
│                                      │                   ▼               │
│                               可重新打开          ┌──────────────┐       │
│                            (30天内同问题)         │  本地工单     │       │
│                                                  │   或         │       │
│                                                  │  返修工单     │       │
│                                                  └──────────────┘       │
└──────────────────────────────────────────────────────────────────────────┘
```

#### 状态定义

| 状态 | 说明 | 触发条件 |
|-----|------|---------|
| **处理中** | 正在处理客户问题 | 创建服务记录时 |
| **待客户反馈** | 已回复客户，等待确认 | 工作人员回复后 |
| **已解决** | 问题已解决 | 客户确认解决 |
| **自动关闭** | 无响应自动关闭 | 待反馈状态超过7天 |
| **转工单** | 升级为维修工单 | 确认需要维修时 |

#### 自动关闭规则

| 触发时间 | 系统行为 |
|---------|---------|
| 待反馈第5天 | 发送提醒："您的服务请求即将关闭，如仍有问题请回复" |
| 待反馈第7天 | 状态自动变为"自动关闭" |

#### 重新打开规则

| 条件 | 处理方式 |
|-----|---------|
| 关闭后30天内 + 同一客户 + 同一产品 + 同一问题 | 重新打开原服务记录，状态变为"处理中" |
| 超过30天 或 不同问题 | 创建新服务记录，关联历史记录 |

#### 时间指标（系统自动计算）

| 指标 | 定义 | 用途 |
|-----|------|------|
| **首次响应时长** | 创建 → 首次回复 | SLA考核指标 |
| **总服务时长** | 创建 → 关闭 | 整体服务效率 |
| **有效处理时长** | 总时长 - 待客户反馈时长 | 实际工作量衡量 |

### 1.6.3 工单类型区分（本地工单 vs 返修工单）

> **核心概念澄清**：经销商自行维修 ≠ RMA返修。RMA仅用于设备寄回Kinefinity总部的情况。

```
维修需求判断
├── 经销商可自行处理？
│   ├── 是 → 创建【本地工单】→ 经销商本地维修 → 配件消耗记录
│   └── 否 → 需要寄回Kinefinity？
│           ├── 是 → 创建【返修工单】→ 申请RMA → 物流 → 总部维修
│           └── 否 → 继续排查 或 关闭服务记录
```

#### 工单类型对比

| 特征 | 本地工单 (Local Repair) | 返修工单 (RMA Repair) |
|-----|------------------------|----------------------|
| **适用场景** | 经销商有能力本地维修 | 需要寄回深圳总部维修 |
| **适用级别** | 一级、二级经销商 | 所有级别经销商 |
| **设备去向** | 留在经销商本地 | 寄回Kinefinity总部 |
| **RMA号** | 无（不需要） | 有（物流追踪必需） |
| **维修执行** | 经销商自行完成 | 生产部执行 |
| **配件来源** | 库存配件或临时发货 | 总部库存 |
| **结算方式** | 一级:定期结算；二级:单次PI | 单次PI或定期结算 |
| **编号格式** | LR-2026-0001 | IS-2026-0157 + RMA号 |

#### 典型场景示例

**场景A：一级经销商本地维修（本地工单）**
```
ProAV客户Edge 8K死机
    ↓
ProAV创建服务记录，排查后确认需更换SDI模块
    ↓
ProAV判断：可使用库存配件本地维修
    ↓
创建【本地工单】LR-2026-0001
    ↓
ProAV自行维修，记录使用配件
    ↓
系统自动扣减库存，记入月度结算
    ↓
本地工单关闭
```

**场景B：三级经销商申请返修（返修工单）**
```
RMK客户Terra 4K故障
    ↓
RMK创建服务记录，无法本地处理
    ↓
创建【返修工单】IS-2026-0157
    ↓
申请RMA号：RA070226001
    ↓
客户寄回深圳总部
    ↓
生产部维修完成
    ↓
寄回客户，返修工单关闭
```

#### 经销商维修能力边界

| 可本地维修（本地工单） | 必须寄回总部（返修工单） |
|---------------------|---------------------|
| 更换Back板/SDI口/HDA板 | MC板更换（需刷程序） |
| 更换Video口/风扇/按键板 | 问题不明确的复杂故障 |
| 更换卡农口模块/USB-C模块 | 清灰（需洁净环境） |
| 更换TF卡/RS口板 | 老机器无明确维修说明 |
| | 三级经销商的所有维修需求 |

### 1.6.4 客户上下文支持

当处理服务记录或工单时，系统自动显示客户上下文信息，帮助快速了解客户背景。

#### 双维度查询能力

> **业务场景**：产品可能被转让或出租，当前使用者 ≠ 原购买客户。
> 系统支持按**客户**或**产品SN号**两种维度查询上下文。

| 查询维度 | 触发方式 | 显示内容 | 适用场景 |
|---------|---------|---------|---------|
| **按客户** | 输入客户姓名/联系方式 | 该客户所有设备、服务历史、AI画像 | 了解客户整体情况 |
| **按产品SN** | 输入/扫码产品序列号 | 该设备所有服务历史（可能涉及多个用户） | 设备转让/出租后追溯维修历史 |

**示例场景**：
```
客户A购买 Edge 8K (SN: ME_207890)
    ↓
客户A将设备转让给客户B
    ↓
客户B联系经销商咨询问题
    ↓
经销商输入SN: ME_207890
    ↓
系统显示该设备的完整服务历史：
• SR-2025-0089: 客户A的咨询记录
• IS-2025-0156: 客户A的维修记录
• (当前) 客户B的新咨询
```

#### 上下文信息组成

```
┌─────────────────────────────────────────────────────────────────┐
│ 上下文面板（支持按客户/按SN切换查询）                              │
├─────────────────────────────────────────────────────────────────┤
│ [按客户查询] [按SN查询]  ← 切换标签                              │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 设备信息 (按SN查询时显示)                                    │ │
│ │ ┌─────────────────┬─────────────────┬──────────────────────┐│ │
│ │ │ MAVO Edge 8K    │ ME_207890       │ 在保至 2027-03-15    ││ │
│ │ │ 原购买客户: Max │ 当前用户: John  │ (已转让)             ││ │
│ │ └─────────────────┴─────────────────┴──────────────────────┘│ │
│ └─────────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 设备列表 (按客户查询时显示)                                  │ │
│ │ ┌─────────────────┬─────────────────┬──────────────────────┐│ │
│ │ │ MAVO Edge 8K    │ ME_207890       │ 在保至 2027-03-15    ││ │
│ │ │ Eagle HDMI      │ EH_104523       │ 已过保               ││ │
│ │ └─────────────────┴─────────────────┴──────────────────────┘│ │
│ └─────────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 服务历史 (近3个月)                                           │ │
│ │ • SR-2026-0089: 高帧率设置咨询 → 已解决 (1/15) [客户A]      │ │
│ │ • IS-2026-0012: SDI模块更换 → 已完成 (1/8) [客户A]          │ │
│ │ • SR-2025-0847: 死机问题排查 → 已解决 (12/20) [客户A]       │ │
│ └─────────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ AI客户画像 (按客户查询时显示)                                │ │
│ │ 标签: 高频用户 | 技术能力强 | 偏好邮件沟通 | VIP客户         │ │
│ │ 提示: 此客户曾提出过2个功能期望，均已纳入规划                │ │
│ └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 上下文显示规则

| 角色 | 可见范围 |
|-----|---------|
| 市场部 | 全部客户的完整上下文 |
| 经销商 | 仅自己客户的上下文（服务历史仅显示本经销商创建的记录） |
| 生产部 | 当前工单关联客户的设备列表和服务历史 |

#### AI客户画像生成规则

| 标签类型 | 生成逻辑 |
|---------|---------|
| 活跃度 | 近6个月服务记录数：>5高频，2-5中频，<2低频 |
| 技术能力 | 问题描述质量、是否能自行排查 |
| 沟通偏好 | 历史沟通渠道统计 |
| 客户等级 | 来自客户档案设置 |
| 特殊提示 | 历史异常情况、功能期望、重要信息 |

### 1.6.5 经销商服务记录模式

经销商处理客户问题时，可选择两种模式：

#### 模式对比

| 模式 | 快速查询模式 | 代客户服务模式 |
|-----|------------|---------------|
| **场景** | 客户简单咨询，查知识库即可 | 需要记录跟踪的服务 |
| **是否创建记录** | 否 | 是（创建服务记录） |
| **客户信息** | 不需要 | 可选填（姓名、联系方式） |
| **知识库访问** | 可用 | 可用 |
| **统计计入** | 不计入 | 计入服务统计 |

#### 代客户服务模式 - 客户信息字段

| 字段 | 是否必填 | 说明 |
|-----|---------|------|
| 客户姓名 | 可选 | 如不填写，显示"匿名客户" |
| 联系方式 | 可选 | 电话/邮箱/微信 |
| 产品型号 | 建议填写 | 便于问题分析 |
| 序列号 | 可选 | 如填写可关联设备档案 |

> **设计原则**：降低经销商创建服务记录的门槛，鼓励记录客户问题，便于后续分析和服务改进。

#### 1.6.2 返修工单类型（按来源）

| 类型 | 说明 | 示例 |
|-----|------|------|
| **客户返修** | 终端客户使用中出现的问题 | 客户Max的Edge 8K死机 |
| **生产问题** | 出厂质量问题、发货错误 | 新机开箱发现划痕 |
| **内部样机** | 测试机、展示机、租赁机返修 | 展会样机故障 |

> **产品线**（Edge/MM2/Terra/EAGLE等）是返修工单的属性，不作为分类依据。

#### 1.6.3 问题严重程度 (Severity)

用于评估问题的技术影响程度，辅助优先级判断：

| 等级 | 定义 | 示例 |
|-----|------|------|
| 1级 | 严重错误 + 严重后果 | 导致退换货、恶劣影响、丢失销售订单 |
| 2级 | 严重错误 + 无严重后果 | 首次出现的1级问题降为2级 |
| 3级 | 一般问题 | 首次出现的问题、轻微问题 |

### 1.7 服务响应与处理时效

#### 1.7.1 服务响应优先级 (P1/P2/P3)

**定义**：内部人员对客户/经销商反馈的**首次响应时限**。

**适用范围**：服务记录、返修工单的初始响应。

| 优先级 | 标签 | 响应时限 | 适用场景 | 响应方式 |
|-------|------|---------|---------|---------|
| P1 | 紧急 | 8小时内 | 新机开箱故障、批量质量问题、影响重要拍摄、客户强烈投诉 | 电话+系统 |
| P2 | 高 | 24小时内 | VIP客户、核心功能不可用、经销商催办 | 系统回复 |
| P3 | 标准 | 48小时内 | 普通客户、常规问题、咨询类 | 系统回复 |

**使用场景**：
- 市场部收到新服务记录 → 根据优先级安排响应顺序
- 超时未响应 → 系统自动提醒/升级

#### 1.7.2 返修处理优先级 (R1/R2/R3)

**定义**：生产部完成维修的**目标时限**（从收到设备到维修完成）。

**适用范围**：返修工单的维修环节。

| 优先级 | 标签 | 完成时限 | 适用场景 |
|-------|------|---------|---------|
| R1 | 加急 | 1个工作日 | 新机换新、重要客户、紧急项目需求 |
| R2 | 优先 | 3个工作日 | VIP客户、批量问题、经销商催办 |
| R3 | 标准 | 7个工作日 | 常规返修、一般维修 |

**优先级自动建议规则**：
- 新机故障（购买<30天）→ 服务P1 + 返修R1
- 严重程度1级 → 服务P1
- 经销商创建 → 默认服务P2、返修R3
- 其他 → 默认服务P3、返修R3

### 1.8 用户角色与权限分层

| 层级 | 角色 | 说明 | 数据访问范围 |
|-----|------|------|-------------|
| **外部** | 终端客户 | 购买产品的最终用户 | 仅自己的工单、Public知识库 |
| **外部** | KOL/媒体 | 测评人员 | 同客户 |
| **合作伙伴** | 一级经销商 | 有配件库存+维修能力，区域分销商 | 自己客户的工单、Dealer知识库、配件库存管理 |
| **合作伙伴** | 二级经销商 | 有维修能力但无备件 | 自己客户的工单、Dealer知识库 |
| **合作伙伴** | 三级经销商 | 无维修能力无备件 | 自己客户的工单、Dealer知识库 |
| **内部** | 市场部 | 国内(李雨健)、国外(Effy) | 全部工单、全部知识库 |
| **内部** | 生产部 | 黄碧珊(负责人)、陈高松、张工、张平娇等 | 全部工单(维修视角)、内部知识库 |
| **内部** | 研发部 | 吴琪萌(产品)、时春杰(软件) | 全部工单(分析视角)、内部知识库 |
| **内部** | 管理层 | Jihua | 全部数据 + 统计报表 |

**经销商分级详情**:

| 分级 | 经销商 | 地区 | 配件库存 | 维修能力 | 结算方式 | 使用端 |
|-----|-------|------|---------|---------|---------|-------|
| **一级** | ProAV | 英国/部分欧洲 | 有 | 强 | 定期结算 | Web |
| **一级** | Gafpa | 大部分欧洲 | 有 | 强 | 定期结算 | Web |
| **一级** | 1SV | 美国 | 有 | 强 | 定期结算 | Web |
| **一级** | EU Office | 欧洲(补充) | 有 | 强 | 定期结算 | Web |
| **二级** | DP Gadget | 东南亚 | 无 | 有 | 单次开PI | Web |
| **三级** | RMK | 澳洲 | 无 | 无 | 单次开PI | Web |

> 注：经销商暂时仅支持Web端，未来版本考虑iOS端

**一级经销商特点**:
- 区域分销商，销售能力强
- 有配件库存，定期补货
- 可处理大部分不涉及刷程序、清灰的维修
- 复杂问题需寄回总部

**二级经销商特点**:
- 有维修能力但无备件库存
- 需临时发货配件后自行维修
- 复杂问题需寄回总部

**三级经销商特点**:
- 无维修能力、无备件库存
- 所有问题均需寄回总部维修

**经销商可自行处理的维修类型** (一级/二级):
- 更换前部/Back/SDI口/RS口板/TF卡
- 更换HDA板、Video口、风扇、按键板
- 更换卡农口模块、USB-C/3.5mm模块

**必须寄回深圳处理的情况**:
- MC板更换（需要刷程序）
- 问题不明确的复杂故障
- 清灰（需要洁净环境）
- 老机器无明确维修说明
- 三级经销商的所有维修需求

### 1.4 核心价值
1. **全流程闭环**: 问题录入 → 跟踪处理 → 统计分析 → 知识沉淀
2. **多维度洞察**: 支持任意维度交叉分析，发现问题模式
3. **知识复用**: 将解决方案沉淀为知识库，提升响应效率
4. **AI赋能**: 智能问答、工单分析、趋势预警

---

## 1.5 返修管理体系

> **重要区分**：返修涉及多种场景，需要区分处理流程和结算方式。

### 1.5.0 返修场景分类

```
返修场景
├── A. 客户返修（寄回总部）
│   ├── A1. 国内客户直接寄修
│   └── A2. 海外客户通过经销商寄修
│
├── B. 经销商本地维修（不寄回总部）
│   ├── B1. 一级经销商：使用库存配件维修
│   └── B2. 二级经销商：申请配件后维修
│
└── C. 生产问题/内部样机
    └── 内部流程，不涉及客户收费
```

**场景与收费对照**：

| 场景 | 维修地点 | 配件来源 | 收费对象 | 结算方式 |
|-----|---------|---------|---------|---------|
| A1 国内客户寄修 | 深圳总部 | 总部库存 | 客户（过保） | 单次PI |
| A2 海外客户寄修 | 深圳总部 | 总部库存 | 客户（过保） | 单次PI |
| B1 一级经销商本地维修 | 经销商 | 经销商库存 | 客户（过保） | 月度/季度结算 |
| B2 二级经销商本地维修 | 经销商 | 临时发货 | 客户（过保） | 单次PI |
| C 生产问题/样机 | 深圳总部 | 总部库存 | 内部（无） | 不收费 |

### 1.5.1 RMA编号规则

**格式**: `RA` + `产品类型(2位)` + `渠道(2位)` + `-` + `年份(2位)` + `流水号(3位)`

**示例**: `RA090226001` = Edge 6K + 国外经销商 + 26年 + 第1例

**产品类型编码**:
| 编码 | 产品 |
|-----|------|
| 01 | MAVO Edge 8K |
| 02 | MAVO Edge 6K |
| 03 | MAVO mark2 LF |
| 04 | MAVO mark2 S35 |
| 05 | MAVO LF |
| 06 | MAVO S35 |
| 07 | Terra 4K/6K |
| 08 | EAGLE EVF |
| 09 | 监视器(KineMON) |
| 10 | 转接卡口 |
| 11 | 配件/其他 |

**渠道编码**:
| 编码 | 渠道 |
|-----|------|
| 01 | 国内散户 |
| 02 | 国内经销商 |
| 11 | 国外散户 |
| 12 | 国外经销商 |

### 1.5.2 维修配件SKU体系

> 数据来源: `input docs/维修配件SKU&价格单.xlsx`

**SKU格式**: `S` + `物料ID`（部分老型号配件无SKU编码）

**价格支持**: CNY / USD / EUR 三种货币

**配件分类概览** (共74个配件):

| 分类 | 配件数量 | 价格区间(USD) |
|-----|---------|--------------|
| EAGLE EVF | 3 | $68 - $586 |
| MAVO Edge/mark2 | 29 | $19 - $2499 |
| TERRA/MAVO S35/LF | 14 | $39 - $1599 |
| 监看 | 9 | $69 - $299 |
| 转接卡口 | 8 | $49 - $399 |
| KineBACK | 3 | $109起 |
| KineMAG Nano | 1 | $79 |
| UPS底座 | 1 | - |
| 供电 | 4 | - |
| 线缆 | 2 | - |

#### 完整配件SKU清单

<details>
<summary>EAGLE EVF (3个配件)</summary>

| SKU | 配件名称 | CNY | USD | EUR |
|-----|---------|-----|-----|-----|
| S2-119-012-01 | EAGLE 主板 | ¥982 | $187 | €187 |
| S2-119-011-01 | EAGLE 按键板 | ¥276 | $68 | €68 |
| S2-119-003-01 | EAGLE 目镜 | ¥3982 | $586 | €586 |

</details>

<details>
<summary>MAVO Edge/mark2 (29个配件)</summary>

| SKU | 配件名称 | CNY | USD | EUR |
|-----|---------|-----|-----|-----|
| S1-019-003-01 | Edge 8K Sensor | ¥15000 | $2499 | €2499 |
| S1-019-004-01 | Edge 6K Sensor | ¥9500 | $1599 | €1599 |
| S1-019-005-01 | MM2 S35 传感器 | - | - | - |
| S3-800-002-01 | Edge主板 | ¥4000 | $799 | €799 |
| S1-010-001-01 | Edge/MM2 MC(图像处理模块) | ¥5500 | $1199 | €1199 |
| S1-010-010-02 | Edge显示模块 | ¥990 | $199 | €199 |
| S1-010-006-01 | Edge电源模块(Back板) | ¥990 | $299 | €299 |
| S1-010-007-01 | MM2电源模块(Back板) | ¥990 | $299 | €299 |
| S1-019-008-01 | Edge DK板(主板接口模块) | ¥990 | $249 | €249 |
| S1-016-501-02 | Edge ND模块 | ¥4000 | $750 | €750 |
| S4-000-004-01 | Edge ND电机 | - | $59 | €59 |
| S1-019-010-01 | Edge FRONT模块(电机/卡口识别) | - | $69 | €69 |
| S1-019-017-01 | Edge/MM2 侧屏 | ¥590 | $120 | €120 |
| S1-011-001-01 | Edge Video口（上） | ¥290 | $59 | €59 |
| S1-011-002-01 | Edge Video口（下） | ¥290 | $59 | €59 |
| S1-010-012-01 | Edge按键板 | ¥690 | $95 | €95 |
| S1-010-013-01 | MM2按键板 | ¥690 | $95 | €95 |
| S1-019-013-02 | USB接口小板 | ¥690 | $95 | €95 |
| S4-000-003-01 | 风扇 | ¥120 | $65 | €65 |
| S1-011-013-01 | SDI模块 | ¥390 | $69 | €69 |
| S1-011-014-01 | Edge RS模块(八爪鱼) | ¥290 | $59 | €59 |
| S1-011-015-01 | MM2 RS模块(八爪鱼) | ¥290 | $59 | €59 |
| S1-010-010-01 | Edge UPS小板 | ¥590 | $95 | €95 |
| S4-000-005-01 | Edge/MM2 系统存储卡 | ¥98 | $19 | €19 |
| S1-016-305-01 | Edge/MM2 卡侬口模块 | - | $95 | €95 |
| B-011-001-02 | Edge 8K 前部 | - | - | - |
| B-011-002-01 | Edge 6K 前部 | - | - | - |
| B-019-001-01 | Edge/MM2 Lens口（5芯双键） | - | - | - |
| S1-015-402-02 | Edge/MM2 卡侬口盖子 | - | - | - |

</details>

<details>
<summary>TERRA/MAVO S35/LF (14个配件) - 无SKU编码</summary>

| 配件名称 | CNY | USD | EUR | 备注 |
|---------|-----|-----|-----|------|
| Sensor/传感器 | ¥3500-9500 | $599-1599 | €599-1599 | 按型号：LF/MAVO/T4/T6 |
| 主板 | ¥3000 | $499 | €499 | |
| 显示模块(MA) | ¥790 | $199 | €199 | |
| 图像处理模块(MC) | ¥3000 | $499 | €499 | |
| PCIe通信模块(Relay板) | ¥490 | $99 | €99 | |
| 电源管理模块(SATA板) | ¥790 | $139 | €139 | |
| HDMI板 | ¥99 | $39 | €39 | |
| SDI板 | ¥550 | $149 | €149 | |
| 侧屏 | ¥299 | $95 | €95 | |
| 按键板 | ¥490 | $99 | €99 | |
| 内存条 | ¥590 | $120 | €120 | |
| SSD舱门 | ¥390 | $69 | €69 | |
| 风扇/3.5mm接口 | ¥190 | - | - | |

</details>

<details>
<summary>监看 (9个配件) - 无SKU编码</summary>

| 配件名称 | CNY | USD | EUR |
|---------|-----|-----|-----|
| KineMON Video口 | ¥290 | $95 | €95 |
| KineMON主板 | ¥990 | $199 | €199 |
| 5U2屏幕模块 | ¥1290 | $250 | €250 |
| 7U2屏幕模块 | - | $250 | €250 |
| KineMON 5U2 PCB | ¥990 | $199 | €199 |
| 7U2铝框 | ¥350 | $69 | €69 |
| FPC线和插座 | ¥350 | $69 | €69 |
| EVF主板 | ¥2000 | $299 | €299 |
| EVF镜组 | - | - | - |

</details>

<details>
<summary>转接卡口 (8个配件) - 无SKU编码</summary>

| 配件名称 | CNY | USD | EUR |
|---------|-----|-----|-----|
| 卡口前口触点 | ¥190 | $59 | €59 |
| 卡口主板 | ¥190 | $49 | €49 |
| 法兰面 | ¥99 | $49 | €49 |
| EFEN转接卡口前部 | ¥999 | $199 | €199 |
| PL卡口前部 | ¥500 | $149 | €149 |
| EFEN增光减焦玻璃 | ¥990 | $199 | €199 |
| 卡口ND镜片 | ¥2000 | $399 | €399 |
| EFEN锁紧环 | ¥550 | $109 | €109 |

</details>

<details>
<summary>其他配件 (KineBACK/KineMAG/UPS/供电/线缆)</summary>

**KineBACK**:
| 配件名称 | CNY | USD |
|---------|-----|-----|
| SDI模块 | ¥550 | $109 |
| V口结构件 | ¥99 | - |
| V口金针 | ¥190 | - |

**KineMAG Nano**:
| 配件名称 | CNY | USD |
|---------|-----|-----|
| 存储卡主板(N卡主板) | ¥590 | $79 |

**UPS底座**:
| 配件名称 | CNY |
|---------|-----|
| UPS主板 | ¥190 |

**供电**:
| 配件名称 | CNY |
|---------|-----|
| PD混充主板 | ¥337 |
| PD混充外壳 | ¥112 |
| 2S/2Si电池（置换） | ¥99 |

</details>

### 1.5.2.1 Edge前部维修方案矩阵

> 适用于Edge 8K/6K前部更换维修，根据机型批次和是否更换ND选择方案

**机型批次说明**:
| 批次代码 | 机型 | 出货时间 | 前部类型 | 碳纤维类型 |
|---------|------|---------|---------|-----------|
| Edge 8K 1 | 8K 1-5系列 | 2021.3.31起 | 1.06圆脸前部(F1) | 圆脸碳纤维(C1) |
| Edge 8K 2 | 8K 6系列 | 2021.12.3起 | 1.06猫爪前部(F2) | 圆脸碳纤维(C1) |
| Edge 8K 3 | 8K 7系列711 | 2022.4.27起 | 1.86猫爪前部(F3) | 猫爪碳纤维(C2) |
| Edge 6K 1 | 6K早期 | 2022.1.10起 | 1.06 | - |
| Edge 6K 2 | 6K后期 | - | 1.86 | - |

**维修方案选择**:
| 方案 | 是否更换ND | 适用机型 | 说明 |
|-----|-----------|---------|------|
| **B1** | 不更换 | Edge 8K 1/2 | 仅更换前部框架 |
| **B2** | 不更换 | Edge 8K 2 | 简化方案 |
| **A1** | 更换 | Edge 8K 1/2 | 更换前部+ND模块 |
| **A2** | 更换 | Edge 8K 3, Edge 6K 2 | 1.86机型ND更换 |
| **A3** | 更换 | Edge 6K 1 | 6K早期型号ND更换 |

**方案价格表 (过保)**:
| 方案 | 国内(CNY) | 海外(USD) | 包含内容 |
|-----|----------|----------|---------|
| B1 | ¥1190 | $249 | 前部框架更换 |
| B2 | ¥799 | $199 | 简化前部更换 |
| A1 | ¥4190 | $849 | 前部+ND完整更换 |
| A2 | ¥2990 | $549 | 1.86前部+ND更换 |
| A3 | ¥3790 | $649 | 6K前部+ND更换 |

**特殊规则**:
- 在保维修：免费
- VIP客户：B2方案可申请免费
- 已购买电子E卡口客户：前部更换可享优惠
- 英国/欧洲/美国/加拿大：购买原生卡口可免费更换前部

### 1.5.3 运费管理

**区域默认运费表**:
| 区域 | 默认运费(USD) | 默认运费(EUR) | 说明 |
|-----|--------------|--------------|------|
| 英国 | $29 | €27 | ProAV |
| 欧洲大陆 | $35 | €32 | Gafpa, EU Office |
| 美国 | $45 | - | 1SV |
| 加拿大 | $50 | - | Cinetx |
| 东南亚 | $35 | - | DP Gadget |
| 澳洲 | $55 | - | RMK |
| 国内 | ¥30 | - | 国内客户 |

**运费规则**:
- PI生成时根据收货地区自动填充默认运费
- 工作人员可手动修改运费（如特殊快递、加急等）
- 在保维修：Kine承担运费
- 过保维修：客户/经销商承担运费

### 1.5.4 维修费用规则

**在保维修**:
- 配件费用: 免费
- 人工费用: 免费
- 返回运费: Kine承担

**过保维修**:
- 配件费用: 按SKU价格单收取
- 人工费用: 根据维修复杂度收取
- 运费: 客户承担（按区域默认，可调整）

**经销商结算**:
- 一级经销商: 预先发放配件库存，定期结算使用量
- 二级经销商: 临时开PI发货，单次结算

### 1.5.5 经销商配件库存管理

**核心原则**: 系统自动计算库存，无需经销商手动申报

**库存变动逻辑**:
```
初始库存 (总部发放) 
    ↓
经销商开维修工单 → 选择使用配件 → 系统自动扣减库存
    ↓
库存低于安全线 → 系统提醒补货
    ↓
总部发货 → 系统自动增加库存
```

**经销商维修工单流程**:
1. 经销商创建工单（记录客户问题）
2. 经销商自行维修，在工单中记录：
   - 维修内容（更换了什么模块）
   - 使用的配件（从库存中选择SKU）
   - 维修结果
3. 工单完成后，系统自动：
   - 扣减对应配件库存
   - 记录配件使用关联工单
   - 更新月度/季度结算报表

**库存预警机制**:
| 预警级别 | 条件 | 动作 |
|---------|------|------|
| 黄色 | 库存 ≤ 安全线 | 系统提醒经销商 |
| 红色 | 库存 = 0 | 通知市场部 + 经销商 |

**定期结算 (一级经销商)**:
- 系统按月/季度自动汇总配件使用量
- 生成结算PI（在保免费，过保按SKU计费）
- 发送给经销商确认付款

**市场部查询功能**:
- 实时查看各经销商配件库存
- 查看经销商已完成的维修工单
- 维修统计（按产品/问题类型/时间段）
- 配件使用趋势和补货预测

**异常处理**:
| 场景 | 处理方式 |
|-----|---------|
| 配件损耗/丢失 | 市场部手动调整库存，记录原因 |
| 维修后配件退回 | 工单中标记"未使用"，库存回退 |
| 问题配件回收 | 标记待寄回，批量寄回后核销 |

### 1.5.6 维修PI（发票）

**PI内容**:
| 字段 | 说明 |
|-----|------|
| Invoice No | 发票编号 |
| Date | 日期 |
| Dealer RMA | 经销商RMA号 |
| Customer Info | 客户公司、联系人、邮箱 |
| Repair Info | 产品型号、序列号、保修状态 |
| Bill To | 账单地址 |
| Shipping | 收货地址 |
| 配件明细 | SKU、配件名称、数量、单价、小计 |
| Shipping Cost | 运费 |
| Total | 总计 |
| Description | 问题描述、原因分析、解决方案 |

### 1.5.7 返修报价预估机制

**核心原则**: 过保维修必须客户确认预估价格后才能寄修

**预估流程**:
```
问题反馈 → AI分析可能原因 → 生成预估价格范围 → 客户确认 → 寄修
```

**预估价格组成**:
| 组成 | 说明 | 定价依据 |
|-----|------|---------|
| 配件费用 | 可能需要更换的配件 | SKU价格表 |
| 人工费用 | 维修复杂度 | 按维修类型分档 |
| 运费 | 返回运费 | 区域默认运费表 |
| 检测费 | 如最终无法修复 | 暂定$0（后续可调整） |

**客户确认超时规则**:
| 天数 | 系统行为 |
|-----|---------|
| 7天 | 自动提醒客户/经销商 |
| 14天 | 工单标记"待跟进"，通知市场部 |
| 30天 | 工单自动关闭，标记"客户未响应" |

**客户反悔处理**:
- 确认后不寄修 → 原设备可退回客户
- 工单标记"客户取消"，不收取费用

**实际 vs 预估差异处理**:
| 差异情况 | 处理方式 |
|---------|---------|
| 实际 ≤ 预估 | 按实际收费 |
| 实际 > 预估 150% | 触发"维修异常处理"流程 |

### 1.5.8 补货与欠款关联机制

**核心原则**: 经销商申请补货时，必须检查历史PI结算状态

**欠款检查规则**:
| 欠款状态 | 账龄 | 系统行为 | 可否发货 |
|---------|------|---------|---------|
| 无欠款 | - | 正常审批流程 | ✅ 是 |
| 少量欠款 | <30天 | 警告提示 | ⚠️ 市场部决定 |
| 逾期欠款 | 30-60天 | 阻止+催款 | ❌ 需审批 |
| 严重逾期 | >60天 | 阻止+升级 | ❌ 需负责人审批 |

**紧急例外审批**:
- 紧急维修需求可由市场负责人(Cathy)审批例外
- 必须记录审批原因和审批人
- 同时触发催款流程

**信用额度机制**:
- **特殊经销商**: 仅部分特殊经销商具有credit账期（如一级大客户）
- **普通经销商**: 均要求付款后才发货，无信用额度
- 信用额度由管理层单独设置和调整

**扩展机制** (后续版本):
- 自动催款邮件
- 月度对账单

### 1.5.9 物流追踪机制

**快递单号状态类型**:
| 状态 | 说明 | 系统处理 |
|-----|------|---------|
| 已填写 | 正常物流追踪 | 查询物流API，预估到达 |
| 待补填 | RMA已生成，单号稍后填写 | 定期提醒(3天/7天) |
| 上门送达 | 直接送到深圳 | 记录预约时间 |
| Kine取件 | 公司安排取件 | 生成取件任务 |
| 集中发货 | 多个RMA合并一个包裹 | 关联多个工单 |

**预估收货时间**:
| 发货地 | 快递方式 | 预估天数 |
|-------|---------|---------|
| 英国 | DHL/UPS | 5-7天 |
| 欧洲大陆 | DHL | 5-8天 |
| 美国 | FedEx/UPS | 7-10天 |
| 东南亚 | DHL | 3-5天 |
| 澳洲 | DHL | 7-10天 |
| 国内 | 顺丰/京东 | 1-3天 |

**自动通知触发**:
- 快递单号填写 → 通知生产部、市场部
- 物流到达深圳 → 通知生产部准备收货
- 收货确认 → 通知经销商/客户

### 1.5.10 维修异常处理机制

**异常类型定义**:
| 异常类型 | 触发条件 |
|---------|---------|
| 成本超预估 | 实际费用 > 预估费用 × 150% |
| 严重损坏 | 设备进水/烧毁/严重摔坏 |
| 需换整机 | 维修成本 ≥ 整机价值60% |
| 人为损坏 | 非保修范围的人为问题 |
| 无法修复 | 关键部件损坏无法维修 |
| 发现其他问题 | 维修中发现额外问题 |

**处理流程**:
```
生产部发现异常 → 提交异常报告 → 暂停维修 → 
市场部与客户沟通 → 客户选择处理方式 → 继续/取消/换新/报废
```

**客户处理选项**:
| 选项 | 说明 | 费用 |
|-----|------|------|
| 确认继续维修 | 接受新报价 | 新报价金额 |
| 取消维修，原机退回 | 放弃维修 | $0（暂不收检测费） |
| 以旧换新 | 旧机折价换新机 | 新机价-折价 |
| 报废处理 | 设备无维修价值 | $0 |

**审批权限**:
| 异常金额 | 审批人 |
|---------|-------|
| 超预估 < $100 | 市场部业务员 |
| 超预估 $100-$500 | 市场部负责人 |
| 超预估 > $500 | 管理层 |

### 1.5.11 定期自动报告体系

**报告类型**:
| 报告名称 | 频率 | 收件人 | 内容 |
|---------|------|--------|------|
| 经销商库存周报 | 每周一 | 市场部负责人 | 各经销商库存、使用量、预警 |
| 经销商维修月报 | 每月1日 | 市场部、Cathy | 维修数量、问题分布、配件消耗 |
| 库存预警通知 | 实时 | 市场部 | 预警配件、建议补货量 |
| 欠款预警通知 | 每周/实时 | 市场部、财务 | 欠款金额、账龄、未结PI |
| 工单处理周报 | 每周一 | 部门负责人 | 新增/关闭工单、处理效率 |
| P1/R1紧急汇总 | 实时 | 管理层 | 紧急工单详情 |
| 产品质量月报 | 每月1日 | 研发、管理层 | 按产品问题分布、趋势 |

**推送方式**:
- 邮件: 富文本格式(HTML排版在邮件正文，不生成PDF附件)
- App通知: 摘要+跳转链接
- 系统站内信: 保留历史记录

### 1.5.5 经销商配件库存管理

**功能需求**:
- 查看当前配件库存数量
- 记录配件使用（关联工单）
- 配件补货申请
- 待寄回问题配件管理
- 库存使用报表（按月/季度）

---

## 1.6 系统入口设计

### 1.5.1 外部入口 (客户/KOL)

**入口方式**: 官网嵌入 / 小程序 / 独立页面

**可用功能**:
| 功能 | 说明 |
|-----|------|
| 提交问题反馈 | 填写问题描述、上传图片/视频、关联产品序列号 |
| 查看我的工单 | 查看自己提交的工单状态和处理进度 |
| 知识库查询（AI辅助） | 输入问题，智能检索知识库返回解决方案 |
| 知识库浏览 | 浏览FAQ、Troubleshooting、兼容性列表 |

**典型场景**:
```
客户: "我的Eagle HDMI连接FX3后画面闪烁"
        ↓
知识库智能检索（AI辅助）
        ↓
返回: "请检查HDMI输出设置，建议设为1080p 50fps [参考: KB-0023]
      若问题持续，请提交工单"
```

### 1.5.2 经销商入口

**入口方式**: Web登录 (与员工同入口，按角色区分)

**可用功能**:
| 功能 | 说明 |
|-----|------|
| 创建服务记录 | 记录客户咨询、问题排查过程 |
| 代客户创建返修工单 | 确认需要返修时创建 |
| 查看客户服务记录/工单 | 查看自己客户的所有记录 |
| 简单维修处理 | 使用库存配件本地维修 |
| 申请RMA | 申请返修授权号 |
| 知识库查询（AI辅助） | 智能检索Dealer级知识库 |
| 知识库浏览 | Public + Dealer级知识 |
| 基础统计 | 自己客户的问题统计 |

### 1.5.3 内部入口 - 市场部

**入口方式**: Web端 + iOS端

**核心职责**: 服务响应、客户沟通、返修协调

**可用功能**:
| 功能 | 权限 |
|-----|------|
| 创建/编辑服务记录 | 全部 |
| 创建/编辑返修工单 | 全部 |
| 分配返修工单 | 分配给生产部 |
| 记录解决方案(对客户) | 填写对客户的处理方案 |
| RMA管理 | 创建/管理RMA号 |
| 收款记录 | 记录收款渠道、金额、日期 |
| 知识库编辑 | 创建/编辑知识条目 |
| 统计报表 | 全部统计功能 |

**典型工作流**:
```
1. 收到客户/经销商反馈
2. 创建服务记录，记录问题和沟通过程
3. 判断是否需要返修
   - 不需要: 提供解决方案，关闭服务记录
   - 需要: 升级为返修工单，创建RMA，分配给生产部
4. 跟踪处理进度
5. 客户确认后关闭
6. (可选) 沉淀知识到知识库
```

### 1.5.4 内部入口 - 生产部/维修

**入口方式**: Web端

**核心职责**: 维修执行、问题分析

**可用功能**:
| 功能 | 权限 |
|-----|------|
| 查看分配的工单 | 已分配给自己/部门的工单 |
| 填写维修内容 | 更换了什么部件、具体操作 |
| 填写问题分析 | 根因分析、芯片/PCB问题等 |
| 更新工单状态 | 维修中 → 已完成 |
| 内部知识库 | 维修手册、部件更换指南 |
| 生产问题反馈 | 反馈批次问题、工艺改进建议 |

**典型工作流**:
```
1. 收到市场部分配的RMA工单
2. 收货验机
3. 诊断问题，填写分析结果
4. 执行维修，记录维修内容
5. 测试验收
6. 更新工单状态为已完成
7. (可选) 提交生产问题反馈
```

### 1.5.5 内部入口 - 研发部

**入口方式**: Web端

**核心职责**: 问题分析、产品改进

**可用功能**:
| 功能 | 权限 |
|-----|------|
| 查看全部工单 | 只读，用于分析 |
| 高级统计分析 | 批次分析、趋势分析、根因分析 |
| AI工单分析 | 发现问题模式、预警 |
| 固件知识管理 | 维护固件版本知识库 |
| 问题追踪 | 追踪特定问题的修复进度 |

### 1.5.6 管理层入口

**入口方式**: Web端 (Dashboard)

**可用功能**:
| 功能 | 说明 |
|-----|------|
| 数据大盘 | 关键指标一览 |
| 趋势报表 | 问题趋势、处理效率趋势 |
| 产品质量报告 | 按产品线的质量分析 |
| 经销商报告 | 各经销商问题统计 |
| AI周报/月报 | AI自动生成的分析报告 |

---

## 2. 核心功能模块

### 2.1 查询与统计系统 (核心重点)

#### 2.1.1 查询维度设计

| 维度类别 | 维度项 | 说明 |
|---------|--------|------|
| **产品维度** | 产品型号 | MAVO Edge 8K, MAVO LF 等 |
| | 产品线/系列 | MAVO系列, TERRA系列, KineBACK |
| | 固件版本 | 关联特定固件版本的问题 |
| | 硬件版本/批次 | PCB版本、生产批次号 |
| **问题维度** | 问题类别 | 硬件故障/软件Bug/使用咨询/退换货/投诉 |
| | 严重程度 | 紧急/高/中/低 |
| | 问题状态 | 待处理/处理中/待验证/已关闭/已拒绝 |
| | 问题来源 | 线上反馈/线下送修/经销商反馈/内部测试 |
| | 问题大类 | 稳定性/素材/监看/SSD/音频/兼容性/时码/硬件结构 (参考现有知识库) |
| | 问题小类 | 无法开机/死机/画面异常/温度/横条白线/色彩异常/... |
| **客户维度** | 客户类型 | 企业/经销商/个人/政府/教育 |
| | 客户等级 | VIP/普通/新客户 |
| | 购买渠道 | 直销/经销商/电商平台 |
| **地区维度** | 国家 | 三级地区 |
| | 省份/州 | |
| | 城市 | |
| | 销售大区 | 华东/华南/华北/海外 (可配置) |
| **渠道维度** | 经销商/分销商 | 具体渠道商 |
| | 渠道类型 | 一级代理/二级代理/直营 |
| **人员维度** | 创建人 | 录入工单的员工 |
| | 处理人 | 当前负责人 |
| | 所属部门 | 销售/客服/研发/生产 |
| **时间维度** | 创建时间 | 支持范围查询 |
| | 更新时间 | |
| | 关闭时间 | |
| | 响应时长 | 首次响应耗时 |
| | 处理时长 | 完整处理周期 |

#### 2.1.2 查询能力

**基础查询**:
- 单维度筛选: `产品型号 = MAVO Edge 8K`
- 多维度 AND: `产品型号 = MAVO Edge 8K AND 问题类别 = 硬件故障`
- 多维度 OR: `国家 = 中国 OR 国家 = 美国`
- 混合条件: `(产品线 = MAVO OR 产品线 = TERRA) AND 严重程度 = 紧急`

**高级查询**:
- 时间范围: `创建时间 BETWEEN 2026-01-01 AND 2026-03-31`
- 模糊搜索: 标题/描述关键词搜索
- 批次追踪: `批次号 = 2026Q1-001` 查找同批次所有问题

**预置查询模板** (待讨论):
- [ ] 本周新增问题
- [ ] 我负责的问题
- [ ] 紧急未处理问题
- [ ] 某产品近30天问题趋势
- [ ] 某经销商问题统计

#### 2.1.3 统计分析

**统计类型**:

| 统计名称 | 维度 | 指标 | 图表类型 |
|---------|------|------|---------|
| 问题趋势 | 时间 (日/周/月) | 数量 | 折线图 |
| 产品问题分布 | 产品型号 | 数量/占比 | 饼图/柱状图 |
| 地区问题热力图 | 国家/省份 | 数量 | 地图/热力图 |
| 问题类别统计 | 问题类别 | 数量/占比 | 柱状图 |
| 经销商问题排行 | 经销商 | 数量 | 排行榜 |
| 处理效率 | 人员/部门 | 平均处理时长 | 柱状图 |
| 批次问题分析 | 批次号 | 问题数/问题率 | 表格 |

**交叉分析示例**:
- 产品 × 问题类别: 哪个产品的哪类问题最多？
- 地区 × 时间: 各地区问题趋势对比
- 经销商 × 产品: 哪个经销商卖的哪个产品问题最多？
- 批次 × 故障现象: 特定批次是否有共性问题？

**导出能力**:
- 查询结果导出 Excel/CSV
- 统计报表导出 PDF
- 定时报表邮件推送 (待讨论)

---

### 2.2 媒体文件管理 (图片/视频)

#### 2.2.1 上传限制

| 文件类型 | 单文件限制 | 单工单限制 | 说明 |
|---------|-----------|-----------|------|
| 图片 | 10 MB | 10 张 | 支持 JPG/PNG/HEIC |
| 视频 | 100 MB | 3 个 | 支持 MP4/MOV |

**待讨论**:
- [ ] 是否需要自动压缩？(图片压缩到 2MB 以下？)
- [ ] 视频是否需要转码？(统一转为 H.264 MP4？)
- [ ] 是否需要更大的视频限制？(如通过分片上传支持 500MB?)

#### 2.2.2 存储方案

**方案 A: 本地存储** (当前)
- 路径: `server/data/issue_attachments/{issue_id}/{filename}`
- 优点: 简单、无额外成本
- 缺点: 容量受限、无CDN加速

**方案 B: 对象存储** (待讨论)
- 使用阿里云 OSS / AWS S3
- 优点: 无限容量、CDN加速、更安全
- 缺点: 额外成本、需要配置

#### 2.2.3 访问控制

**需求**:
- 工单附件仅限有权限的用户访问
- 不能通过猜测 URL 直接下载

**方案**:
1. **Token 验证**: 访问附件需要有效的 JWT Token
2. **签名 URL** (如用对象存储): 生成有时效的签名链接
3. **代理下载**: 通过 API 代理下载，验证权限后返回文件

**预览方式**:
- 图片: 缩略图预览 + 原图查看
- 视频: 内嵌播放器 (HTML5 Video)
- iOS: 支持相册选取、拍照上传

---

### 2.3 知识库系统

> 参考现有知识库：EAGLE知识库.xlsx、Knowledge base_Edge.xlsx、固件Knowledge Base.xlsx

#### 2.3.1 知识分类体系

| 分类 | 说明 | 示例 | 来源参考 |
|-----|------|------|---------|
| **FAQ** | 常见问题与标准答案，区分内外部回答 | Eagle HDMI是否支持3D LUT导入？ | EAGLE知识库.xlsx |
| **故障排查 (Troubleshooting)** | 现象 → 多步骤排查流程 | 屏幕不亮 → 检查供电 → 检查开关 → 更换线缆... | EAGLE知识库-Troubleshooting |
| **兼容性列表** | 设备/配件兼容性测试结果 | Eagle HDMI + Sony FX6 + 1080p 50fps = ✓ | EAGLE知识库-兼容性表 |
| **固件知识** | 版本差异、新功能、已知问题 | 8023固件新增Uncompressed RAW | 固件Knowledge Base.xlsx |
| **基础知识** | 菜单含义、参数说明、操作指南 | 固件升级时数字1-12各代表什么模组 | Knowledge base_Edge-基础知识 |
| **问题案例库** | 历史问题的详细记录与解决方案 | Edge 8K死机案例 + 解决方法 | Knowledge base_Edge |
| **维修手册** | 内部维修指南 (仅内部) | 更换Sensor步骤 | Internal Only |

#### 2.3.2 问题分类维度 (来自现有知识库)

| 问题大类 | 问题小类 |
|---------|---------|
| **稳定性** | 无法开机、死机、画面异常、温度异常 |
| **素材** | 横条/白线/红点、色彩异常、素材号重复、录制异常 |
| **监看** | KineMON无画面、画面异常、功能BUG、触屏、SDI、颜色 |
| **SSD** | FLUSH、无法识别 |
| **音频** | 音频不完整、杂音/噪声/电流声 |
| **兼容性** | 第三方设备兼容问题 |
| **时码** | 时码显示/同步问题 |
| **硬件/结构** | ND、灰尘、风扇、人为损坏 |

#### 2.3.3 FAQ 条目结构 (内外部答案分离)

```
FAQ条目 {
  id: 唯一标识
  question: 问题描述
  
  // 答案分层 - 关键特性
  external_answer: 外部回答 (给客户/经销商看)
  internal_answer: 内部回答 (更详细的技术细节，仅员工可见)
  
  // 关联
  products: [关联产品列表]
  firmware_versions: [相关固件版本]
  tags: [标签列表]
  
  // 附件
  images: [图片列表]
  videos: [视频列表]
  
  // 元数据
  created_by, updated_by, created_at, updated_at
}
```

**示例** (来自EAGLE知识库):
```
问题: Eagle HDMI是否能控制相机的录制？
外部回答: 相机无法通过HDMI来控制录制，SDI和HDMI均为单向通信，只能传输元数据
内部回答: 相机是无法通过HDMI来控制的，只能是相机的录制状态通过HDMI传出给外部monitor或recorder；
         SDI也是单向通信，元数据包含录制状态、TC和Audio
```

#### 2.3.4 Troubleshooting 条目结构

```
Troubleshooting条目 {
  id: 唯一标识
  phenomenon: 问题现象 (如: "屏幕不亮、Logo灯、录制灯不亮")
  
  // 排查步骤 - 有序列表，支持分支
  steps: [
    { order: 1, action: "检查供电线缆是否插好，特别是0B5P的", next_if_fail: 2 },
    { order: 2, action: "检查Eagle电源开关是否打开", next_if_fail: 3 },
    { order: 3, action: "更换线缆尝试", next_if_fail: 4 },
    { order: 4, action: "使用USB-A转USB-C线测试...", 
      result_if_pass: "线缆或内部软排线问题",
      result_if_fail: "需更换主板" }
  ]
  
  // 关联
  products: [关联产品]
  related_cases: [相关工单/案例]
}
```

#### 2.3.5 兼容性列表结构

```
兼容性条目 {
  id: 唯一标识
  compatibility_type: 类型 (HDMI输入/HDMI输出/Type-C供电/元数据支持)
  
  // 测试对象
  our_product: 我方产品 (Eagle HDMI/Eagle SDI)
  external_device: 外部设备型号 (Sony FX6)
  external_device_brand: 品牌 (Sony)
  
  // 测试参数
  interface_type: 接口类型 (全尺寸HDMI A / Micro HDMI D)
  resolution: 分辨率 (1080p / 2160p)
  frame_rate: 帧率 (50 / 59.94)
  
  // 测试结果
  is_compatible: 是否兼容 (✓ / ✕)
  notes: 备注
  
  // 元数据支持 (针对特定类型)
  supports_rec_status: 录制状态显示
  supports_vu_meter: VU表
  supports_timecode: 时码
  
  // 测试信息
  tested_date: 测试日期
  tested_by: 测试人员
  firmware_version: 测试时固件版本
}
```

#### 2.3.6 问题案例结构 (来自Knowledge base_Edge)

```
问题案例 {
  id: 唯一标识
  
  // 问题分类
  category: 问题大类 (稳定性/素材/监看/SSD/...)
  sub_category: 问题小类 (无法开机/死机/画面异常/...)
  
  // 问题描述
  phenomenon: 具体现象
  analysis: 问题分析
  
  // 售后步骤
  service_steps: [售后处理步骤列表]
  
  // 具体案例
  cases: [{
    date: 反馈时间,
    product_model: 机型 (Edge 8K / Edge 6K),
    firmware_version: 固件版本,
    reporter: 反馈人,
    description: 详细描述,
    media_links: [图片/视频链接],
    solution: 解决方法,
    serial_number: 序列号 (可选)
  }]
  
  // 生产工艺变更提示
  manufacturing_notes: 生产工艺变更说明
}
```

#### 2.3.7 固件知识结构

```
固件知识条目 {
  id: 唯一标识
  firmware_version: 固件版本 (如: 8023)
  compare_version: 对比版本 (如: 7314/7318)
  
  // 新功能
  new_features: [{
    name: 功能名称,
    description: 功能说明
  }]
  
  // 问题与解答
  qa_items: [{
    category: 分类 (RAW/ProRes BT.2020/自定义按键/其他),
    question: 问题,
    answer: 答案,
    notes: 备注
  }]
}
```

#### 2.3.8 权限分级

| 可见性 | 说明 | 可见内容 | 内容示例 |
|-------|------|---------|---------|
| **Public** | 完全公开(3.0阶段向终端用户开放) | 外部回答、基础兼容性列表、产品说明书 | MAVO Edge 6K操作说明书 |
| **Dealer** | 经销商可见 | Public + 维修手册、产品知识库 | EAGLE维修手册、Knowledge base_Edge |
| **Internal** | 内部员工 | 全部内容 (含内部回答、敏感资料) | 内部分析报告、成本信息等 |
| **Department** | 特定部门 | 如维修手册仅售后/研发可见 | 生产工艺资料 |

#### 2.3.9 组织方式

采用 **混合模式**：
- **按产品线组织**: Eagle系列 / MAVO Edge系列 / TERRA系列
- **按知识类型组织**: FAQ / Troubleshooting / 兼容性 / 固件知识
- **通用知识库**: 跨产品的通用内容

```
知识库
├── 产品知识
│   ├── Eagle HDMI
│   │   ├── FAQ
│   │   ├── Troubleshooting
│   │   ├── 兼容性列表
│   │   └── 问题案例
│   ├── Eagle SDI
│   ├── MAVO Edge 8K
│   └── ...
├── 固件知识
│   ├── 8.0 (8023)
│   ├── 7.3 (7314)
│   └── ...
└── 通用知识
    ├── SSD使用指南
    ├── 供电方案
    └── ...
```

#### 2.3.10 知识库维护流程

```
创建知识 → 审核 → 发布
             ↓
          修订 → 审核 → 发布新版本
```

**角色权限**:
- **查看者**: 只能浏览
- **编辑者**: 可创建/编辑草稿
- **审核者**: 可审核发布
- **管理员**: 可删除/设置权限

#### 2.3.6 知识库与工单联动

- 创建工单时: 智能推荐相关知识 (基于问题描述)
- 处理工单时: 可引用知识库内容作为解决方案
- 关闭工单时: 可将解决方案沉淀为新知识条目

---

### 2.4 AI 智能问答系统

#### 2.4.1 系统架构

```
用户提问
    ↓
┌─────────────────────────────────────────────┐
│              AI 问答引擎                      │
│  ┌─────────────┐    ┌─────────────────────┐ │
│  │ 本地知识库   │    │   在线知识源         │ │
│  │ (向量检索)   │    │ - 官网文档          │ │
│  │             │    │ - 指定URL爬取       │ │
│  └─────────────┘    └─────────────────────┘ │
│           ↓                   ↓              │
│         上下文整合 + Prompt 构建             │
│                     ↓                        │
│              LLM 生成回答                    │
└─────────────────────────────────────────────┘
    ↓
智能回答 / 引导式 Troubleshooting
```

#### 2.4.2 查询入口设计

| 用户类型 | 查询方式 | 知识范围 |
|---------|---------|---------|
| **公开用户** | 官网聊天窗口 / 小程序 | Public 知识 + 官网内容 |
| **经销商** | 登录后问答入口 | Public + Dealer 知识 |
| **内部员工** | 工单系统内置问答 | 全部知识库 |

**查询模式**:

1. **直接问答模式**
   - 用户输入自然语言问题
   - AI 检索相关知识 + 生成答案
   - 返回: 答案 + 引用来源

2. **引导式 Troubleshooting**
   - 用户描述问题现象
   - AI 逐步询问补充信息
   - 根据排查树引导定位原因
   - 给出解决方案或建议创建工单

3. **传统文档搜索**
   - 关键词搜索知识条目
   - 分类浏览

#### 2.4.3 知识源配置

**本地知识库** (向量化存储):
- 所有知识条目的 Embedding
- 历史工单的问题描述和解决方案
- 产品手册/规格书 (PDF 解析)

**在线知识源** (可配置):
- 官网 FAQ 页面 URL
- 产品页面 URL
- 技术博客/论坛 (如有)
- 定期爬取 + 更新 Embedding

#### 2.4.4 AI 服务商推荐 (低成本方案)

##### 国外方案

| 服务商 | 模型 | 定价 | 优势 | 劣势 |
|-------|------|------|------|------|
| **OpenAI** | GPT-4o-mini | $0.15/1M input, $0.60/1M output | 质量好、稳定 | 需要翻墙 |
| **Google** | Gemini 1.5 Flash | 免费额度: 15 RPM, 超出后 $0.075/1M | 免费额度慷慨 | 国内访问受限 |
| **Anthropic** | Claude 3 Haiku | $0.25/1M input, $1.25/1M output | 长上下文、安全 | 国内访问受限 |
| **Groq** | Llama 3 70B | 免费额度 (有 Rate Limit) | 完全免费、速度极快 | 稳定性待验证 |
| **Together AI** | Llama 3 / Mixtral | $0.20-0.90/1M | 多模型选择 | 小厂 |

##### 国内方案

| 服务商 | 模型 | 定价 | 优势 | 劣势 |
|-------|------|------|------|------|
| **阿里云 通义千问** | Qwen-turbo | ¥0.008/千 tokens | 便宜、国内稳定 | 质量一般 |
| **阿里云 通义千问** | Qwen-max | ¥0.12/千 tokens | 质量好 | 较贵 |
| **百度 文心一言** | ERNIE-Speed | 免费 (有额度) | 完全免费 | 质量一般 |
| **智谱 AI** | GLM-4-Flash | 免费 (限额) | 免费、质量不错 | 限额 |
| **智谱 AI** | GLM-4-Air | ¥0.001/千 tokens | 极便宜 | - |
| **月之暗面 Kimi** | Moonshot-v1-8k | ¥0.012/千 tokens | 长文本能力强 | 新厂商 |
| **DeepSeek** | DeepSeek-chat | ¥0.001/千 tokens | 极便宜、质量好 | 新厂商 |
| **硅基流动 SiliconFlow** | 多模型 | 部分免费 | 聚合平台 | - |

##### 推荐组合

**方案 A: 国内优先 (推荐)**
- 主力: **DeepSeek** 或 **智谱 GLM-4-Air** (极低成本)
- 备用: **通义千问 Qwen-turbo**
- 估算成本: 1000次问答/月 ≈ ¥10-30

**方案 B: 国外优先**
- 主力: **Groq (Llama 3)** 免费额度
- 备用: **OpenAI GPT-4o-mini**
- 估算成本: 免费额度内 ¥0，超出后 $5-20/月

**方案 C: 混合部署**
- 国内用户 → 国内 API (DeepSeek/智谱)
- 海外用户 → 国外 API (Groq/OpenAI)

#### 2.4.5 向量检索方案

| 方案 | 说明 | 成本 | 适用场景 |
|-----|------|------|---------|
| **SQLite + sqlite-vec** | 本地向量扩展 | 免费 | 小规模 (<10万条) |
| **ChromaDB** | 轻量级向量数据库 | 免费 | 中小规模 |
| **Pinecone** | 云向量数据库 | 免费层 + 付费 | 需要高可用 |
| **阿里云 向量检索** | 托管服务 | 按量付费 | 国内部署 |

**推荐**: 先用 **SQLite + sqlite-vec** 或 **ChromaDB**，数据量大了再迁移云服务。

#### 2.4.6 Embedding 模型

| 模型 | 维度 | 成本 | 说明 |
|-----|------|------|------|
| **OpenAI text-embedding-3-small** | 1536 | $0.02/1M tokens | 质量好 |
| **智谱 Embedding-2** | 1024 | 免费额度 | 国内可用 |
| **BGE-M3 (本地)** | 1024 | 免费 | 需要 GPU 或较长时间 |
| **Sentence-Transformers (本地)** | 384-768 | 免费 | CPU 可跑 |

**推荐**: 小规模用 **智谱 Embedding** (免费)，或本地部署 **BGE-M3**

### 2.4.7 AI 应用场景扩展

> **核心原则**: AI分析/推荐 → 人工确认/选择 → 执行
> 所有AI场景采用"AI建议 + 人工授权"模式，确保人始终掌控决策。

##### 场景 1: 知识库 + 工单联合查询

```
用户提问: "MAVO Edge 8K 录制时突然停止是什么原因？"
    ↓
AI 检索范围:
├── 知识库: FAQ、故障排查指南、产品说明
└── 历史工单: 相似问题的描述、处理过程、解决方案
    ↓
生成答案 (带引用索引):
"根据历史记录，MAVO Edge 8K 录制中断通常有以下原因：
 1. SSD 写入速度不足 [参考: KB-0023, 工单 #IS-2025-0847]
 2. 高温保护触发 [参考: KB-0045]
 3. 电池电量不足 [参考: 工单 #IS-2026-0012, #IS-2026-0089]
 
 建议排查步骤..."
```

**引用索引格式**:
- 知识库: `[KB-{编号}]` → 可点击跳转到知识条目
- 工单: `[工单 #{编号}]` → 可点击跳转到工单详情 (需权限)

##### 场景 2: AI 工单分析

| 分析类型 | 说明 | 输出 |
|---------|------|------|
| **问题模式识别** | 分析近期工单，发现共性问题 | "近30天有12个工单提到'开机黑屏'，集中在批次 2026Q1-003" |
| **趋势预警** | 检测异常增长的问题类型 | "存储相关问题本周增长 200%，建议关注" |
| **根因分析** | 对特定问题进行深入分析 | "批次 X 的问题可能与供应商 Y 的元器件相关" |
| **工单聚类** | 自动将相似工单归类 | 将分散的工单聚合为"同一问题的多个表现" |
| **解决方案推荐** | 基于历史成功案例推荐方案 | "类似问题的 85% 通过固件升级解决" |

##### 场景 3: AI 辅助查询

**智能查询建议**:
```
用户输入: "最近华东地区问题比较多"
    ↓
AI 理解意图 → 生成结构化查询:
  - 地区 = 华东
  - 时间 = 近30天
  - 排序 = 数量降序
    ↓
自动执行查询 + 生成洞察:
"华东地区近30天共 45 个工单，环比增长 30%。
 主要集中在：
 - MAVO Edge 8K (23个，占51%)
 - 问题类型: 存储相关 (18个，占40%)
 建议关注经销商 XX，其问题数量最多 (12个)"
```

**查询优化建议**:
- 用户查询结果过多时: "检测到 500+ 结果，建议添加筛选条件：产品型号 或 时间范围"
- 用户查询无结果时: "未找到结果，建议放宽条件：移除'严重程度=紧急'筛选"

##### 场景 4: AI 自动标签与分类

**自动化处理**:
- 新工单创建时: AI 自动建议分类、严重程度、相关产品
- 工单关闭时: AI 建议提取知识点沉淀到知识库
- 批量处理: AI 识别重复/相似工单，建议合并

##### 场景 5: AI 报告生成

**自动化报告**:
```
用户指令: "帮我生成本月产品质量报告"
    ↓
AI 自动:
├── 汇总本月工单数据
├── 按产品/问题类型/地区分析
├── 对比上月数据，计算环比变化
├── 识别关键问题和趋势
└── 生成结构化报告 (可导出 PDF/Word)
```

##### 场景 6: 多语言智能支持

| 场景 | AI 能力 |
|-----|--------|
| **知识库翻译** | 自动将中文知识翻译为英文/德文/日文 |
| **工单翻译** | 海外经销商提交的英文工单自动翻译展示 |
| **多语言问答** | 用户用英文提问，AI 检索中文知识库，用英文回答 |

#### 2.4.8 AI 集成架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                        AI 中枢服务                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │
│   │  智能问答     │    │  工单分析     │    │  查询辅助     │     │
│   │  - 知识检索   │    │  - 模式识别   │    │  - 意图理解   │     │
│   │  - 工单检索   │    │  - 趋势预警   │    │  - 查询生成   │     │
│   │  - 答案生成   │    │  - 根因分析   │    │  - 结果解读   │     │
│   └──────────────┘    └──────────────┘    └──────────────┘     │
│           │                   │                   │             │
│           └───────────────────┼───────────────────┘             │
│                               ↓                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    统一向量检索层                         │  │
│   │   知识库 Embeddings  |  工单 Embeddings  |  产品文档     │  │
│   └─────────────────────────────────────────────────────────┘  │
│                               ↓                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                      LLM 调用层                          │  │
│   │   DeepSeek / 智谱 / Qwen (国内)  |  Groq / OpenAI (海外) │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                               ↑
        ┌──────────────────────┼──────────────────────┐
        ↓                      ↓                      ↓
   ┌─────────┐           ┌─────────┐           ┌─────────┐
   │ Web 端  │           │ iOS 端  │           │ 公开入口 │
   │ (员工)  │           │ (员工)  │           │(用户/经销商)│
   └─────────┘           └─────────┘           └─────────┘
```

#### 2.4.9 AI应用场景汇总

> 详细场景流程见 `IssueTracker_UserScenarios.md` 第9节

**一、工单创建与处理**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 工单智能分类 | 根据问题描述推荐：类别、小类、严重程度 | 一键确认或调整 | 减少手动选择 |
| 优先级智能建议 | 根据客户类型、问题严重性推荐P1-P3/R1-R3 | 确认或调整 | 统一判断标准 |
| 处理人智能分配 | 根据专长、工作量推荐2-3个处理人 | 选择一个 | 均衡工作量 |
| 相似工单识别 | 识别历史相似工单，提示"可能重复" | 确认关联或合并 | 避免重复 |
| 智能回复建议 | 根据问题+知识库生成2-3条回复建议 | 选择/编辑后发送 | 加速响应 |

**二、知识库智能管理**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 知识点自动提取 | 工单关闭时判断是否值得沉淀为知识点 | 确认/编辑后发布 | 自动积累知识 |
| 高频问题识别 | 识别重复出现但无知识库条目的问题 | 确认后生成FAQ草稿 | 发现知识缺口 |
| 知识条目更新建议 | 发现工单有更好方案时提示更新 | 确认更新 | 保持时效性 |

**三、维修与返修流程**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 故障原因诊断 | 根据描述+历史数据推测故障原因(概率排序) | 参考判断 | 辅助远程诊断 |
| 维修方案推荐 | 基于诊断生成维修方案+预估费用 | 确认或调整 | 快速出报价 |
| 批次问题预警 | 发现同批次多个类似问题自动预警 | 确认是否升级 | 早期发现问题 |
| 维修记录规范化 | 规范化用语、补充标准术语 | 确认保存 | 统一记录格式 |

**四、客户沟通**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 邮件/通知起草 | 根据状态变更自动起草通知内容 | 确认/编辑后发送 | 减少重复写作 |
| 多语言翻译 | 自动翻译工单和回复(英↔中) | 确认译文 | 跨语言沟通 |
| 客户情绪识别 | 分析客户描述情绪，提示优先处理 | 参考调整优先级 | 避免投诉升级 |

**五、经销商管理**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 补货量智能建议 | 根据消耗速度、库存水位推荐补货量 | 确认或调整 | 避免断货/积压 |
| 结算异常检测 | 检测异常数据(使用量突增等) | 确认是否需核实 | 防止错误/舞弊 |

**六、统计与报告**
| 场景 | AI能力 | 人工操作 | 价值 |
|-----|--------|---------|------|
| 报告智能摘要 | 自动生成周报/月报关键洞察摘要 | 直接使用或编辑 | 快速抓重点 |
| 异常趋势预警 | 检测指标异常变化，主动推送预警 | 查看并决定处理 | 早期发现问题 |
| 自然语言查询 | 将自然语言转化为结构化查询 | 查看结果 | 降低查询门槛 |

#### 2.4.10 AI实现优先级

**Phase 1 (核心价值，优先实现)**:
1. 工单智能分类 + 优先级建议
2. 智能回复建议
3. 知识点自动提取
4. 故障原因诊断 + 维修方案推荐
5. 报告智能摘要

**Phase 2 (提升效率)**:
6. 高频问题识别
7. 相似工单识别
8. 补货量智能建议
9. 批次问题预警
10. 邮件/通知自动起草

**Phase 3 (深度应用)**:
11. 处理人智能分配
12. 知识条目更新建议
13. 自然语言查询
14. 客户情绪识别
15. 结算异常检测
16. 维修记录规范化
17. 多语言翻译

---

## 3. 数据模型设计 (草案)

> 参考: A02-产品返修记录.xlsx 实际字段结构

### 3.0 分层记录模型

系统采用分层记录模型，区分轻量级服务记录和完整返修工单：

```
客户联系 → 创建服务记录 → 排查/咨询
                         ├─ 解决 → 关闭服务记录
                         └─ 需返修 → 升级为返修工单
```

| 记录类型 | 适用场景 | 特点 |
|---------|---------|------|
| **服务记录** | 咨询问答、问题排查、远程协助 | 轻量级，快速记录，无需完整流程 |
| **返修工单** | 确定需要寄回维修的情况 | 完整流程：物流→检测→维修→结算 |

**转换规则**：
- 服务记录状态变为"转工单"时，自动创建关联的返修工单
- 返修工单保留原始服务记录ID，可追溯沟通历史

### 3.1 核心实体

```
products (产品)
├── id, name, model
├── category (电影机/寻像器/配件/线缆)
├── series (Edge/MM2/Terra/Eagle)
├── current_firmware_version
└── created_at

customers (客户)
├── id, name, company, contact_info
├── customer_type (终端客户/KOL/媒体)
├── customer_level (VIP/普通/新客户)
├── country, province, city
├── dealer_id (关联经销商，可为空)
└── created_at

dealers (经销商/渠道商)
├── id, name, code
├── dealer_type (一级代理/二级代理/直营)
├── region (销售大区: 华东/华南/华北/海外)
├── country, province, city
├── contact_info
└── created_at

users (系统用户 - 员工)
├── id, name, email
├── department (市场部/生产部/研发部/管理层)
├── role (admin/editor/viewer)
├── region_responsible (国内/国外，针对市场部)
└── created_at

service_records (服务记录 - 咨询/排查)
├── id
├── record_number: 记录编号 (自动生成，如: SR-2026-0001)
│
├── // 客户信息 (代客户服务模式下可选填写)
├── customer_name: 客户姓名 (可选，不填显示"匿名客户")
├── customer_contact: 联系方式 (可选)
├── customer_id: 关联客户 (可为空)
├── dealer_id: 关联经销商 (可为空)
│
├── // 产品信息 (可选)
├── product_id: 关联产品 (可为空)
├── serial_number: 序列号 (可为空)
│
├── // 服务内容
├── service_type: 服务类型 (咨询/问题排查/远程协助/投诉)
├── channel: 沟通渠道 (电话/邮件/微信/企业微信)
├── problem_summary: 问题摘要
├── communication_log: 沟通记录 (问题描述 + 处理过程)
├── resolution: 处理结果
│
├── // 处理信息
├── handler_id: 处理人ID
├── handler_name: 处理人姓名
│
├── // 状态管理
├── status: 状态 (处理中/待客户反馈/已解决/自动关闭/转工单)
├── status_changed_at: 最近状态变更时间
├── waiting_customer_since: 进入待反馈状态的时间 (用于计算自动关闭)
│
├── // 时间追踪 (系统自动计算)
├── first_response_at: 首次响应时间
├── first_response_minutes: 首次响应时长(分钟)
├── total_duration_minutes: 总服务时长(分钟)
├── effective_duration_minutes: 有效处理时长(分钟) - 扣除等待时间
├── waiting_duration_minutes: 等待客户反馈累计时长(分钟)
│
├── // 关联
├── related_issue_id: 关联工单ID (升级后填写)
├── related_issue_type: 关联工单类型 (本地工单/返修工单)
├── reopened_from_id: 如是重新打开，原服务记录ID
│
├── // 自动关闭提醒
├── auto_close_reminder_sent: 是否已发送关闭提醒 (第5天)
├── auto_close_at: 预计自动关闭时间
│
└── created_at, updated_at
```

### 3.2 工单实体 (核心)

```
issues (工单/返修记录)
├── id
├── rma_number: RMA返修授权号 (仅返修工单需要，如: RA090111)
├── issue_number: 工单编号 (自动生成)
├── service_record_id: 关联服务记录ID (从服务记录升级时填写)
│
├── // 工单类型
├── ticket_type: 工单类型 (本地工单/返修工单)
│   // 本地工单: 经销商自行维修，编号格式 LR-2026-0001
│   // 返修工单: 寄回总部维修，编号格式 IS-2026-0001
│
├── // 问题分类
├── issue_type: 来源类型 (生产问题/发货问题/客户返修/内部样机)
├── issue_category: 大类 (稳定性/素材/监看/SSD/音频/兼容性/时码/硬件结构)
├── issue_subcategory: 小类 (无法开机/死机/画面异常/...)
├── severity: 等级 (1级/2级/3级)
│
├── // 产品信息
├── product_id: 关联产品
├── serial_number: 序列号 (如: KVF_104036, ME_207624)
├── firmware_version: 固件版本
├── hardware_version: 硬件版本/批次
│
├── // 问题描述 (市场部填写)
├── problem_description: 问题描述
├── solution_for_customer: 解决方案(对客户)
├── is_warranty: 是否在保
│
├── // 维修信息 (生产部填写)
├── repair_content: 维修内容 (更换了什么部件)
├── problem_analysis: 问题分析 (PCB/芯片分析)
│
├── // 关联人员
├── reporter_name: 反馈人姓名
├── reporter_type: 反馈人类型 (客户/经销商/内部)
├── customer_id: 关联客户 (可为空)
├── dealer_id: 关联经销商 (可为空)
├── region: 地区 (国内/国外/具体国家)
│
├── // 内部负责人
├── submitted_by: 提交人(市场部)
├── assigned_to: 当前处理人(生产部)
├── created_by: 创建人
│
├── // 收款信息
├── payment_channel: 收款渠道 (微信/支付宝/对公转账)
├── payment_amount: 收款金额
├── payment_date: 收款日期
│
├── // 状态与时间
├── status: 状态 (待处理/处理中/已维修/待收款/已关闭)
├── feedback_date: 反馈时间
├── ship_date: 发货日期 (原始发货)
├── received_date: 收货日期 (返修收货)
├── completed_date: 完成日期
│
├── // 外部链接
├── external_link: 返修工单链接 (企业微信文档等)
│
└── created_at, updated_at
```

### 3.3 工单附件

```
issue_attachments (工单附件)
├── id, issue_id
├── file_name, file_path, file_url
├── file_size, file_type (image/video)
├── mime_type
├── uploaded_by
└── created_at
```

### 3.4 工单评论/跟进记录

```
issue_comments (工单评论)
├── id, issue_id
├── comment_type: 类型 (进度更新/内部备注/客户沟通)
├── content: 内容
├── author_id, author_name, author_department
├── is_internal: 是否仅内部可见
└── created_at
```

### 3.5 生产问题反馈 (F0)

```
production_feedbacks (生产问题反馈)
├── id
├── feedback_date: 反馈日期
├── ship_date: 发货日期
├── category: 分类 (生产/发货/返修/检测维修)
├── severity: 等级 (1级/2级/3级)
├── product_name: 反馈产品
├── serial_number: 序列号
├── problem_description: 反馈问题
├── communication_feedback: 沟通反馈
├── reporter: 反馈人/客户
├── responsible_person: 负责人
├── order_responsible: 订单负责人
├── remarks: 备注
├── related_issue_id: 关联工单 (可为空)
└── created_at, updated_at
```

### 3.6 知识库实体

```
knowledge_articles (知识库条目)
├── id, article_number (如: KB-0023)
├── title: 标题
├── knowledge_type: 类型 (FAQ/Troubleshooting/兼容性/固件知识/基础知识/问题案例/维修手册)
│
├── // FAQ特有
├── question: 问题 (FAQ类型)
├── external_answer: 外部回答
├── internal_answer: 内部回答
│
├── // 通用
├── content: 正文内容 (Markdown)
├── visibility: 可见性 (Public/Dealer/Internal/Department)
│
├── // 关联
├── related_issues: [关联工单ID列表]
├── firmware_version: 相关固件版本
│
├── // 版本控制
├── version, status (draft/published)
├── created_by, updated_by
└── created_at, updated_at

knowledge_products (知识-产品关联)
├── knowledge_id, product_id

knowledge_tags (知识标签)
├── knowledge_id, tag

troubleshooting_steps (故障排查步骤)
├── id, knowledge_id
├── step_order: 步骤顺序
├── action: 操作内容
├── result_if_pass: 通过后结果
├── result_if_fail: 失败后结果
├── next_step_if_fail: 失败后下一步

compatibility_entries (兼容性条目)
├── id, knowledge_id
├── our_product: 我方产品
├── external_device: 外部设备
├── external_brand: 外部品牌
├── interface_type, resolution, frame_rate
├── is_compatible: 是否兼容
├── supports_rec_status, supports_vu, supports_timecode
├── notes, tested_date, tested_by
```

### 3.7 经销商配件库存管理

```
dealer_inventory (经销商配件库存)
├── id
├── dealer_id: 经销商ID
├── sku: 配件SKU
├── sku_name: 配件名称
├── quantity: 当前数量
├── safety_stock: 安全库存线
├── last_replenishment_date: 上次补货日期
├── last_replenishment_quantity: 上次补货数量
└── created_at, updated_at

dealer_inventory_transactions (库存变动记录)
├── id
├── dealer_id: 经销商ID
├── sku: 配件SKU
├── transaction_type: 变动类型 (初始化/补货/使用/退回/调整)
├── quantity_change: 变动数量 (+/-)
├── quantity_before: 变动前数量
├── quantity_after: 变动后数量
├── related_issue_id: 关联工单 (使用时)
├── related_replenishment_id: 关联补货单 (补货时)
├── reason: 变动原因
├── operator_id: 操作人
└── created_at

replenishment_requests (补货申请)
├── id
├── request_number: 补货单号 (如: REP-2026-001)
├── dealer_id: 经销商ID
├── status: 状态 (待审核/审核中/已通过/已拒绝/已发货/已收货)
│
├── // 申请内容
├── items: [{ sku, quantity, reason }] JSON数组
├── total_items: 总品类数
├── total_quantity: 总数量
│
├── // 欠款检查
├── outstanding_amount: 申请时未结清金额
├── outstanding_age_days: 最长欠款账龄
├── debt_check_passed: 欠款检查是否通过
│
├── // 审核信息
├── approved_by: 审核人
├── approved_at: 审核时间
├── approval_note: 审核备注
├── is_emergency: 是否紧急例外
│
├── // 发货信息
├── shipped_at: 发货时间
├── tracking_number: 快递单号
├── received_at: 收货确认时间
│
├── created_by: 申请人
└── created_at, updated_at
```

### 3.8 维修发票与结算

```
repair_invoices (维修发票/PI)
├── id
├── invoice_number: 发票编号 (如: PI-2026-0001)
├── invoice_date: 开票日期
│
├── // 关联信息
├── dealer_id: 经销商ID (经销商结算时)
├── customer_id: 客户ID (散户时)
├── issue_id: 关联工单
├── rma_number: RMA号
│
├── // 产品信息
├── product_model: 产品型号
├── serial_number: 序列号
├── warranty_status: 保修状态 (在保/过保)
│
├── // 费用明细
├── items: [{ sku, name, quantity, unit_price, subtotal }] JSON
├── parts_total: 配件总费用
├── labor_fee: 人工费
├── shipping_fee: 运费
├── other_fee: 其他费用
├── total_amount: 总金额
├── currency: 货币 (USD/EUR/CNY)
│
├── // 地址信息
├── bill_to_address: 账单地址 JSON
├── ship_to_address: 收货地址 JSON
│
├── // 问题描述
├── problem_description: 问题描述
├── analysis: 原因分析
├── solution: 解决方案
│
├── // 状态
├── status: 状态 (草稿/已发送/待付款/已付款/已取消)
├── sent_at: 发送时间
├── paid_at: 付款时间
├── payment_method: 付款方式
│
├── created_by: 创建人
└── created_at, updated_at

dealer_settlements (经销商定期结算)
├── id
├── settlement_number: 结算单号
├── dealer_id: 经销商ID
├── period_start: 结算周期开始
├── period_end: 结算周期结束
├── settlement_type: 结算类型 (月度/季度)
│
├── // 汇总
├── total_repairs: 维修工单数
├── total_parts_used: 配件使用总数
├── total_amount: 结算总金额
├── currency: 货币
│
├── // 明细
├── invoice_ids: [关联PI列表]
├── detail_items: [{ sku, quantity, amount }] JSON
│
├── // 状态
├── status: 状态 (待确认/已确认/待付款/已付款)
├── confirmed_at: 经销商确认时间
├── paid_at: 付款时间
│
└── created_at, updated_at
```

### 3.9 物流追踪

```
logistics_tracking (物流追踪)
├── id
├── issue_id: 关联工单
├── rma_number: RMA号
├── direction: 方向 (inbound-寄回/outbound-寄出)
│
├── // 物流类型
├── logistics_type: 类型 (快递/上门送达/Kine取件/集中发货)
│
├── // 快递信息
├── carrier: 快递公司 (DHL/FedEx/UPS/顺丰/京东)
├── tracking_number: 快递单号
├── is_tracking_pending: 是否待补填
│
├── // 地址
├── origin_region: 发货地区
├── origin_address: 发货地址 JSON
├── destination_address: 收货地址 JSON
│
├── // 时间
├── shipped_at: 发货时间
├── estimated_arrival: 预估到达时间
├── actual_arrival: 实际到达时间
├── received_at: 签收确认时间
│
├── // 上门送达特有
├── appointment_time: 预约送达时间
├── contact_person: 联系人
├── contact_phone: 联系电话
│
├── // 集中发货特有
├── related_rma_numbers: [关联的其他RMA号]
│
├── // 状态
├── status: 状态 (待发货/运输中/已到达/已签收)
├── status_history: [状态变更历史] JSON
│
├── created_by: 创建人
└── created_at, updated_at
```

### 3.10 维修异常处理

```
repair_exceptions (维修异常)
├── id
├── issue_id: 关联工单
├── exception_number: 异常编号 (如: EXC-2026-001)
│
├── // 异常类型
├── exception_type: 类型 (成本超预估/严重损坏/需换整机/人为损坏/无法修复/发现其他问题)
│
├── // 原预估
├── original_estimate: 原预估金额
├── original_estimate_detail: 原预估明细 JSON
│
├── // 实际情况
├── actual_estimate: 实际需要金额
├── actual_estimate_detail: 实际明细 JSON
├── difference_amount: 差异金额
├── difference_percentage: 差异百分比
│
├── // 问题描述
├── description: 异常描述
├── photos: [检测照片URL列表]
├── analysis: 原因分析
│
├── // 客户选择
├── customer_options: [可选方案] JSON
│   // 如: [{type:'continue', amount:2500}, {type:'cancel', amount:0}, {type:'trade_in', amount:4000}]
├── customer_choice: 客户选择 (continue/cancel/trade_in/scrap)
├── customer_choice_at: 客户选择时间
├── customer_note: 客户备注
│
├── // 审批
├── requires_approval: 是否需要审批
├── approval_level: 审批级别 (业务员/负责人/管理层)
├── approved_by: 审批人
├── approved_at: 审批时间
├── approval_note: 审批备注
│
├── // 状态
├── status: 状态 (待处理/待客户确认/待审批/已确认/已取消)
│
├── reported_by: 提交人 (生产部)
├── handled_by: 处理人 (市场部)
└── created_at, updated_at
```

### 3.11 定期报告配置

```
report_schedules (报告配置)
├── id
├── report_type: 报告类型 (dealer_inventory_weekly/dealer_repair_monthly/quality_monthly/etc)
├── report_name: 报告名称
├── frequency: 频率 (daily/weekly/monthly)
├── schedule_day: 执行日 (周几/每月几号)
├── schedule_time: 执行时间
│
├── // 收件人
├── recipients: [收件人用户ID列表]
├── recipient_emails: [额外邮箱列表]
│
├── // 推送方式
├── push_email: 是否邮件推送
├── push_app: 是否App推送
├── push_web: 是否Web站内信
│
├── // 报告参数
├── parameters: { 报告特定参数 } JSON
│
├── is_active: 是否启用
├── last_run_at: 上次执行时间
├── last_run_status: 上次执行状态
│
└── created_at, updated_at

report_history (报告历史)
├── id
├── schedule_id: 报告配置ID
├── report_type: 报告类型
├── period_start: 报告周期开始
├── period_end: 报告周期结束
├── generated_at: 生成时间
│
├── // 报告内容
├── summary: 摘要 (AI生成)
├── content_html: 内容HTML
├── data_snapshot: 数据快照 JSON
│
├── // 推送记录
├── push_status: { email: 'sent', app: 'sent' } JSON
│
└── created_at
```

### 3.12 AI建议记录

```
ai_suggestions (AI建议记录)
├── id
├── suggestion_type: 建议类型 (classification/priority/assignee/reply/knowledge/diagnosis/etc)
├── related_entity_type: 关联实体类型 (issue/knowledge/replenishment/etc)
├── related_entity_id: 关联实体ID
│
├── // 建议内容
├── suggestions: [{ option, confidence, reason }] JSON数组
├── recommended_index: 推荐的选项索引
│
├── // 用户操作
├── user_action: 用户操作 (accepted/modified/rejected/ignored)
├── user_choice: 用户最终选择
├── user_modification: 用户修改内容
├── action_by: 操作人
├── action_at: 操作时间
│
├── // AI元数据
├── model_used: 使用的AI模型
├── prompt_version: Prompt版本
├── processing_time_ms: 处理耗时
│
└── created_at
```

### 3.13 统计视图 (预计算)

```
issue_stats_daily (每日统计)
├── date, product_id, issue_category, severity
├── region, dealer_id
├── count, avg_response_time, avg_resolve_time

issue_stats_monthly (月度统计)
├── 同上，按月聚合

product_quality_stats (产品质量统计)
├── product_id, period (周/月/季)
├── total_issues, severity_1_count, severity_2_count, severity_3_count
├── top_categories: [问题类别TOP5]
├── avg_repair_time
```

### 3.14 维修配件SKU与价格

> 数据来源: docs/inputs/维修配件SKU&价格单.xlsx

```
parts_catalog (配件目录)
├── id
├── sku: SKU编码 (如: S2-119-012-01)
├── category: 产品分类 (EAGLE EVF/MAVO Edge/MAVO mark2/Terra等)
├── internal_name_cn: 内部名称-中文
├── internal_name_en: 内部名称-英文
├── external_name_cn: 对外名称-中文
├── external_name_en: 对外名称-英文
├── price_cny: 人民币价格
├── price_usd: 美元价格
├── price_eur: 欧元价格
├── is_active: 是否在售
├── remarks: 备注
└── created_at, updated_at
```

**配件价格范围 (USD)**:
| 类别 | 价格范围 | 典型配件 |
|-----|---------|---------|
| 传感器 | $1,599 - $2,499 | Edge 8K Sensor, Edge 6K Sensor |
| 主板 | $799 - $1,199 | Main Board, MC图像处理模块 |
| 功能模块 | $59 - $750 | ND模块, SDI模块, 显示模块 |
| 小配件 | $19 - $120 | 风扇, TF卡模块, 按键板 |

**SKU编码规则**:
- 格式: `Sx-xxx-xxx-xx`
- S1: MAVO系列配件
- S2: EAGLE系列配件
- S3: 通用电路板
- S4: 通用小配件
- B-: 外壳/结构件

### 3.15 客户功能期望 (Wishlist)

> 收集客户对产品的改进建议和功能期望，形成产品迭代的重要输入

**与其他模块的关系**:
| 模块 | 性质 | 处理方式 |
|-----|------|---------|
| 服务记录 | 咨询/排查 | 解答后关闭 |
| 返修工单 | 产品故障 | 维修闭环 |
| **功能期望** | 产品改进建议 | 需求管理→产品迭代→推送闭环 |

```
feature_requests (功能期望)
├── id
├── request_number: 编号 (FR-2026-0001)
├── title: 标题
├── description: 详细描述
├── category: 分类 (UI/功能/性能/兼容性/硬件/其他)
├── product_id: 相关产品
│
├── // 来源追溯
├── source_type: 来源类型 (服务记录/经销商反馈/客户自助/内部建议)
├── source_id: 来源记录ID
├── customer_id: 首次提出客户
│
├── // 优先级与投票
├── priority: 优先级 (高/中/低)
├── vote_count: 请求次数/投票数
│
├── // 状态管理
├── status: 状态 (新建/评估中/已规划/开发中/已发布/已拒绝/已合并)
├── assigned_to: 负责人 (研发/产品)
├── rejection_reason: 拒绝原因
├── merged_to_id: 合并到哪个需求ID
│
├── // 版本规划
├── target_version: 目标版本 (如: 固件8025)
├── released_version: 实际发布版本
├── release_date: 发布日期
│
├── // AI辅助
├── ai_tags: AI自动标签
├── ai_similar_ids: AI识别的相似需求ID列表
├── ai_priority_score: AI优先级评分
│
└── created_at, updated_at

feature_request_customers (需求-客户关联)
├── id
├── feature_request_id: 功能期望ID
├── customer_id: 客户ID
├── dealer_id: 经销商ID (如通过经销商提交)
├── source_record_id: 来源记录ID (服务记录/工单)
├── vote_comment: 投票备注
├── notified_at: 功能发布后推送时间
├── notification_opened: 是否打开通知
├── feedback: 客户反馈
└── created_at

feature_request_comments (需求评论)
├── id
├── feature_request_id
├── author_id, author_name
├── comment_type: 类型 (评估意见/技术分析/产品决策)
├── content: 内容
└── created_at
```

**状态流转**:
```
新建 → 评估中 → 已规划 → 开发中 → 已发布
          ↘ 已拒绝 (附原因)
          ↘ 已合并 (合并到其他需求)
```

**AI介入点**:
| 环节 | AI能力 | 说明 |
|-----|-------|------|
| 收集 | 自动识别 | 从服务记录中识别"希望/建议/能不能"等关键词 |
| 整理 | 自动分类 | 根据描述自动分类为 UI/功能/性能/兼容性 |
| 整理 | 相似聚合 | 识别重复需求，建议合并 |
| 评估 | 优先级建议 | 根据请求频次、客户重要性给出建议 |
| 闭环 | 智能匹配 | 发布新版本时，自动匹配相关需求和客户 |

**推送闭环机制**:
```
固件发布 → 查找target_version匹配的需求 
        → 找出相关客户 (feature_request_customers)
        → 推送通知: "您期望的XXX功能已在固件8025中发布！"
        → 记录推送状态和客户反馈
```

---

## 4. 需求确认记录 (2026-01-30)

### 4.1 查询统计

| 问题 | 决策 | 备注 |
|-----|------|------|
| 预置查询模板 | ✅ 需要 | 初期提供基础模板，后续可动态增加 |
| 定时邮件推送 | ✅ 需要 | **推送对象**: 部门负责人<br>**频率**: 每周/每月/每季度 |
| 自定义报表 | ⏳ Backlog | 后续版本实现 |
| 地区热力图 | ✅ 需要 | Phase 2 实现 |

### 4.2 媒体管理

| 问题 | 决策 | 备注 |
|-----|------|------|
| 视频大小限制 | **50MB** | 原100MB调整为50MB |
| 自动压缩 | ⏳ Backlog | 暂不实现，后续考虑 |
| 对象存储 | ❌ 暂不使用 | 使用内部SSD存储<br>当前仅服务经销商/员工内部使用<br>后续扩展到客户时再考虑OSS |

### 4.3 知识库

| 问题 | 决策 | 备注 |
|-----|------|------|
| 组织方式 | **混合模式** | 按产品 + 按分类 |
| 版本控制 | ❌ 不需要 | 简化实现 |
| 审核流程 | ✅ 需要 | **需要实现推送提醒** (iOS/Web端) |
| 内容格式 | **Markdown/富文本** | 支持Markdown，可选富文本编辑器 |
| 对外发布 | ⏳ 后续考虑 | 需要API接口支持官网集成 |
| 浏览方式 | ✅ WIKI式浏览 | 提供类似WIKI的分类浏览+搜索 |

### 4.4 权限与角色

| 问题 | 决策 | 备注 |
|-----|------|------|
| 经销商登录入口 | ✅ 独立入口 | 可嵌入现有 dealer.kinefinity.com<br>或作为统一Web的特殊角色访问 |
| 经销商创建工单 | ✅ 可以 | 可代客户创建，也可创建自有产品工单 |
| 部门级权限 | ✅ 需要 | 支持后续扩展到更多部门 |

### 4.5 平台分工

| 问题 | 决策 | 备注 |
|-----|------|------|
| Web/iOS边界 | 见下方详细划分 | |
| 推送通知 | ✅ 需要 | 工单状态变更、新工单分配、审核提醒等 |

#### Web端与iOS端功能划分

| 功能模块 | Web端 | iOS端 | 说明 |
|---------|:-----:|:-----:|------|
| **工单创建** | ✅ 完整表单 | ✅ 简化快速录入 | iOS侧重拍照+语音输入 |
| **工单列表** | ✅ 复杂筛选+表格视图 | ✅ 卡片列表+基础筛选 | Web适合批量处理 |
| **工单详情** | ✅ 完整信息+编辑 | ✅ 查看+快速更新状态 | iOS侧重移动场景 |
| **附件上传** | ✅ 文件选择+批量 | ✅ 拍照+相册 | iOS体验更佳 |
| **统计报表** | ✅ 完整图表+交叉分析 | 📊 简化数据大盘 | Web为主，iOS看概览 |
| **知识库管理** | ✅ 创建/编辑/审核 | ❌ 仅查阅 | 编辑在Web端完成 |
| **知识库查阅** | ✅ 完整浏览+搜索 | ✅ 搜索+查看 | 双端支持 |
| **AI问答** | ✅ 完整对话 | ✅ 快速问答 | 双端支持 |
| **用户管理** | ✅ 完整Admin功能 | ✅ 授权/基础管理 | iOS支持授权操作 |
| **系统配置** | ✅ 字典/规则配置 | ✅ 基础配置 | 双端支持 |
| **推送通知** | ✅ 站内通知 | ✅ 系统推送(APNs) | |
| **离线支持** | ❌ | ✅ 草稿暂存 | iOS支持离线草稿 |

**经销商入口方案**: 统一Web+角色区分（方案B）
- 经销商通过统一入口登录，系统自动识别角色
- 显示经销商专属界面和数据范围
- 后续可通过SSO对接到现有dealer.kinefinity.com

**核心原则**:
- **Web端**: 管理中心，适合办公室场景，复杂操作、批量处理、数据分析
- **iOS端**: 移动助手，适合外出/现场场景，快速录入、拍照上传、状态更新、知识查询、授权管理

---

## 5. 版本规划

### Phase 1: 基础工单系统 ✅ 已完成
- [x] 工单 CRUD
- [x] 基础查询筛选
- [x] 图片/视频上传 (本地存储, 50MB限制)
- [x] 简单统计 (数量/状态分布)
- [x] 经销商管理
- [x] RMA号生成

### Phase 2: 高级查询与统计
- [ ] 多维度组合查询
- [ ] 交叉分析报表
- [ ] 地区热力图
- [ ] Excel/PDF 导出
- [ ] 预置查询模板

### Phase 3: 知识库系统
- [ ] 知识条目CRUD (Markdown/富文本)
- [ ] 混合组织模式 (产品+分类)
- [ ] 权限分级 (Public/Dealer/Internal/Department)
- [ ] 审核流程 + 推送提醒
- [ ] 工单-知识联动
- [ ] WIKI式浏览界面
- [ ] 对外API接口

### Phase 4: 返修管理闭环
- [ ] **返修报价预估**
  - [ ] AI故障诊断（概率排序）
  - [ ] 预估价格生成
  - [ ] 客户确认流程
  - [ ] 超时提醒机制（7/14/30天）
- [ ] **物流追踪**
  - [ ] 快递单号管理（已填写/待补填/上门/取件/集中）
  - [ ] 预估收货时间
  - [ ] 自动通知（发货/到达）
- [ ] **维修异常处理**
  - [ ] 异常类型定义（6种）
  - [ ] 生产部→市场部→客户沟通流程
  - [ ] 客户选择（继续/取消/换新/报废）
  - [ ] 审批权限控制（<$100/$100-500/>$500）

### Phase 5: 经销商配件管理
- [ ] **配件库存管理**
  - [ ] 库存初始化
  - [ ] 维修工单自动扣减
  - [ ] 库存预警机制（黄/红）
  - [ ] 库存变动记录
- [ ] **补货申请**
  - [ ] 经销商申请补货
  - [ ] 欠款检查机制（<30天警告/≥30天阻止）
  - [ ] 市场部审批
  - [ ] 紧急例外审批（Cathy）
- [ ] **结算管理**
  - [ ] PI发票生成
  - [ ] 定期结算（月度/季度）
  - [ ] 对账单生成
  - [ ] 欠款催收

### Phase 6: 知识库智能查询（AI辅助）
- [ ] 知识库向量检索
- [ ] 工单历史检索
- [ ] 智能问答 (带引用)
- [ ] 引导式故障排查
- [ ] 工单智能分析

### Phase 7: AI辅助功能 (第一批)
> 详见 UserScenarios.md 第11节 AI实现优先级

- [ ] 工单智能分类 + 优先级建议
- [ ] 智能回复建议
- [ ] 知识点自动提取
- [ ] 故障原因诊断 + 维修方案推荐
- [ ] 报告智能摘要

### Phase 8: 定期报告与通知
- [ ] **定期自动报告**
  - [ ] 经销商库存周报
  - [ ] 经销商维修月报
  - [ ] 工单处理周报
  - [ ] 产品质量月报
  - [ ] 报告邮件推送（富文本HTML，不生成PDF）
- [ ] **推送通知**
  - [ ] iOS APNs推送
  - [ ] Web站内通知
  - [ ] 库存预警通知
  - [ ] 欠款预警通知
  - [ ] 物流状态通知
  - [ ] 维修异常通知

### Phase 9: iOS端开发
- [ ] 工单快速创建（拍照+语音）
- [ ] 工单列表查看
- [ ] 状态快速更新
- [ ] AI问答
- [ ] 推送通知接收
- [ ] 知识库查阅

### Phase 10: AI辅助功能 (第二批)
- [ ] 高频问题识别
- [ ] 相似工单识别
- [ ] 补货量智能建议
- [ ] 批次问题预警
- [ ] 邮件/通知自动起草

### Phase 11: AI辅助功能 (第三批)
- [ ] 处理人智能分配
- [ ] 知识条目更新建议
- [ ] 自然语言查询
- [ ] 客户情绪识别
- [ ] 结算异常检测
- [ ] 维修记录规范化
- [ ] 多语言翻译

### Backlog
- [ ] 自定义报表功能
- [ ] 图片/视频自动压缩
- [ ] 对象存储迁移 (OSS/S3)
- [ ] 官网集成
- [ ] 经销商iOS端
- [ ] 物流API对接（自动追踪）
- [ ] 信用额度管理

---

## 6. 推送通知场景汇总

| 事件 | 推送对象 | 推送方式 | 优先级 |
|-----|---------|---------|-------|
| 新工单创建 | 市场部负责人(按地区) | iOS + Web | 普通 |
| 工单分配给我 | 被分配人 | iOS + Web | 普通 |
| 工单状态变更 | 创建者、关注者 | iOS + Web | 普通 |
| 工单有新评论 | 相关人员 | Web | 低 |
| P1紧急工单/R1加急返修 | 管理层 | iOS (紧急) | 紧急 |
| 生产问题反馈 | 研发部、管理层 | iOS + Web | 高 |
| 知识审核请求 | 审核人 | iOS + Web | 普通 |
| 审核结果 | 创建者 | Web | 低 |
| 定时报表 | 部门负责人 | 邮件 + Web | 低 |
| 工单响应超时 | 负责人、管理层 | iOS + Web | 高 |
| 返修超时预警 | 生产部、市场部 | iOS + Web | 高 |
| **库存预警** | 市场部对应人员 | 邮件 + App | 普通 |
| **经销商库存周报** | 市场部负责人、Cathy | 邮件 + Web | 低 |
| **欠款预警** | 市场部、财务 | 邮件 + Web | 高 |
| **物流发货通知** | 市场部、生产部 | App + Web | 普通 |
| **物流到达通知** | 生产部 | App + Web | 普通 |
| **维修异常通知** | 市场部、经销商 | App + Web | 紧急 |
| **报价确认提醒** | 客户/经销商 | 邮件 + Web | 普通 |
| **报价确认超时(7/14天)** | 客户/经销商、市场部 | 邮件 + Web | 高 |
| **补货审批请求** | 市场部 | App + Web | 普通 |
| **AI知识点建议** | 市场部 | Web | 低 |
| **AI批次问题预警** | 研发部、管理层 | App + Web | 紧急 |
| **AI客户情绪预警** | 市场部负责人 | App | 紧急 |

---

## 7. 需求确认记录

### 7.1 查询统计 (2026-01-30)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 预置查询模板 | ✅ 需要 | 初期提供基础模板，后续可动态增加 |
| 定时邮件推送 | ✅ 需要 | **推送对象**: 部门负责人<br>**频率**: 每周/每月/每季度 |
| 自定义报表 | ⏳ Backlog | 后续版本实现 |
| 地区热力图 | ✅ 需要 | Phase 2 实现 |

### 7.2 媒体管理 (2026-01-30)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 视频大小限制 | **50MB** | 原100MB调整为50MB |
| 自动压缩 | ⏳ Backlog | 暂不实现，后续考虑 |
| 对象存储 | ❌ 暂不使用 | 使用内部SSD存储 |

### 7.3 知识库 (2026-01-30)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 组织方式 | **混合模式** | 按产品 + 按分类 |
| 版本控制 | ❌ 不需要 | 简化实现 |
| 审核流程 | ✅ 需要 | 需要推送提醒 |
| 内容格式 | **Markdown/富文本** | |

### 7.4 返修管理 (2026-01-31)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 返修报价预估 | ✅ AI分析+客户确认 | 过保必须确认后才能寄修 |
| 检测费 | **$0** | 暂时免费，后续可调整 |
| 客户反悔处理 | ✅ 可退回 | 确认后不寄修，原设备退回，不收费 |
| 确认超时 | **7/14/30天** | 7天提醒→14天跟进→30天关闭 |
| 物流追踪 | ✅ 多种模式 | 快递/上门/取件/集中 |
| 维修异常 | ✅ 三方确认 | 生产部→市场部→客户 |
| 审批权限 | 分级 | <$100业务员/$100-500负责人/>$500管理层 |

### 7.5 经销商配件管理 (2026-01-31)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 库存管理方式 | **系统自动计算** | 无需经销商手动申报 |
| 库存变动 | 维修工单自动扣减 | 工单中选择使用配件 |
| 补货欠款检查 | ✅ 强制检查 | <30天警告，≥30天阻止 |
| 信用额度 | 仅特殊经销商 | 普通经销商付款才发货 |
| 紧急例外 | ✅ 支持 | Cathy审批 |

### 7.6 报告与通知 (2026-01-31)

| 问题 | 决策 | 备注 |
|-----|------|------|
| 报告格式 | **富文本HTML邮件** | 不生成PDF附件 |
| 报告频率 | 日/周/月可配置 | 不同报告不同频率 |
| 推送方式 | 邮件+App+站内信 | 多渠道 |

### 7.7 AI应用 (2026-01-31)

| 问题 | 决策 | 备注 |
|-----|------|------|
| AI应用原则 | **AI建议+人工确认** | 人始终掌控决策 |
| 实现优先级 | 3个Phase | Phase 7/10/11 |
| AI场景总数 | **17个** | 见UserScenarios.md第9节 |

---

**文档状态**: 需求已更新，待API设计
**最后更新**: 2026-01-31
